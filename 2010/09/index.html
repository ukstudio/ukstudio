<!DOCTYPE html><html><head><meta charset="utf-8" /><!--Always force latest IE rendering engine or request Chrome Frame--><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><!--Use title if it's in the page YAML frontmatter--><title>The Middleman</title><link href="http://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet" type="text/css" /><link href="/stylesheets/normalize.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/all.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/highlight.css" media="screen" rel="stylesheet" type="text/css" /><script src="/javascripts/all.js" type="text/javascript"></script><link href="/feed.xml" rel="alternate" title="atom" type="application/atom+xml" /><script type="text/javascript">var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-12755601-1']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></head><body class="2010 2010_09 2010_09_index"><div class="header"><div class="header-navigation"><ul><li><i class="fa fa-twitter"></i><a href="http://twitter.com/ukstudio">Twitter</a></li><li><i class="fa fa-github-alt"></i><a href="http://github.com/ukstudio">GitHub</a></li></ul></div><div class="header-title"><a href="/">UKSTUDIO</a></div></div><div class="container"><h1><Archive></Archive>Sep 2010</h1><article><h2><a href="/2010/09/13/git-svn/">2010-09-13 Better Subversionとしてのgit-svn</a></h2>普段のプログラミングにgitを使用しているのだけど、実際の現場ではまだまだsvnが主流だったりする。svnを直接使ってもいいのだけど、やはりローカル上でコミットしたいとか、複数のコミットを1つにまとめたいとか、トピックブランチを切りたいとかあるのでそれはsvn単体だと厳しい。そんなわけでBetter SVNとしてのgit svnの紹介、と言うよりメモ。

<h2>リポジトリのクローン</h2>
<code><pre>git svn clone repository_url</pre></code>
これでsvnリポジトリをgitリポジトリとして取得できる。大きめのリポジトリだと結構時間がかかるのでのんびりと。svnリポジトリの構成がtrunk/branches/tagsという一般的な構成であればオプション-を付けるのがおすすめ。trunkをmaster、branches/tagsをremote branchとして扱うようになる。個別に指定する方法もあるのでhelp参照。
<code><pre>git svn clone -s repository_url</pre></code>

<h2>リポジトリの更新</h2>
<code><pre>git svn rebase</pre></code>
svn upに相当する。remote brancheのtrunkをgit coしてそれをmergeする方法もあるけど、基本はこれで問題ない。

<h2>リポジトリへのコミット</h2>
<code><pre>git svn dcommit</pre></code>
これはsvn ciに相当するって言うと、少し違う気もするのだけどsvnリポジトリにコミットするっていう意味だと同じ。git pushの方がイメージに近い。ローカルにたまっているコミットをsvnリポジトリにpushする感じ。ローカルにコミットされていない変更があるとdcommitできないので、その時はgit stashする。
<code><pre>git stash
git svn dcommit
git pop
</pre></code>

<h2>ブランチの作成</h2>
<code><pre>git svn branch name</pre></code>
trunk-masterでやり取りするだけだったら、上記さえ覚えておけば後は普通のgitリポジトリと同じ。gitのブランチを作るのは通常のgitリポジトリと同じだけど、svnのブランチを作るにはこのコマンドを叩く。この時点でsvnリポジトリにコミットされるので注意(--dry-runオプションはある)。-mオプションでコミットメッセージを書ける。指定しない場合は「Create branch name」となる。

svnリポジトリの別のブランチや、ローカルのgitリポジトリのブランチから新しくブランチを作る場合には後ろに名前を指定する。
<code><pre>git svn branch name remotes/branch
git svn branch name local_branch</pre></code>

<h2>ブランチのチェックアウト</h2>
<code><pre>git co -b branch remotes/branch</pre></code>
svn switchに相当。git svnはsvnのbranches/tagsをremote branchとして扱うのでそれをgit coすればいい。これは上記のgit svn branchで作成したものも同じ。

<h2>ブランチ間のマージ</h2>
<code><pre>git merge --no-ff branch_name
git svn dcommit</pre></code>
マージは通常のgitとほぼ同じ。注意しなくてはいけないのは--no-ffが必要なこと(参考: <a href='http://webtech-walker.com/archive/2010/03/26101332.html'>http://webtech-walker.com/archive/2010/03/26101332.html</a>)。

<h2>ブランチの削除</h2>
<code><pre>svn rm branches/name #svnリポジトリをcoしてそこで
git branch -r -d name #git-svnのgitリポジトリ上で</pre></code>
現時点(v1.7.0.6)ではsvnリポジトリのブランチを削除するコマンドは用意されていない模様。なので直接svn上でブランチを消して、git側のremote branchも直接消すしかないと思う。

<h2>どのブランチにコミットされるのか</h2>
<code><pre>git svn info</pre></code>
もしかしたら、今いるgitリポジトリのブランチでgit svn dcommitしたらsvnリポジトリのどのブランチにコミットされるのかがわからなくなることもあるかもしれない。その時はgit svn infoで表示されるURLをみればよい。

<h2>ignoreの設定</h2>
<code><pre>git svn create-ignore</pre></code>
ignoreは少しややこしいんだけど、svn側とgit側の2つ存在する。このコマンドはsvn側のignore設定を.gitignoreとして出力する。ちなみにsvn側のみignore設定してある場合、当然git側ではignoreされずgit svn dcommit出来てしまう。その場合、svn側のignoreも無視して通常通りコミットされてしまうので注意。

<h2>まとめ</h2>
git-svnでの開発はsvnの面倒なところをカバーしてくれたりするので非常にオススメ。もちろん全てがgit-svnで出来るわけでもないので、その辺は諦めて直接svnを使う必要もある。ある意味、最悪わからなくなったらいつでもsvnに戻ればいいのでとりあえず試してみるといいと思う。

ちなみにgitに詳しくない人は濱野さんの入門Gitがおすすめです。

<iframe src="http://rcm-jp.amazon.co.jp/e/cm?lt1=_blank&bc1=000000&IS2=1&bg1=FFFFFF&fc1=000000&lc1=0000FF&t=ukstudio0c-22&o=9&p=8&l=as1&m=amazon&f=ifr&md=1X69VDGQCMF7Z30FM082&asins=4798023809" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe>

</article><hr /><article><h2><a href="/2010/09/10/password_edit/">2010-09-10 パスワード変更の機能をどこにもたせるべきか</a></h2>ちょっと色々わからなくなったので、誰かのアドバイスを期待してここに書く。

簡単に前提を書くと、UserモデルのCRUDとは別にUserのパスワードを変更する画面が必要になった。Usersコントローラにpassword_editみたいなactionを書くのもあまりきれいじゃないなと思ってコントローラを分けることにした。

<pre><code>resources :users do
  resource :password
end
</code></pre>

確実にUserのレコードは必要になるので上記の用にネストさせることにした。ここで気になるのがpasswordのコントローラ名。通常PasswordsControllerになる。ただ、PasswordsController内の処理は確実にUserに依存する処理が入るため、これはこれであまりしっくりこない。別にPasswordsControllerを他で使う予定があるわけじゃないけど、User::PasswordsControllerの方がいい気がする。

<pre><code>resources :users do
  resource :password, :only => :edit, :module => 'user'
end
</code></pre>

<pre><code># app/controllers/user/passwords_controller.rb
module User
  PasswordController < ApplicationController::Base
</code></pre>

ただ、たかがあるモデルのカラムの為にここまでする必要があるのか?そもそもリソースじゃないよなと思ったりもするわけで。やっぱりUsersコントローラにactionを用意する程度に留めるべきなのだろうか。

<h3>追記:10/09/11</h3>
やっぱりコントローラを作る(というよりresourcesを追加するのが)がおかしいと思いはじめ、結局気にしてるのはURLなので以下のようにしてみようかなと思う。
<pre><code>resources :user do
  match 'password/edit' => 'users#password_edit'
end
</code></pre>
</article><hr /><article><h2><a href="/2010/09/10/mitakarb10/">2010-09-10 mitaka.rb#10に参加してきました</a></h2>9日に開催された<a href='http://atnd.org/events/7542'>mitaka.rb#10</a>に参加してきた。何だかんだで3回目の参加。今回のmitaka.rbは主催の<a href='http://twitter.com/ysakaki'>@ysakaki</a>さんと協賛の(株)HatchUpさんの圧倒的財力により、なんと3000円というお得な会でした。飲み放題だし、ご飯もとてもおいしかった。おかげで今日は若干二日酔いです。

今回は<a href='http://twitter.com/takahashim'>@takahashim</a>さんが参加されてて、たまたま席が近く色々とお話が出来て楽しかった。実はあまりちゃんと話したことがなかったのでよかった。後は<a href='http://www.tokyorubyistmeetup.org/'>Tokyo Rubyist Meetup</a>から<a href='http://twitter.com/pwim'>@pwim</a>さんが来られてて少しお話した。9月22日に<a href='http://tokyorubyistmeetup.doorkeeper.jp/events/36'>Kickoff Party</a>をやるとのことなのでみんな参加しよう!

今回もLTがあって、わざわざ群馬から車で来られてる人がいた。フットワーク軽いなー。<a href='http://twitter.com/bash0C7'>@bash0C7</a>さんがChiba.rbとShibuya.rbと東京RubyKaigi04について発表してた。Shibuya.rbは今丁度渋谷勤務なので参加しようと思う。東京RubyKaigi04はスタッフまたやろうかなとも思ったけど、「初めてだけどスタッフやりたい!」って人が多そうだったら一般参加者になるかも。割と気分次第。

帰り際、「実はえにしテックってどちらが社長か知らないんですけど」って言われたらすごい笑われた。本当に知らなかったんだよね。@takahasimさんに<a href='http://twitter.com/takahashim/status/24015182969'>放流</a>されてしまった。今は一応把握してます。多分。

そんなわけで、主催の@ysakakiさんをはじめ、スタッフ、お店の方々ありがとうございました。
</article><hr /><article><h2><a href="/2010/09/05/sla/">2010-09-05 外国語学習の科学</a></h2>新書なのでサクッと読めた。おもしろかったので簡単に紹介する。

<blockquote>
このような背景から、「外国語学習」という現象そのものを対象とした学問分野が1960年代ごろから発達してきました。これが、「第二言語習得(Second Language Acquisition = SLA)」という新たな研究分野です。
</blockquote>

書名にある第二言語とは、上記の引用の通り比較的新しい学問で、主に「第二言語習得メカニズムの解明」と「どのような習得方法が効果的か」という問題を扱うとのこと。

ちなみに第二言語 = 英語というわけではなく、母国語を第一言語として、それ以外の言語については全て第二言語として扱うらしい。日本語話者が英語を習って、次にロシア語を習った場合でも、ロシア語は第二言語と呼ばれる。

そもそも僕がこの本を手にとったきっかけは「いい加減、科学的に正しい英語学習法が確立されてていいんじゃないの?」という疑問なので、この本はそういう疑問に対して丁度よさそうだったため。

結論から書くと、現状「正しい英語学習法」というのは確立されていないらしい。とは言え、今までの研究でわかってきたことをベースに、ある程度の方向性は見えてきているようで、この本に目を通しておけば少なくとも巷の「うさんくさい英語学習法」に騙されることはなくなりそうではある。

何にせよ、英語学習者、英語を教える側、子を持つ親(子供の言語学習についても触れられているため)など英語に関わる人は読んでおいて損はない本であるのは間違いない。もちろん「第二言語習得」という研究に興味がある人もその取っ掛かりとしてはいい本だと思う。

ちなみに英語を学習するための効率的な方法を知りたいという人は6章の「効果的な外国語学習法」だけ読んでおけば十分かとも思うが、そんなに量の多い本でもないし、残りの章も読むことをおすすめする。読み易いし、内容もおもしろいので、ちょっとした読み物気分で読めばいいと思う。

<iframe src="http://rcm-jp.amazon.co.jp/e/cm?lt1=_blank&bc1=000000&IS2=1&bg1=FFFFFF&fc1=000000&lc1=0000FF&t=ukstudio0c-22&o=9&p=8&l=as1&m=amazon&f=ifr&md=1X69VDGQCMF7Z30FM082&asins=4004311500" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe>
</article><hr /><article><h2><a href="/2010/09/03/rspec2_rails3_autotes/">2010-09-03 RSpec2+Rails3+autotest環境の構築</a></h2>9月からやる仕事がめでたく、Rails3.0 + Ruby1.9.2のお仕事なので色々と環境構築。とりあえず自動テストまわりやりました。

一応、環境を他と切り分けるために、rvmでアプリ用にgemsetを用意。アプリごとに簡単に環境を構築できるrvmマジ便利。

<pre>
gem install bundler --pre
gem install rails
</pre>

まずは、bundlerとrailsをインストール。次は適当なアプリを作って必要なgemのインストールなどを行う。テストはRSpecで書くので、-TをつけてTest/Unitは使わないようにする。

<pre>
rails new demo -T
</pre>

次に必要なgemをGemfileに記述。rspecとかを「テストだけだから」と思って、gropu :testにしたら、モデルを作成したときにTest/Unitのテストコードが作られたりしたので注意。githubの<a href='http://ja.wiki.github.com/rspec/rspec/autotest/'>Wiki</a>を見るとautotestのgemは不要そうなんだけど、実際ないとうまくautotestが動かなかた。

<script src="http://gist.github.com/563447.js?file=Gemfile"></script>

<pre>
bundle install
</pre>

あとはモデルを作って、テストが実行できればOK。

<pre>
rails g rspec:install
rails g model user
rake
autotest
</pre>

<h3>追記</h3>
Twitterで@conceal_rsさんから補足ありました。ありがとうございます!
</article><hr /><article><h2><a href="/2010/09/02/rubykaigi2010/">2010-09-02 RubyKaigi2010を終えて</a></h2><img src='http://farm5.static.flickr.com/4134/4935820587_2169342225.jpg'/>
<a href='http://www.flickr.com/photos/recompile_net/sets/72157624694727057/'>via http://www.flickr.com/photos/recompile_net/sets/72157624694727057/</a>

少し間があいたけど、今年のRubyKaigiについてつらつらと書こうかな。

<h3>スタッフ参加してみて</h3>
今年はスタッフとしての参加だったのだけれど、RubyKaigiのスタッフは東京RubyKaigi03の時にやっただけなので、本家の方は初めて。3日間と結構な長丁場なのでうまく立ち回れるか不安だったのだけど、自分なりにはそれなりに頑張れたのではないかなと思う。

ひとつ前のエントリでも書いたけど、担当はレポート班でした。当日スタッフに応募する前はrubykaigi.orgの制作・実装の方も手伝っていたけど、実質ほとんど何もしていない・できなかったのでスタッフとしては90%ぐらいはレポート班な感じ。

レポート班はある意味発表を見るのが仕事みたいな部分もあったし、文章を書くのも割と好きなので、RubyKaigiを楽しみつつ仕事も楽しむという割とおいしい感じに過ごせた。自分の語彙の少なさや英語力のなさなど色々と痛感した部分もあるけど、楽しくやることが出来ました。

今年は開催が筑波ということで、スタッフの大半はホテル山久(#hotel39)に泊まったわけだけど、本当に楽しかった。#hotel39_107 の楽しさは異常である。あの感じはなんだったんだろうなぁ。

実はChad Folwerの基調講演と高橋さんのclosingから、色々な想いがまざって泣きそうになってた。未だにその時の気持ちが整理できていないのだけど「Chadに励まされてる感じ」「今年のRubyKaigiが終わる感じ」「来年でRubyKaigiが終わる感じ」「3日間の疲れ」あたりの気持ちが色々と混ってよくわからない感じになったのだと思う。

元々、この手の技術系カンファレンスは情報を仕入れに来てるタイプだったので、まさか泣きそうになるとは自分でも意外だった。多分、一般参加してそうなるとは思えないので、やっぱりスタッフとして参加したのが大きかったのかなと思う。

<h3>来年のRubyKaigi</h3>
最後のRubyKaigiと言うことで、自分なりに何を成し遂げたいか簡単に書いておく。

ひとつは発表者として参加すること。やっぱりあの場で話すのは一種の憧れみたいなものがあるにはあるので、それを憧れで終わらせない為にも何か話したい。一応話してみたいことはちらほらあるので、1年あれば十分まとめられるはず。

あとは、書き始めてるアレを間に合せたい。あわよくばサイン会・・・実質、ほとんどまだ手が動いていないのでいい加減動かないとまずい。

最後はやっぱりスタッフ参加かなぁ。本当に終わってしまうのであれば、最後はスタッフとして見届けたい。
</article><hr /></div></body></html>