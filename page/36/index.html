<!DOCTYPE html><html><head><meta charset="utf-8" /><!--Always force latest IE rendering engine or request Chrome Frame--><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><!--Use title if it's in the page YAML frontmatter--><title>ukstudio.jp</title><link href="http://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet" type="text/css" /><link href="/stylesheets/normalize.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/all.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/highlight.css" media="screen" rel="stylesheet" type="text/css" /><script src="/javascripts/all.js" type="text/javascript"></script><link href="/feed.xml" rel="alternate" title="atom" type="application/atom+xml" /><script type="text/javascript">var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-12755601-1']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></head><body class="page page_36 page_36_index"><div class="cointainer-fluid"><div class="navbar navbar-default" role="navigation"><div class="container-fluid"><div class="navbar-header"><a class="navbar-brand" href="/">UKSTUDIO</a></div><div class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a href="http://twitter.com/ukstudio">Twitter</a></li><li><a href="http://github.com/ukstudio">GitHub</a></li></ul></div></div></div></div><div class="container"><article><h1><a href="/2007/11/18/ruby_amazon/">2007-11-18 Ruby/Amazonライブラリ</a></h1><hr /><div class="article-body">URL:<a href="http://www.caliban.org/ruby/ruby-amazon.shtml">http://www.caliban.org/ruby/ruby-amazon.shtml</a>

ちょっとAWSを使うプログラムを書こうと思ったので、準備としてRuby/Amazonライブラリを試してみた。
<h2>Ruby/Amazonのインストール</h2>
<ol>
<li>ライブラリのアーカイブを<a href="http://www.caliban.org/ruby/ruby-amazon.shtml#files">ダウンロード</a></li>
<li>アーカイブを解凍</li>
<li>解凍してできたディレクトリにsetup.rbがあるので、それを使用してインストール</li>
</ol>
<pre lang="bash">
% ruby setup.rb config
% ruby setup.rb setup
% ruby setup.rb install
</pre>
<h2>ISBN/ASINで検索</h2>
<h3>ソースコード</h3>
<pre lang="ruby">
#! ruby -Ku

require 'amazon/search'
include Amazon::Search

DEV_TOKEN = "****************"
ASSOCIATE_ID = "ukstudio0c-22"

request = Request.new(DEV_TOKEN, ASSOCIATE_ID, "jp")

# ASIN/ISBNで検索
res = request.asin_search("4274066428", LITE) # HEAVYを指定した場合、詳細な情報が得られる

# ヒット数
puts res.products.size #=> 1 ASINでの検索なので1件のみ該当

# ヒットした製品の情報
puts res.products[0]
</pre>
<h3>実行結果</h3>
<pre lang="bash">
asin             = "4274066428"
authors          = ["Dave Thomas", "Chad Fowler", "Andy Hunt", "田和 勝", "まつもと ゆきひろ"]
availability     = "通常24時間以内に発送"
catalog          = "Book"
image_url_large  = "http://ecx.images-amazon.com/images/I/4151YFZ27NL.jpg"
image_url_medium = "http://ecx.images-amazon.com/images/I/21QGW56WGCL.jpg"
image_url_small  = "http://ecx.images-amazon.com/images/I/11V7Q88BZ3L.jpg"
list_price       = "￥ 3,990"
manufacturer     = "オーム社"
our_price        = "￥ 3,990"
product_name     = "プログラミングRuby 第2版 言語編"
release_date     = "2006/08/26"
url              = "http://www.amazon.co.jp/gp/product/4274066428%3ftag=ukstudio0c-22%26link_code=xm2%26camp=2025%26dev-t=0GTT93KAWBX07WMKM002"
used_price       = "￥ 3,200"
</pre>
<h2>キーワード検索</h2>
<h3>ソースコード</h3>
Requestオブジェクトを作るところまでは同じなので省略。
<pre lang="ruby">
res = request.keyword_search("ruby", 'books', LITE) # booksはモードの指定。musicとか。

# ヒット数
puts res.products.size #=> 11/18日現在、10件ヒットした。なんか少ないな・・・

# ヒットした製品のタイトルを表示
res.products.each{|item|
  puts item.product_name
}
</pre>
<h3>実行結果</h3>
<pre lang="bash">
The Ruby (ザ・ルビー) 2007年 12月号 [雑誌]
Ruby on Rails入門―優しいRailsの育て方
たのしいRuby 第2版 Rubyではじめる気軽なプログラミング
プログラミングRuby 第2版 言語編
プログラミングRuby 第2版 ライブラリ編
Rubyではじめるゲームプログラミング―人気の国産言語で、誰でも簡単にゲームが作れる! (I/O BOOKS)
基礎Ruby on Rails (IMPRESS KISO SERIES)
Rubyレシピブック 第2版 268の技
はじめよう Ruby on Rails
WEB+DB PRESS Vol.38
</pre>
<h3>追記(07-11-19)</h3>
キーワード検索で10件しかヒットしなかったのはkeyword_searchメソッドにALL_PAGESオプションを指定してなかったためでした。
<h3>キーワードがヒットしなかった場合</h3>
検索したキーワードで何もヒットしなかった場合、例外が発生するみたいなので例外処理が必要。
<pre lang="bash">
/opt/local/lib/ruby/site_ruby/1.8/amazon/search.rb:1172:in `get_args': There are no exact matches for the search. (Amazon::Search::Request::SearchError)
</pre>
</div></article><article><h1><a href="/2007/11/16/coding_rule_ruby/">2007-11-16 個人用のコーディング規約を書き始めたんよ</a></h1><hr /><div class="article-body"><a href="/coding_rule/">CodingRule</a>

とりあえずはRubyから書き始めたんよ。思ったよりまとめるのが大変。

と言うより、普段何も考えてないのがわかる。暗黙的というか、その場のフィーリングで決めてるようで以前のRubyプログラムを見なおしてみると、スペースの取り方とかメソッド・クラス名が結構バラバラ。

以下の規約も参考にしつつ、少しずつまとめてみたいと思う。

<ul>
<li>前田さんの<a href="http://shugo.net/ruby-codeconv/codeconv.html">Rubyコーディング規約</a></li>
<li>青木さんの<a href="http://www.loveruby.net/w/RubyCodingStyle.html">RubyCodingStyle</a></li>
<li>id:cho45さんの<a href="http://lab.lowreal.net/trac/wiki/CodingRule/Ruby">Ruby Language Coding Rule</a></li>
</ul>

追記(07/11/18): CodingRuleページ内のリンクが間違ってたから修正した
</div></article><article><h1><a href="/2007/11/01/ruby_fizzbuzz_2/">2007-11-01 RubyでFizzBuzz #2</a></h1><hr /><div class="article-body"><a href="http://uk-studio.net/2007/10/28/ruby_fizzbuzz/">RubyでFizzBuzz</a>の第二弾。大分スッキリしたと思うんだけどどでしょ。
<pre lang="ruby">
fizzbuzz = (1..100).map{|i|
if i%5 == 0 && i%3 == 0 : "FizzBuzz"
elsif i%5 == 0 : "Buzz"
elsif i%3 == 0 : "Fizz"
else i end
}</pre>
</div></article><article><h1><a href="/2007/10/30/ruby_prime/">2007-10-30 Rubyで素数を求めるプログラムを書いた</a></h1><hr /><div class="article-body">引数に入れた値までの素数を配列で返すRubyのクラスを書いてみた。アルゴリズムは<a href="http://ja.wikipedia.org/wiki/%E3%82%A8%E3%83%A9%E3%83%88%E3%82%B9%E3%83%86%E3%83%8D%E3%82%B9%E3%81%AE%E7%AF%A9">エラトステネスの篩</a>を使用。
<strong>generate_prime.rb</strong>
<pre lang="ruby">
class GeneratePrime
  def generate_prime(max_num)
    if max_num < 2 then return nil
    elsif max_num == 2 then return 2 end

    search_list = (2..max_num).to_a # 探索リスト
    prime_list = Array.new          # 素数リスト

    # 素数の探索
    begin
      prime_list << search_list[0]
      search_list.each_index{|i|
        if search_list[i] % prime_list[-1] == 0 then
          search_list.delete_at(i)  # 素数リストに加えた数の全ての倍数を削除
        end
      }
    end while search_list[-1] > (prime_list[-1] * prime_list[-1])

    # 素数リスト及び、探索リストに最後まで残っていた数が素数
    return prime_list.concat(search_list)
  end
end</pre>
<strong>generate_prime_test.rb</strong>
<pre lang="ruby">
require 'test/unit'
require 'generate_prime'

class TestGeneratePrime < Test::Unit::TestCase
  def setup
    @prime = GeneratePrime.new
  end
  def test_generate_prime
    assert_equal(nil, @prime.generate_prime(1))
    assert_equal([2,3,5,7], @prime.generate_prime(10))
    assert_equal([2,3,5,7,11,13,17,19,23,29], @prime.generate_prime(30))
  end
end</pre>
<strong>テスト結果</strong>
</pre><pre>
% ruby generate_prime_test.rb
Loaded suite generate_prime_test
Started
.
Finished in 0.000454 seconds.

1 tests, 3 assertions, 0 failures, 0 errors</pre>
テストが不十分な気もするけど多分大丈夫なはず。・・・多分。
</div></article><article><h1><a href="/2007/10/28/ruby_fizzbuzz/">2007-10-28 RubyでFizzBuzz</a></h1><hr /><div class="article-body">今更ながらにFizzBuzz問題をRubyで問いてみる。前は確かPHPだけで問いて、Rubyで問いてなかったと思うから。

<strong>ループ内で出力</strong>
<pre lang="ruby">
100.times(){|i|
  i += 1
  if i%5 == 0 && i%3 == 0 then
    puts "FizzBuzz"
  elsif i%5 == 0
    puts "Buzz"
  elsif i%3 == 0
    puts "Fizz"
  else
    puts i
  end
}</pre>
<strong>配列を作ってそれを出力</strong>
<pre lang="ruby">
fizzbuzz = Array.new(100){|i|
  i += 1
  if i%5 == 0 && i%3 == 0 then
    "FizzBuzz"
  elsif i%5 == 0
    "Buzz"
  elsif i%3 == 0
    "Fizz"
  else
    i
  end
}
puts fizzbuzz</pre>
まぁ、普通ですな。後々データを再利用する可能性を考えると、ループ内で出力するより配列を作った方がいいかなとは思う。

if文のところはもうちょっとなんとかなる気もするけど、コードゴルフしてるわけでもないし、これでいいかな。再帰で書けって言われたら多分できないけど。

精進ですなー。
</div></article><div class="pager"><ul><li class="previous"><a href="/page/35/">Prev</a></li><li class="next"><a href="/page/37/">Next</a></li></ul></div></div></body></html>