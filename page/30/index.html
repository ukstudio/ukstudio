<!DOCTYPE html><html><head><meta charset="utf-8" /><!--Always force latest IE rendering engine or request Chrome Frame--><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><!--Use title if it's in the page YAML frontmatter--><title>ukstudio.jp</title><link href="http://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet" type="text/css" /><link href="/stylesheets/normalize.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/all.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/highlight.css" media="screen" rel="stylesheet" type="text/css" /><script src="/javascripts/all.js" type="text/javascript"></script><link href="/feed.xml" rel="alternate" title="atom" type="application/atom+xml" /><script type="text/javascript">var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-12755601-1']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></head><body class="page page_30 page_30_index"><div class="cointainer-fluid"><div class="navbar navbar-default" role="navigation"><div class="container-fluid"><div class="navbar-header"><a class="navbar-brand" href="/">UKSTUDIO</a></div><div class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a href="http://twitter.com/ukstudio">Twitter</a></li><li><a href="http://github.com/ukstudio">GitHub</a></li></ul></div></div></div></div><div class="container"><article><h1><a href="/2008/06/04/rails_for_beginner/">2008-06-04 RE:Rails初心者はどうやって他人のRailsコードを読めばいいか</a></h1><hr /><div class="article-body">オレもRailsを初めて3ヶ月(もうちょいあるかも)たったので、ある程度オレの経験を元にまとめてみる。参考になるといいなー。

<h2>1. まずはアプリケーションを実際に動作させる</h2>
<pre lang="bash">
% ruby script/server
</pre>
とりあえずコード読む前にそのアプリケーションがどんなものを把握するのが重要。コード読んでもわかるだろうけど、実際にブラウザでいじくりまわした方がはやく理解できると思う。その時にコントローラー名とアクション名もみといた方がよさげ。

<h2>2. モデル図を書く</h2>
これはid:Hash本人も重要って書いてたけど、ほんとに重要。そんなにキレイな図とかじゃなくていいから、紙とかに多対多なのか1対多なのかとか、参照名はなにかとかぐらいメモがてら書いておくと吉。モデルの関連さえ把握できれば、そのRailsアプリの半分以上理解できたも同然ってぐらい重要。

<h2>3. Logをみる</h2>
<pre lang="bash">
% tail -f log/development.log
</pre>
開発時にも言えることだけどなるべくLogはみた方がいい。log/の下にdevelopment.log(多分ないと思うけど、productionで動作させてるならproduction.log)があるのでtailコマンドとかでみるといい。フォームのsubmit時のパラメータが見れたり、あとはlogger.infoで出力をチェックしたりとかできる。

<h2>4. script/consoleを使う</h2>
<pre lang="bash">
% ruby ./script/console
</pre>
基本的な使い勝手はirbと同じ。irbと違うのはRails環境があらかじめロードされていること。例えば、モデルのメソッド名を呼び出したりとか。メソッドレベルで動作をみたい場合に便利。あと、2.0以降からモデル名を入力するとカラムの一覧も表示される。

<pre lang="ruby">
>> User
=> User(id: integer,  created_at: datetime, updated_at: datetime)
>> User.find(:all)
=> []
>> user = User.new
=> #<user id: nil, created_at: nil, updated_at: nil>
</pre>

<h2>test(or spec)があれば見る *追記08/06/04*</h2>
<blockquote>
できれば「test(or spec)があれば、見ろ」も入れて欲しい。
あれは「どういう挙動をして欲しいか」=「どう使うか」が書いてあるんだから、
どんな構造のアプリなんだか理解する助けになるよ。
てか、ならないなら書く意味ないもの。
</blockquote>
コメント欄での指摘。このエントリを書こうと決めたときは書くつもりだったのに、実際に書いたら忘れてたっていう。

thx、faultier。

<h2>まとめとオマケ</h2>
なんかTips的なエントリになったけど、とりあえずざっと思いついたのはこんな感じ。あとはコントローラのアクションからスタートして、モデルのメソッドや一連の流れを追えばいいんじゃないかな。コントローラーのアクションも上から順に読むよりは、機能ごとの流れで追った方がいいと思う。例えば、new->create->showとかedit->update->showとか。実際はもうちょい複雑な場合もあるだろうけど。実際の流れがどんな風になってるかは実際にアプリを動かしながらURLを確認したり、ログの出力やビューのフォームのアクションを見れば大体わかるはず。

あとはオマケ的な指摘だけど、Railsが2系であればビューファイルの拡張子は「.rhtml」より「.html.erb」の方がいい。この辺はActionPackのマルチビューに関係してる。この辺は初心者のうちはとりあえず「.html.erb」にしとくぐらいでいいと思うし、なによりオレがマルチビューについてまだちゃんと理解してないので詳細ははぶく。ｻｰｾﾝ｡

respond_toは1つのアクションで複数のフォーマットを出力するときに使う。
<pre lang="ruby">
respond_to do |format|
  format.html
  format.xml { render :xml => @user }
end
</pre>
上記のように書くと、ブラウザからの通常アクセス時はhtmlを、WebサービスなどでXMLを指定された場合はXMLを出力する。Webアプリは、例えばブラウザからのアクセスとAPIでのアクセスで、処理は同じだけど出力が違うなんてことがあったりする。そういうときにrespond_toで指定してやることで無闇にアクションを増やさなくてすむ。

<table  border="0" cellpadding="5"><tr><td colspan="2"><a href="http://www.amazon.co.jp/gp/redirect.html%3FASIN=4797336625%26tag=2004-05-22%26lcode=xm2%26cID=2025%26ccmID=165953%26location=/o/ASIN/4797336625%253FSubscriptionId=0G91FPYVW6ZGWBH4Y9G2" target="_top">Railsレシピブック 183の技</a><img src='http://www.assoc-amazon.jp/e/ir?t=2004-05-22&l=ur2&o=9' width='1' height='1' border='0' alt='' /></td></tr><tr><td valign="top"><a href="http://www.amazon.co.jp/gp/redirect.html%3FASIN=4797336625%26tag=2004-05-22%26lcode=xm2%26cID=2025%26ccmID=165953%26location=/o/ASIN/4797336625%253FSubscriptionId=0G91FPYVW6ZGWBH4Y9G2" target="_top"><img src="http://ecx.images-amazon.com/images/I/419FtZYCmyL._SL160_.jpg" border="0" alt="Railsレシピブック 183の技" /></a></td><td valign="top"><font size="-1">高橋 征義<br /><br />ソフトバンククリエイティブ  2008-05-31<br />売り上げランキング : 1080<br /><br /><br /><a href="http://www.amazon.co.jp/gp/redirect.html%3FASIN=4797336625%26tag=2004-05-22%26lcode=xm2%26cID=2025%26ccmID=165953%26location=/o/ASIN/4797336625%253FSubscriptionId=0G91FPYVW6ZGWBH4Y9G2" target="_top">Amazonで詳しく見る</a></font><font size="-2"> by <a href="http://www.goodpic.com/mt/aws/index.html" >G-Tools</a></font></td></tr></table>

<table  border="0" cellpadding="5"><tr><td colspan="2"><a href="http://www.amazon.co.jp/gp/redirect.html%3FASIN=4274066967%26tag=2004-05-22%26lcode=xm2%26cID=2025%26ccmID=165953%26location=/o/ASIN/4274066967%253FSubscriptionId=0G91FPYVW6ZGWBH4Y9G2" target="_top">RailsによるアジャイルWebアプリケーション開発 第2版</a><img src='http://www.assoc-amazon.jp/e/ir?t=2004-05-22&l=ur2&o=9' width='1' height='1' border='0' alt='' /></td></tr><tr><td valign="top"><a href="http://www.amazon.co.jp/gp/redirect.html%3FASIN=4274066967%26tag=2004-05-22%26lcode=xm2%26cID=2025%26ccmID=165953%26location=/o/ASIN/4274066967%253FSubscriptionId=0G91FPYVW6ZGWBH4Y9G2" target="_top"><img src="http://ecx.images-amazon.com/images/I/51Y%2BviLzM5L._SL160_.jpg" border="0" alt="RailsによるアジャイルWebアプリケーション開発 第2版" /></a></td><td valign="top"><font size="-1">前田 修吾 <br /><br />オーム社  2007-10-26<br />売り上げランキング : 8708<br /><br /><strong>おすすめ平均  </strong><img src="http://g-images.amazon.com/images/G/01/detail/stars-5-0.gif" alt="star" /><br /><img src="http://g-images.amazon.com/images/G/01/detail/stars-5-0.gif" alt="star" />充実した内容でわかりやすい<br /><img src="http://g-images.amazon.com/images/G/01/detail/stars-5-0.gif" alt="star" />railsが良いのかrubyが良いのか本が良いのか<br /><img src="http://g-images.amazon.com/images/G/01/detail/stars-5-0.gif" alt="star" />１日に少しの時間で成果が分かる１冊<br /><br /><a href="http://www.amazon.co.jp/gp/redirect.html%3FASIN=4274066967%26tag=2004-05-22%26lcode=xm2%26cID=2025%26ccmID=165953%26location=/o/ASIN/4274066967%253FSubscriptionId=0G91FPYVW6ZGWBH4Y9G2" target="_top">Amazonで詳しく見る</a></font><font size="-2"> by <a href="http://www.goodpic.com/mt/aws/index.html" >G-Tools</a></font></td></tr></table>
</div></article><article><h1><a href="/2008/05/27/rawhide-designer/">2008-05-27 RAWHIDE.ではデザイナを募集しています。</a></h1><hr /><div class="article-body">ども、お久しぶりです。久々のエントリで求人ってのも微妙な感じですが、できるだけ色んな人に見てもらいたいですからねー。そもそもこのブログをデザイナが見てるのかどうかが微妙なのかもしれませんが。

そんな感じでどうぞよろしくですよー(0w0)

<a href="http://blog.raw-hide.jp/wp/?p=371">FIGHT! THE RAWHIDE★ &raquo; デザイナー募集のお知らせ</a>

<h3>募集する職種</h3>
<p>
デザイナー　１名
</p>
<h3>仕事内容</h3>
<p>
企画ごとに編成されるチームの一員として、立ち上げから制作、監修までの一連の業務。
※当面は、ディレクション担当者とともに制作進行していただきます。
</p>
<p>
主に平面デザインが主体です。サイトデザイン、ブログパーツデザイン、キャラクターデザイン、など、企画にあがったプロダクト全般のデザインを担当していただきます。
</p>
<p>
FlashオーサリングやHTML+CSSコーディングなどはチームメンバーに担当者がおりますので経験なくとも協力しながら作業をすすめることが可能です。
</p>
<h3>対象となる方</h3>
<p>
専門学校、短大、大学にてグラフィックデザインの教育を受けたデザインの経験者。（アシスタント経験も可）
WEB制作ソフト、グラフィック制作ソフトの知識経験は必須です。
</p>
<h3>ご用意いただくもの</h3>
<ul>
<li>エントリーシート（履歴書・職務経歴書など）</li>
<li>ポートフォリオ（作品集）</li>
</ul>

<h4>ポートフォリオ（作品集）について</h4>
<p>
CD-RかDVDのデータ、または出力書類にてA3サイズまでの封筒で提出してください。
WEBの場合は、URLをエントリーシート内に明記してください。
もしくは画面キャプチャをプリントしてご用意ください。
</p>
<p>
作品については返却しませんので大切なものはコピーなど複製したものをご提出ください。
</p>

<h3>個人情報の取り扱いについて</h3>
<p>応募者情報につきましては、厳重に管理いたします。</p>
<p>
当該個人情報は、採用選考および入社手続きに必要な範囲で利用し、
法令で定められる場合、安全管理処置を講じた委託先に業務委託をする場合をのぞき、
ご本人の同意なく、他の目的では利用することはありません。
</p>
<p>
なお、お送りいただいた各種書類およびデータは、返却いたしませんのでご了承ください。
</p>
<p>
不採用とさせていただいた場合は、選考終了後適切な方法にて破棄いたします。
</p>
</div></article><article><h1><a href="/2008/03/14/autotest_for_macbook/">2008-03-14 MacBookにRailsの自動テスト環境を構築した</a></h1><hr /><div class="article-body">なんかautotestが流行りつつある今日この頃ですが、みなさまいかがお過ごしでしょうか。とりあえず丁度うちの会社でも自動テストしようかーみたいな話がでてたので構築してみましたよ!

<h2>ZenTestのインストール</h2>
とりあえずは定番のZenTest(autotest)とRedGreen(結果の色付け)をインストールします。

<pre lang="bash">
$ sudo gem install ZenTest
$ sudo gem install RedGreen
</pre>

次にautotestの設定ファイルの作成。example_dot_autotest.rbのパスは人によって違うと思うので適当に読み替えてください。

<pre lang="bash">
cp /opt/local/lib/ruby/gems/1.8/gems/ZenTest-3.9.1/example_dot_autotest.rb ~/.autotest
</pre>

~/.autotestの15行目のコメントアウトを解除。

<pre lang="ruby">
require 'autotest/redgreen'
</pre>

RAILS_ROOTでautotestを実行。起動時に全部のテストを実行するのでちょっとだけ重くなるかもしれません。それ以降はテストファイルやモデル、コントローラファイルなどを修正する度に該当のテストが走ります。

<pre lang="bash">
$ cd RAILS_ROOT
$ autotest
</pre>

実行するテストはtest/unit、もしくはRailsにRSpecが入れてあればRspecのテストを実行します。

なんかspec_serverを立ち上げておくと処理が早くなるらしいですがよくわかってないです。まぁとりあえず設定しといて損はなさそうです。

<pre lang="bash">
$ vi spec/spec.opts # 最下行に --drb を追記。drbでテスト用サーバへ繋ぐようになります。
$ ruby script/spec_server
</pre>

テストの結果は成功なら緑色のバーが、失敗なら赤色のバーが表示されます。

<h2>結果通知用にGrowlとScreenの設定をする</h2>

これでも自動テストは走るので問題ないですが、結果を見るのがちょっと面倒ですね。ということでGrowlとScreenで結果が見えるようにしましょう。

screenの場合は<a href="http://kakutani.com/20070912.html#p02">角谷さんのエントリーを</a>見るといいと思います。基本的にそのまま~/.autotestにコピペするだけで問題ないはずです。

<pre lang="ruby">
require 'autotest/screen'   # コメントアウトを外す

Autotest::HOOKS.delete(:interrupt)
Autotest::Screen.statusline = %q[|%c %m/%d|%w %=]

class Autotest::Screen
  SCREEN_COLOR[:green] = 'gw'
  SCREEN_COLOR[:yellow] = 'yk'

  Autotest.add_hook :run_command do |at|
    message 'Running' if execute?
  end

  Autotest.add_hook :quit do |at|
    clear if execute?
  end

  Autotest.add_hook :ran_command do |at|
    return unless execute?
    results = [at.results].flatten.join("¥n")
    output = results.slice(/(¥d+)¥sexamples?,¥s*(¥d+)¥s.*failures?(?:,¥s*(¥d+)¥s.*pendings?)?/)
    if output
      ex,fail,pend = $~.captures.map {|e| e.to_i}
      if 0 < fail
        message "FAIL #{ex}ex, F:#{fail} ", :red
      elsif 0 < pend
        message "Pend #{ex}ex, F:#{fail} P:#{pend}", :yellow
      else
        message "All Green #{ex}ex", :green
      end
    end
  end
end
</pre>

この設定でscreenとautotestを起動しておくと、ステータスバーの右側にテストの結果が表示されます。

<img src="http://img.skitch.com/20080314-d6gq6bsmbbxh99ynx349bfcckf.jpg" alt="autotest"/>

これ貼ってから気づいたけど、Terminalから透けてみえる絵がなんかあれですなw

次にGlowlの設定ですが、Leopardではruby-growlのインストールが必要っぽいです。とりあえずmacportsからインストールしておきましょう。それとGrowlの設定でリモートを許可しておきましょう。

<pre lang="bash">
$ sudo port install ruby-glowl
</pre>

<img src="http://img.skitch.com/20080314-r92e97nip77qfj7u4p2a1ch8e6.jpg" alt="Growl"/>

Growlで結果を通知するにはgrowlnotifyのインストールが必要です。もしインストールしていなければ<a href="http://growl.info/">本家</a>からdmgファイルをDLし、その中にあるinstall.shを実行します。

<pre lang="bash">
$ cp -r /Volumes/Growl\ 1.1.2/Extras/growlnotify ~/tmp
$ cd ~/tmp/growlnotify
$ sudo ./install.sh
$ growlnotify -m "hoge" # growlの通知が表示されればインストール完了
</pre>

~/.autotestを修正し、glowlで結果が通知されるようにします。

<pre lang="ruby">
require 'autotest/glowl' # コメントアウトを解除
</pre>

これでテストが失敗したとき、失敗から成功になったときにGrowlが通知してくれます。Growlの見た目を変更しようと思ったけれど、個人的にscreenだけで十分だったので今回はナシ。

とりあえず自動テストはテストを書くのが楽しくなりますな。オススメ。
</div></article><article><h1><a href="/2008/03/04/from_unittest_to_rspec/">2008-03-04 test/unitで書いたテストにRSpecでテストを追記する方法</a></h1><hr /><div class="article-body">10分ぐらい調べて試してみただけだけど。

<pre lang="ruby">
require 'rubygems'
require 'test/unit'
require 'spec'

class TestArray < Test::Unit::TestCase

  # test/unit
  def test_1
    assert_equal(0, Array.new.size)
  end

  # rspec
  describe Array, "when empty" do
    before do
      @empty_array = []
    end

    it "should be empty" do
      @empty_array.should be_empty
    end

    it "should size 0" do
      @empty_array.size.should == 0
    end

    after do
      @empty_array = nil
    end
  end
end
</pre>

<pre lang="bash">
$ ruby test.rb
....

Finished in 0.007974 seconds

4 examples, 0 failures
</pre>

RSpecの方のテストはるびまの角谷さんの<a href="http://jp.rubyist.net/magazine/?0021-Rspec">記事</a>から拝借しました。

spceをrequireして、クラスに書きこんでいけばよさそう。仕事だとtest/unitで書いてしまったテストも多いだろうから、test/unitからRSpecに移行するのにいいかもしれない。
</div></article><article><h1><a href="/2008/03/01/rawhide/">2008-03-01 RAWHIDE.入社のお知らせ</a></h1><hr /><div class="article-body">こんばんわ、UKです。

実は2月22日に今まで勤務していた会社を退職しました。ついったーやmixiでつながっている人達は知ってたかもですが。

で、新しい職場ですが実は年末から話がすすんでおり(これも一部の人達は知ってたかもですね)、この度3月1日付けで正式にRAWHIDE.に入社することになりました。わーい。

<a href="http://blog.raw-hide.jp/wp/?p=336">FIGHT! THE RAWHIDE★ » RAWHIDE.に入社しました。</a>

早くRAWHIDE.の一員、戦力として役立てるよう頑張る所存です。よろしくお願いします。

<a href="http://twitter.com/Hamachiya2/statuses/742737192">オマケ</a>: こないだ出社したときの話です。ふふふ・・・
</div></article><div class="pager"><ul><li class="previous"><a href="/page/29/">Prev</a></li><li class="next"><a href="/page/31/">Next</a></li></ul></div></div></body></html>