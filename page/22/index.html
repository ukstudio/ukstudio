<!DOCTYPE html><html><head><meta charset="utf-8" /><!--Always force latest IE rendering engine or request Chrome Frame--><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><!--Use title if it's in the page YAML frontmatter--><title>ukstudio.jp</title><link href="http://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet" type="text/css" /><link href="/stylesheets/normalize.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/all.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/highlight.css" media="screen" rel="stylesheet" type="text/css" /><script src="/javascripts/all.js" type="text/javascript"></script><link href="/feed.xml" rel="alternate" title="atom" type="application/atom+xml" /><script type="text/javascript">var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-12755601-1']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></head><body class="page page_22 page_22_index"><div class="cointainer-fluid"><div class="navbar navbar-default" role="navigation"><div class="container-fluid"><div class="navbar-header"><a class="navbar-brand" href="/">UKSTUDIO</a></div><div class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a href="http://twitter.com/ukstudio">Twitter</a></li><li><a href="http://github.com/ukstudio">GitHub</a></li></ul></div></div></div></div><div class="container"><article><h1><a href="/2009/04/14/accepts_nested_attributes_for/">2009-04-14 accepts_nested_attributes_forしたモデルの日本語化</a></h1><hr /><div class="article-body">名前、長いよね。accepts_nested_attributes_for。以下、ネストしたって言います。長いので。

最近はもっぱら日本語化はi18nにしてるんですが、今回ちょこっとこのネスト関係ではまったのでメモ。

<script src="http://gist.github.com/94931.js"></script>

とりあえずモデルの作成までガッとやります。Railsのバージョンは2.3.2です。最下行はgemのインストールが必要です(<a href="http://github.com/amatsuda/i18n_generators/tree/master">http://github.com/amatsuda/i18n_generators/tree/master</a>)

<script src="http://gist.github.com/94933.js"></script>
<script src="http://gist.github.com/94934.js"></script>

それぞれアソシエーションとバリデーションのコードを追記しておきます。当然、accepts_nested_attributes_forの記述も必要です。その辺の詳細は省くので適当にググってみてください。

で、日本語化はモデルを作成した後に行なっているのでとりあえずカラムは日本語化されてる筈です。その辺の詳細も省きます。

<script src="http://gist.github.com/94935.js"></script>

されてるはずなのですが、一部日本語化されてない箇所があるのでこれを日本語化させます。

<script src="http://gist.github.com/94936.js"></script>

userモデルのところにentries_xxxが追記されています。ちなみにhas_oneの場合はentry_xxxになります。xxxはカラム名。

<script src="http://gist.github.com/94937.js"></script>

おわり。
</div></article><article><h1><a href="/2009/04/06/vim_mtl/">2009-04-06 Vim勉強会 in MTLで話してきました</a></h1><hr /><div class="article-body"><a href="http://atnd.org/events/482">Vim勉強会 in MTL : ATND</a>
当日の<a href="http://www.lingr.com/room/vim_mtl/archives/2009/04/03">Lingrのログ</a>と<a href="http://www.flickr.com/photos/iandeth/sets/72157616306681532/">写真</a>と<a href="http://www.ustream.tv/channel/vimmtl20090403">録画</a>

録画はあまり質に期待しないでとのこと(見てない)

<h2>便利なVimスクリプトやTips紹介 id:iandeth</h2>
タイトル通り便利なTipsの紹介。個人的には今回の勉強会に参加してくれた人達を見ると、これぐらいの内容が丁度よかったのかなーって思う。おれのはちょっと調子に乗りすぎたw

<h2><de>Vim捌きを上達させる、たったひとつの冴えたやり方</del>至高のエディタには、至高のキーボード id:ursm</h2>
Vim勉強会なのにVimの話を一切しないという荒技。4万円ぐらいのキーボードの営業してました。フットペダル欲しいです。

<h2>Vim Script DE OOP id:ukstudio</h2>
とりあえず<a href="http://www.slideshare.net/ukstudio/vim-de-oop">資料</a>

完全に参加者置いてけぼりの発表内容でした。まぁネタだからいいんです。Vim ScriptでOOPはネタです。

Vim Scriptは名前空間とスクリプトローカルなスコープとかがあるのである程度規模が大きくてもなんとかなるので、無理矢理OOPする必要ないです。

if_rubyもOOPできるというよりはVim Scriptヨクワカラナイヨーな人が気軽にスクリプト書きたい時にちょこちょこっと使うってのが多いんじゃないですかね。if_rubyのプラグインってほとんどみないいし。ujihisaのmixi.vimだっけ、そこらへんの連投スクリプトぐらい。

今回のはどっちかというと僕個人がおれおれOOPというかそゆのをVim Scriptで作るのが楽しかったという理由だけでこの内容をチョイスしました。 ちなみにVim Scriptはスコープや可変長引数の文法がパッと見わかりづらいですけど、慣れればそんな難しい言語ではないですよ。一度挑戦してみるといいと思います。

<h2>懇親会</h2>
懇親会ではピザを食べながら適当に談笑しつつ、Rails.vimやオススメのプラグイン教えてと言われたので適当にプロジェクタ使って話してました。以下プラグインのリスト。

<h3><a href="http://www.vim.org/scripts/script.php?script_id=1567">Rails.vim</a></h3>
VimでRails開発するなら必須です。最初はとりあえず:Rcontroller, :Rmodel, :Rviewとgf、:Rpartialあたり使っておけばいいんじゃないでしょうか。

<h3><a href="http://www.vim.org/scripts/script.php?script_id=294">Align.vim</a></h3>
整形したいコードをヴィジュアルモードなどで選択して,t=とかやると=でキレイに並べてくれます。コードの整形にこだわりのある人へ。

:[Range]Align=>とかやると複数の文字(この例だと=>)で整形できます。これはid:ursmさんに教えてもらいました。

<h3><a href="http://www.vim.org/scripts/script.php?script_id=2290">smartchr.vim</a></h3>
id:haltさんの記事を読むといいと思います。

<a href="http://project-p.jp/halt/anubis/blog_show/1068">smartchrというvim pluginが簡単便利で目ウロコ - /halt/Snapshot</a>

<h3><a href="http://www.vim.org/scripts/script.php?script_id=1984">fuzzyfinder.vim</a></h3>
バッファで開いてるファイルとか最近使ったファイルとかを開くのに便利です。コマンド呼び出すのは面倒なので適当にマッピングして使いましょう。

<blockquote>
nmap fb :FuzzyFinderBuffer<cr>
nmap ff :FuzzyFinderFile<cr>
nmap fm :FuzzyFinderMruFile<cr>
</blockquote>

これtaku-oさんの<a href="http://d.hatena.ne.jp/taku-o/20090404/1238829761">指摘</a>で気づきましたけど、fがもろに被ってますね。よい子は他のキーにマッピングしましょう。

<h3><a href="http://github.com/Shougo/neocomplcache/blob/master/presen/neocomplcache.txt">neocomplecache.vim</a></h3>
autocomplpop.vim的な補完プラグインです。詳細はとりあえずリンク先を見ればいいと思います。

<a href="http://www.lingr.com/room/vim-users.jp">vim-users.jpのlingr</a>に作者がいるので興味がある人、物申したい人は来たらいいんじゃないでしょうか。


<h2>永和システムマネジメント及びMTLの皆様に感謝</h2>
今回はちょっとしたことがきっかけで勉強会を行うことになったわけですが、永和システムマネジメントの角谷さん、MTLの石橋さん、小林さん他、このような場を提供して頂きありがとうございました!

また、ATNDを見る限り50人弱の人に参加して頂いたようなのですが、お忙しいところありがとうございました。

またどこか別の機会がありましたらよろしくお願いします。

追記: 永和システムマネジメントを永和マネージメントシステムと誤表記していました。ごめんなさい。
</div></article><article><h1><a href="/2009/02/27/ducktyping/">2009-02-27 RubyでDuckTyping</a></h1><hr /><div class="article-body">今日、知人に「DuckTypingのメリットが今一ピンとこない」と言われて実際にコード書いて説明をしたのだけれども、せっかくなのでエントリにまとめる。

DuckTypingとは、動的言語の柔軟性を表現する概念で以下の格言に由来する。

<blockquote>
    "If it walks like a duck and quacks like a duck, it must be a duck"
（もしもそれがアヒルのように歩き、アヒルのように鳴くのなら、それはアヒルである）
</blockquote>

つまり、アヒルのように振る舞うものは、実際にそれが何であろうとアヒルと見なすということになる。

もうちょっと言語よりな言い方をするのであれば、あるオブジェクトどのクラスに属するか考慮せず、どのようなインターフェースを持つかに注目するのがDuckTyping。

DuckTypingにおいて重要なことは「明示的な型チェックを避ける」と言うことで、どう言うことかと言うと

<script src="http://gist.github.com/70902.js"></script>

上記のようなコードを書いてしまうと、Duckクラスもしくはそれらを継承したクラスしか扱えなくなり、動的言語のメリットが失われてしまう。

その知人に紹介した簡単なDuckTypingの例が以下。

<script src="http://gist.github.com/70734.js"></script>

ここではwriteメソッドさえあれば、渡されたオブジェクトが何かは問わない。これをもうちょっと実際に使うようなコードに書き直すと以下のようになる。

<script src="http://gist.github.com/70911.js"></script>

やっていることは、ほとんどwrite_messageと同じだけど、こちらの方がまだピンとくると思う。Loggerはログを書き出すだけの簡単なクラスだが、DuckTypingを用いることによって、その書き出し先を柔軟に変更することができる。

実際はどんなオブジェクトが渡されるかわからないのでrespond_to?でメソッドの有無のチェックぐらいはした方がいい。

<script src="http://gist.github.com/70918.js"></script>

エラー処理をもうちょっと別の方法を取ってみる。

<script src="http://gist.github.com/70969.js"></script>

こちらの方法を取ると、仮に呼び出したメソッド内で例外が発生した場合もうまく処理することができる。個人的には大体こちらの手段を取ることが多い。

結構長くなったけど、大体こんな感じ。DuckTypingは慣れない人からするとよくわからないところも多いと思うけど、うまく使えれば結構便利な機能。使いすぎは禁物だけどうまく使っていくといいだろう。
</div></article><article><h1><a href="/2009/02/24/file_column_name_error/">2009-02-24 Rails2.0.2から2.2.2に上げたらFileColumnがNameErrorだした。</a></h1><hr /><div class="article-body">自分の担当している案件のRailsのバージョンを2.0.2から2.2.2に上げたら以下のようなエラーが発生。
<blockquote>
uninitialized constant FileColumn::ClassMethods::Inflector (NameError)
</blockquote>

これの対応は/vender/plugin/file_column/lib/file_column.rbの以下の部分を
<pre lang="ruby">
my_options = FileColumn::init_options(options,
                                                 Inflector.underscore(self.name).to_s,
                                                 attr.to_s)
</pre>

以下のように書き換えればとりあえず対応できる。

<pre lang="ruby">
my_options = FileColumn::init_options(options,
                                                 self.name.to_s.underscore,
                                                 attr.to_s)
</pre>

ちゃんちゃん。
</div></article><article><h1><a href="/2009/01/14/vim_tips/">2009-01-14 覚えとくと便利かもしれないVimのTips</a></h1><hr /><div class="article-body">適当に思い付いたものを書いてみる。

<h2>CTRL-X CTRL-L</h2>
行単位での補完。まぁ該当の行でyyしてpして貼り付けでもいいかもしれないけど、移動するの面倒な場合もあるし。

以下、自分のvimrcで「n CTRL-X CTRL-L」した例。

<a href="http://ukstudio.jp/wp-content/uploads/2009/01/c-xc-l.jpg"><img src="http://ukstudio.jp/wp-content/uploads/2009/01/c-xc-l.jpg" alt="" title="c-xc-l" width="300" height="234" class="alignnone size-medium wp-image-294" /></a>

ちなみに俺がこれを一番使うときはRSpecのdescribeの行を補完する時かな。こんな感じ。

<pre lang="ruby">
describe "hogehoge" do
end

desCTRL-X CTRL-L
↓
describe "hogehoge" do
</pre>

んで、hでちょこちょこっと"の中に移動してdi"で"の中を削除する感じ。

<h2>di"</h2>
こっそり上で登場してるけど"で囲まれた文字列をd(削除)する。da"だと"も含めて削除。ちなみにこれはテキストオブジェクトっていうVim7からの機能で他にも色々パターンがあって、個人的にVimの機能の中でも特別気に入っている。ちゃんと説明すると長いのでいくつか例だけ示す。

<dl>
<dt>di"</dt>
<dd>"の中を削除</dd>
<dt>da"</dt>
<dd>"も含めて削除</dd>
<dt>yi"</dt>
<dd>"の中をコピー</dd>
<dt>ya"</dt>
<dd>"も含めてコピー</dd>
<dt>di(</dt>
<dd>()の中を削除</dd>
<dt>da(</dt>
<dd>()も含めて削除</dd>
<dt>di{</dt>
<dd>{}の中を削除</dd>
<dt>da{</dt>
<dd>{}も含めて削除</dd>
</dl>

<h2>gf</h2>
カーソル以下のファイル名を開いてくれる。requireやinclude、ファイルをオープンしたりする処理のところで便利。

<pre lang="ruby">
require "hoge"
</pre>

hogeのところでgfするとhoge.rbを開く。

<h2>CTRL-AとCTRL-X</h2>
VimM#3でamachangが感動してた気がする。カーソル以下の数字をインクリメントとデクリメントしてくれる。ちゃんと1000とかも1001や999にしてくれるよ。マクロで多用するかも。

<h2>guuとgUUと~</h2>
guuはカーソル行の文字を全部小文字に、gUUは全部大文字に。~はカーソル以下の文字を小文字なら大文字に、大文字なら小文字に。

書いといてなんだけどあまり使った記憶ないな、これ。

<h2>:!</h2>
:!を使うと外部コマンドを叩くことができる。単体だと結果を返すだけなので頭に.(ドット)を付けて結果を挿入したりする。単体で使うときはlsの結果を見るときが多いかも。一々screenのウィンドウを移動しなくて済む。なんか段々書くのが面倒になってきたので例で示す。

<strong>追記</strong>: kanaさんより指摘がありました。挿入はr!〜ですね。

<blockquote>
> 単体だと結果を返すだけなので頭に.(ドット)を付けて結果を挿入したりする。
嘘。:{range}!{cmd}はフィルタリング。結果的にそうなるケースはあるけれど意味は違う。本当に挿入するなら:r!{cmd} (:read !{cmd})。
</blockquote>
<dl>
<dt>:!ls ~</dt>
<dd>ls ~の結果が表示される</dd>
<dt>:.!date </dt>
<dd>date結果が挿入される</dd>
<dt>:%!sort</dt>
<dd>今開いてるファイルをsortした結果に書き変わる</dd>
<dt>:%!grep hoge</dt>
<dd>hogeが含む行だけに書き変わる</dd>
<dt>:!ruby -c %</dt>
<dd>今開いてるファイルをrubyの構文チェックに通す。PHPとかでも似たようなことができる</dd>
</dl>
</div></article><div class="pager"><ul><li class="previous"><a href="/page/21/">Prev</a></li><li class="next"><a href="/page/23/">Next</a></li></ul></div></div></body></html>