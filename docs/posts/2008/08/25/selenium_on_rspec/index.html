<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="utf-8">
<meta name="generator" content="Hugo 0.17" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="//fonts.googleapis.com/css?family=Roboto:400,700" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/github.min.css">
<link rel="stylesheet" href="/css/normalize.css">
<link rel="stylesheet" href="/css/skeleton.css">
<link rel="stylesheet" href="/css/custom.css">
<link rel="alternate" href="/index.xml" type="application/rss+xml" title="UKSTUDIO">
<title>Selenium on Rspecを軽く試してみた - UKSTUDIO</title>
</head>
<body>

<div class="container">

	<header role="banner">
		<div class="header-logo">
			<a href="/"><img src="/images/icon.png" width="60" height="60" alt="UKSTUDIO"></a>
		</div>
		
	</header>


	<main role="main">
		<article itemscope itemtype="http://schema.org/BlogPosting">
			<h1 class="entry-title" itemprop="headline">Selenium on Rspecを軽く試してみた</h1>
			<span class="entry-meta"><time itemprop="datePublished" datetime="2008-08-25">August 25, 2008</time></span>
			<section itemprop="entry-text">
				<p>とりあえずはScaffoldで簡単なアプリを作って、そのテストケースを作成、実行してみるところまで。そんな難しいことはしない。Railsは2.0.2を使用。2.1だとSeleniumにパッチを当てなきゃいけないので面倒。2.1の人は<a href="http://clearspace.openqa.org/docs/DOC-1072">Selenium on Rails patch for RoR 2.1</a>からパッチをあててください。</p>

<p><h3>準備</h3>
まずは準備としてプラグインのインストールと、Scaffoldで簡単なアプリを作成する。
<pre lang="ruby">
$ rails <em>2.0.2</em> blog
$ cd blog
$ ruby script/plugin install <a href="http://svn.openqa.org/svn/selenium-on-rails/selenium-on-rails">http://svn.openqa.org/svn/selenium-on-rails/selenium-on-rails</a>
$ ruby script/generate scaffold entry title:string description:text
$ rake db:migrate
</pre></p>

<p>ここまでできたらtest環境でサーバーを起動し、seleniumがちゃんと起動するか確認する。
<pre lang="ruby">
$ ruby script/server -e test
</pre></p>

<p>そうすると下記エラーがでるが、sessionをデータベースであつかうように変更するととりあえず回避できる。原因はよくわかんない。
<blockquote>
CGI::Session::CookieStore::TamperedWithCookie in SeleniumController#support_file
</blockquote></p>

<p>sessionをデータベースで扱うようにするにはconfig/environment.rbの47行目のコメントアウトをはずし、migrateする。
<pre lang="ruby">
config.action_controller.session_store = :active_record_store
</pre></p>

<pre lang="bash">
$ rake db:sessions:create
$ rake db:migrate
$ rake db:test:prepare
$ ruby script/server -e test
</pre>

<p>ブラウザで<a href="http://localhost:3000/selenium/を表示して以下のような画面になればOK。">http://localhost:3000/selenium/を表示して以下のような画面になればOK。</a></p>

<p>[caption id=&ldquo;attachment_171&rdquo; align=&ldquo;alignnone&rdquo; width=&ldquo;300&rdquo; caption=&ldquo;Selenium初期画面&rdquo;]<a href="http://ukstudio.jp/wp-content/uploads/2008/08/init-selenium.jpg"><img src="http://ukstudio.jp/wp-content/uploads/2008/08/init-selenium.jpg" alt="Selenium初期画面" title="Selenium初期画面" width="300" height="240" class="size-medium wp-image-171" /></a>[/caption]</p>

<p><h3>テストケースの作成</h3>
次にテストケースを作成する。SeleniumはテストケースをHTMLで書くので手書きでも書けるけど、面倒なのでFirefoxのaddonの1つ、<a href="https://addons.mozilla.org/ja/firefox/addon/2079">Selenium IDE</a>を使用する。</p>

<p>Selenium IDEを使用すると、自分の操作を記録しそのままテストケースに変換できるので非常にラク。Selenium IDEを開き、右上の赤いボタンを押すと操作の記録が始まる。あとはテストしたい操作を手動で行なえばいい。</p>

<p>[caption id=&ldquo;attachment_177&rdquo; align=&ldquo;aligncenter&rdquo; width=&ldquo;242&rdquo; caption=&ldquo;Selenium IDE&rdquo;]<a href="http://ukstudio.jp/wp-content/uploads/2008/08/selenium-ide.jpg"><img src="http://ukstudio.jp/wp-content/uploads/2008/08/selenium-ide.jpg" alt="Selenium IDE" title="Selenium IDE" width="242" height="300" class="size-medium wp-image-177" /></a>[/caption]</p>

<p>今回のテストは「/entriesにアクセスし、そこから/entries/newに移動、タイトルと詳細を入力・保存し、/entries/showでタイトルが実際に表示されている」という内容にした。基本的には記録ボタンを押し、そのまま普通に入力していけばいい。最期の「タイトルが実際に表示されている」というものに関しては文言を範囲選択し、右クリックしverifyTextPresentを選択すればいい。</p>

<p>[caption id=&ldquo;attachment_180&rdquo; align=&ldquo;aligncenter&rdquo; width=&ldquo;251&rdquo; caption=&ldquo;verityTextPresent&rdquo;]<a href="http://ukstudio.jp/wp-content/uploads/2008/08/selenium-ide-veritytextpresent1.jpg"><img src="http://ukstudio.jp/wp-content/uploads/2008/08/selenium-ide-veritytextpresent1.jpg" alt="verityTextPresent" title="verityTextPresent" width="251" height="300" class="size-medium wp-image-180" /></a>[/caption]</p>

<p>ここまでできたらもう一度赤いボタンを押し、操作の記録を終了させる。最期に今の操作をテストケースとして出力させればいい。</p>

<p>出力方法はIDEのウィンドウにフォーカスを合わせて、ファイル &gt; テストケースに名前をつけて保存。ここではファイル名はadd_entryとしといた。本来なら命名規約的なものもあった方がいいかもしれないけどここでは気にしないことにする。保存先はseleniumに読み込ませるため、RAILS_ROOT/test/selenium/以下に保存。</p>

<p>以上でテストケースの作成は完了。</p>

<p><h3>テストの実行</h3>
もう一度<a href="http://localhost:3000/selenium/を開くと、今つくったテストケースが読み込まれているはず。あとはそのテストを右側のSelenium">http://localhost:3000/selenium/を開くと、今つくったテストケースが読み込まれているはず。あとはそのテストを右側のSelenium</a> TestRunnerから実行すると、ブラウザがガチャガチャ動いてテストケースを実行してくれる。</p>

<p>今回はさっきのテストケースを作ってから何も変更を加えていないので、オールグリーンになるはず。</p>

<p><h3>まとめ</h3>
かなり単純なケースだけど、大体テストケースの作成から実行までを試してみた。まぁとりあえず導入してみるには丁度いいレベルかなと。Selenium IDEを使用すればプログラマ/エンジニアじゃなくてもテスト書けそうだし。</p>

<p>あとは確かSelenium on Railsの機能にfixturesのロード機能とかあった気がするので、その辺りも調べていきたいと思う。</p>

			</section>
		</article>
	</main>


	<footer role="contentinfo">
		<div class="hr"></div>
		<div class="footer-link">
			
			<a href="https://twitter.com/ukstudio" target="_blank">Twitter</a>
			
			<a href="https://github.com/ukstudio" target="_blank">GitHub</a>
		</div>
		<div class="copyright">Copyright &copy; AKAMATSU Yuki All rights reserved</div>
	</footer>

</div>



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

</body>
</html>
