<!doctype html>
<html prefix="og: http://ogp.me/ns#">
  <head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-9XZH9K61N7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-9XZH9K61N7');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="og:image": content="https://ukstudio.jp/assets/images/ukstudio.jpg">
    <meta name="og:site_name" content="ukstudio.jp">
    <meta name="og:type" content="article">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:image": content="https://ukstudio.jp/assets/images/ukstudio.jpg">
    
    <meta name="og:title" content="RSpec - ukstudio">
    <title>RSpec - ukstudio</title>
    

    <link rel="icon" type="image/x-icon" href="/assets/images/favicon.ico">
    <link href="/assets/stylesheets/styles.css" rel="stylesheet">
    <script src="//instant.page/5.1.1" type="module" integrity="sha384-MWfCL6g1OTGsbSwfuMHc8+8J2u71/LA8dzlIN3ycajckxuZZmF+DNjdm7O6H3PSq"></script>
  </head>
  <body class="md:text-base text-sm">
    <div class="container max-w-screen-lg mx-auto py-4 px-4">
      <header>
        <a href="/" class="font-extrabold text-lg no-underline">ukstudio</a>
      </header>
      <main class="flex">
        <article class="flex-1 max-2-3xl">
          <header>
            <h1 class="mb-0">RSpec</h1>
            <p class="mt-0" style="color: #999">Updated on Jun  7, 2024</p>
          </header>
          <section class="article-body break-all">
            <ul>
<li><a href="https://rspec.info/">RSpec: Behaviour Driven Development for Ruby</a></li>
</ul>
<p>2024年現在、<a href='/ruby/'>Ruby</a>のデファクトスタンダード的なテスティングフレームワーク。BDDと言ってはいるものの、BDD自体がややこしい言葉になっている今となってはあまりBDDとかは関係なく使っているユーザーが多いと思われる。</p>
<p>BDDについてはかなり昔に <a href='/bdd-personal-summary/'>BDDについて自分なりにまとめてみた</a> という記事を書いているのでそちらもどうぞ。</p>
<h2>Tips</h2>
<p>以下Tipsというかメモ。</p>
<h3>let!とインスタンス変数を組み合わせるとき初期化タイミングに注意</h3>
<pre style="background-color:#2b303b;"><code class="language-ruby"><span style="color:#c0c5ce;">let!(</span><span style="color:#a3be8c;">:var</span><span style="color:#c0c5ce;">) { @</span><span style="color:#bf616a;">var </span><span style="color:#c0c5ce;">}
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">before </span><span style="color:#b48ead;">do
</span><span style="color:#c0c5ce;">  @</span><span style="color:#bf616a;">var </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">1
</span><span style="color:#b48ead;">end
</span><span style="color:#c0c5ce;">
</span><span style="color:#c0c5ce;">it { expect(var).to eq </span><span style="color:#d08770;">1 </span><span style="color:#c0c5ce;">} </span><span style="color:#65737e;">#=&gt; 失敗する。varが返す値はnil
</span></code></pre>
<p><code>let!</code>は内部的には<code>before</code>と<code>let</code>の組み合せである。また、<code>before</code>は基本的に上から順に実行される。つまり、この場合<code>@var = 1</code>より前に<code>let!</code>による<code>@var</code>への参照が発生するが、値は設定されていないため<code>nil</code>が設定される。</p>
<h2>参考情報</h2>
<ul>
<li><a href="https://github.com/willnet/rspec-style-guide">willnet/rspec-style-guide: 可読性の高いテストコードを書くためのお作法集</a></li>
<li><a href="https://onk.hatenablog.jp/entry/2023/02/26/221616">RSpec では context 間の違いを表現するときにのみ let を使う - id:onk のはてなブログ</a></li>
<li><a href="https://blog.onk.ninja/2017/12/13/rspec_shigusa">Rails Developers Meetup 2017 で RSpec しぐさについて話した - onk.ninja</a></li>
</ul>

          </section>
        </article>
        <aside class="w-64 pl-8 md:block hidden">
          <h2 class='mt-0'>Backlinks</h2>
          
            <ul>
              
                <li>
                  <a href="/ruby/">Ruby</a>
                </li>
              
            </ul>
          
        </aside>
      </main>
    </div>
  </body>
</html>
