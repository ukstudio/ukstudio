<!DOCTYPE html><html><head><meta charset="utf-8" /><!--Always force latest IE rendering engine or request Chrome Frame--><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><!--Use title if it's in the page YAML frontmatter--><title>The Middleman</title><link href="http://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet" type="text/css" /><link href="/stylesheets/normalize.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/all.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/highlight.css" media="screen" rel="stylesheet" type="text/css" /><script src="/javascripts/all.js" type="text/javascript"></script><link href="/feed.xml" rel="alternate" title="atom" type="application/atom+xml" /><script type="text/javascript">var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-12755601-1']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></head><body class="2008 2008_index"><div class="cointainer-fluid"><div class="navbar navbar-default" role="navigation"><div class="container-fluid"><div class="navbar-header"><a class="navbar-brand" href="/">UKSTUDIO</a></div><div class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a href="http://twitter.com/ukstudio">Twitter</a></li><li><a href="http://github.com/ukstudio">GitHub</a></li></ul></div></div></div></div><div class="container"><h1><Archive></Archive>2008</h1><article><h2><a href="/2008/12/31/ruby_book/">2008-12-31 Re:Ruby初心者の2冊目はなに?</a></h2><a href="http://anond.hatelabo.jp/20081230213406">Ruby初心者の２冊目はなに？</a>
<a href="http://d.hatena.ne.jp/z/20081231/1230650467">Rubyの「最初の二冊目」は何?　に答えてみる。 - どんなジレンマ</a>

id:hrkt0115311さんに名前を出してもらったことだし、簡単に紹介しておこうと思う。crossreviewに書いてない本も多いしね。と言うかしょっぱなからそうなんだけど。

<h2>Rubyレシピブック第二版</h2>
<a href="http://www.amazon.co.jp/o/ASIN/4797340045/2004-05-22">Rubyレシピブック第二版</a>

id:hrkt0115311さんもすすめてたけど、たのしいRubyを読んだのならこれもオススメ。大体初心者が思うあれがしたい、これがしたいはここを参照すれば載ってると思う。ただ、なにができるかは書いてあるけど、それらで何かを作る方法は書いてないので作りたいものが曖昧だとこれ1冊だとどうしたらいいかわからなくなるかも。

<h2>Rubyで作る奇妙なプログラミング言語</h2>
<a href="http://www.amazon.co.jp/o/ASIN/4839927847/2004-05-22">Rubyで作る奇妙なプログラミング言語</a>

そこでオススメするのがこの「Rubyで作る奇妙なプログラミング言語」。この本1冊あればRubyで言語を実装できるようになる。もちろんタイトルにある通り「奇妙なプログラミング言語」をだけど。もしBrainfuckと言った奇妙な言語を触ったこともない、聞いたこともないと言うのならそれらを知る意味でもこの本をオススメしておく。Brainfuck楽しいよ、Brainfuck。

<h2>初めてのRuby</h2>
<a href="http://www.amazon.co.jp/exec/obidos/ASIN/4873113679/2004-5-22/">初めてのRuby</a>

これまたid:hrkt0115311-22さんと被ってるけど、オススメなのだから仕方がない。まぁ初心者の二冊目としては難しい部類かもしれないが、ある程度Rubyに慣れてきたら読んでみるといいと思う。

ちなみにRubyにも当然<a href="http://www.ruby-lang.org/ja/man/html/index.html">マニュアルが存在する</a>が、初心者が読むには正直内容が難しい。この本を読めばマニュアルが読めるようになると著者のyuguiさんも言っていた記憶があるので、マニュアルの前にこちらを読むことをオススメする。

追記: るりま(Rubyリファレンスマニュアル)の知名度が低いそうなのでリンクを載せておく。まぁメンテされてるのはこっちのはずだから本来はこっちを載せるべきだったのかもしれない。thx Sixeight。
<a href="http://doc.loveruby.net/wiki/">るりまWiki</a>

<h2>恋するプログラム</h2>
<a href="http://www.amazon.co.jp/o/ASIN/4839917299/2004-05-22">恋するプログラム</a>

yharaさんの「Rubyで作る奇妙なプログラミング言語」と同様にこちらも何かを作ることを題材としている。内容も人工無脳を作るというものなのでプログラマなら少なからず心魅かれると思う。まぁちょっと内容が古いかもしれないけど。

だがしかし。これ多分もう売ってないと思う。残念至極。ちょっと前にこの本の出版に関わった人から「復活させたいんだけどねー」と聞いた記憶があるが今のところ特に予定はなさそうだ。

<h2>Enjoy Programming!!</h2>

まぁ大体こんなものか。一応Railsの本ははずしたけど、Webアプリ作りたいなら苦労を知らないとフレームワークの仕組みがわからないとか変に考えずとりあえずやってみればいいと思う。仕組みは後からでもいくらでも学べるし。

とは言うものの、プログラミング自体が初心者のようだからWebプログラミングみたいに言語以外の知識が必要となるものを最初にやろうとすると混乱しがちなのでとりあえずはRubyを中心に学べばいいと思う。Webアプリを作る以外にもプログラミングを楽しむ方法はいくらでもあるし。

Enjoy Programming!!
</article><hr /><article><h2><a href="/2008/12/18/vimrc_reading/">2008-12-18 第1回vimrc読書会が開催されるそうです。</a></h2><a href="http://vim.g.hatena.ne.jp/ka-nacht/20081218/1229529163">第1回vimrc読書会開催のお知らせ</a>

だそうです。おもしろそうだなー、参加したいなーとか思ってたら

<blockquote>
肴rc
    id:ukstudioのvimrc
</blockquote>

おれのだ!

当日はtwitterの関西忘年会の二次会真っ最中な気がするけど、イーモバイルで繋げられそうだったら繋げよう。
</article><hr /><article><h2><a href="/2008/12/08/action-coding/">2008-12-08 JRubyとProcessing1.1でaction-coding!</a></h2>せっかくProcessingも正式版になったことだし、少しaction-codingで遊んでみる。

まずはJRubyをインストール。面倒なのでバイナリで。環境はMac OSX 10.5.5。

<a href="http://dist.codehaus.org/jruby/">http://dist.codehaus.org/jruby/</a>からjruby-bin-1.1.5.tar.gz(バージョンは適宜読み替え)をダウンロード。現時点では1.1.5をインストールしておけば大丈夫だろう。解凍したら適当な位置に移動。

<pre lang="bash">
$ tar zxvf jruby-bin-1.1.5.tar.gz
$ sudo mv jruby-bin1.1.5 /usr/local/bin
</pre>

次にパスを通す。

<pre lang="zsh">
export JRUBY_HOME=/usr/local/bin/jruby-1.1.5
export PATH=/opt/local/ghc/bin:/opt/local/bin:/opt/local/sbin:/usr/local/bin:$JRUBY_HOME/bin:$PATH
</pre>

PATHは環境によって違うと思うので適当に読み替え。sourceで読み込ませてjrubyコマンドが使えればOK。

<pre lang="bash">
$ source ~/.zshrc
$ jruby -v
jruby 1.1.5 (ruby 1.8.6 patchlevel 114) (2008-11-03 rev 7996) [i386-java]
</pre>

次にaction-codingをインストールする。基本的には<a href="http://code.google.com/p/action-coding/wiki/Tutorial">チュートリアル</a>に従っておけばいい。一点だけProcessing1.0からファイルの位置が変っているので以下の作業がいる。Processingのパスは普通にインストールしていれば同じだと思うけど、違う場合は適宜読み替えで。

<pre lang="bash">
$ pushd /Applications/Processing.app/Contents/Resources/Java/lib
$ cp ../core.jar .
$ popd
</pre>

最後に、config.yamlの修正。

<pre lang="ruby">
p5home: /Applications/Processing.app/Contents/Resources/Java
</pre>

これでサンプルのアプリケーションが実行できるはず。

<pre lang="bash">
 jruby aco.rb examples/basics/arrays/array_objects.rb
</pre><a href="http://ukstudio.jp/wp-content/uploads/2008/12/array_objects.jpg"><img src="http://ukstudio.jp/wp-content/uploads/2008/12/array_objects.jpg" alt="" title="array_objects" width="300" height="253" class="alignnone size-medium wp-image-270" /></a>

後はチュートリアルに従って、サンプルを修正してリアルタイムに変更が反映されるのを楽しみつついろいろ弄ればいいんじゃないかな。(setup内の編集だけは、ウィンドウにフォーカスをあててCmd+rもしくは、Ctrl+rでリロードが必要)

結構、変更がリアルタイムに反映されていくのは楽しい。スケッチっていう観点からしたらわざわざビルドするより、こっちの方が気楽でいいよね。

<iframe src="http://rcm-jp.amazon.co.jp/e/cm?t=2004-05-22&o=9&p=8&l=as1&asins=4873113784&md=1X69VDGQCMF7Z30FM082&fc1=000000&IS2=1&lt1=_blank&m=amazon&lc1=0000FF&bc1=000000&bg1=FFFFFF&f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe>

<iframe src="http://rcm-jp.amazon.co.jp/e/cm?t=2004-05-22&o=9&p=8&l=as1&asins=4861005582&md=1X69VDGQCMF7Z30FM082&fc1=000000&IS2=1&lt1=_blank&m=amazon&lc1=0000FF&bc1=000000&bg1=FFFFFF&f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe>
</article><hr /><article><h2><a href="/2008/11/27/mac_gem_install_mysql/">2008-11-27 Macでgem install mysqlをする方法</a></h2>Rails2.2からmysqlのアダプタが付属していないので各個人でインストールする必要があります。gemで入れようとするとエラーがでると思うので以下のように対応してください。

<pre lang="bash">
$ sudo gem install mysql
$ cd /opt/local/lib/ruby/gems/1.8/gems/mysql-2.7/
$ sudo ruby extconf.rb --with-mysql-config=/opt/local/lib/mysql5/bin/mysql_config
$ sudo make
$ sudo make install
</pre>

パスに関しては、人によって違うかもしれませんが適宜読み替えてください。

追記

<pre lang="bash">
$ sudo gem install mysql -- --with-mysql-config=/opt/local/lib/mysql5/bin/mysql_config
</pre>

これでも大丈夫らしい。
</article><hr /><article><h2><a href="/2008/11/26/rails_22_i18n/">2008-11-26 Rails2.2のi18n(国際化)を簡単に試してみた</a></h2>11月21日にRails2.2が正式リリースされた。 RCなどでチェックしてた人は既に知っているかもしれないけど、2.2からデフォルトでi18n(国際化)対応がされている。

ちなみにi18nというのはinternationalizationの頭と後ろのiとn、文字数が18文字というところから来てるらしい。

とりあえず、まずはアプリの作成。

<pre lang="bash">
$ rails i18n_demo
</pre>

作成されたファイル群の中にconfig/locales/en.ymlというファイルが出来ていると思うけど、これが翻訳ファイルになる。今回は英語と日本語を用意しようと思うので、en.ymlをコピーしてja.ymlを作成する。

<pre lang="bash">
$ cp config/locales/en.yml config/locales/ja.yml
</pre>

翻訳ファイルを修正しようにも、そもそもアプリケーションが出来ていないので、scaffoldで簡単に作ってしまおう。

<pre lang="bash">
$ ruby script/generate scaffold entry title:string body:text
$ rake db:migrate
</pre>

とりあえずは適当にサイトタイトル的なものでも作ってみよう。翻訳ファイルに関しては元々あった内容は削除してしまっていい。

<pre lang="ruby">
# config/locales/ja.yml
ja:
  site_title: サイトタイトル
</pre>

一応英語も。

<pre lang="ruby">
# config/locales/en.yml
en:
  site_title: SiteTitle
</pre>

Viewの修正。

<pre lang="ruby">
# app/views/entries/index.html.erb
<h1>translation missing: en.site_title</h1>
</pre>

この状態でサーバーを起動し、http://localhost:3000/entriesにアクセスしてみる。「SiteTitle」という文字が表示されているはずだ。この状態だとまだ言語がデフォルトの英語の設定になっている。多分、ブラウザの言語設定とかは見てなさげ?。ちょっとソースを見てないのでまだ未確認。もしかしたら、リクエストのヘッダーを見て言語を決める部分は自分で実装しなきゃいけないのかもしれない。

なんにせよ、日本語で表示したい場合は以下のようにする。

<pre lang="ruby">
# config/environment.rb
# 最下行に追加
I18n.default_locale = "ja"
</pre>

これで再度アクセスすれば「サイトタイトル」と表示されているはずだ。

次にGETパラメータで言語が切り替わるようにしてみよう。

<pre lang="ruby">
# app/controllers/application.rb

before_filter :set_locale
def set_locale
  I18n.locale = params[:locale]
end
</pre>

これでhttp://localhost:3000/entries?locale=enで「SiteTitle」と表示されているはずだ。

次にモデルの日本語化をしてみよう。まずはエラーメッセージを出すためにバリデーションを追加する。

<pre lang="ruby">
# app/model/entry.rb
class Entry < ActiveRecord::Base
  validates_presence_of :title, :body
end
</pre>

http://localhost:3000/entry/newでフォームに何も入力せず送信すればエラーがでるので英語で表示されていることを確認する。

<a href="http://ukstudio.jp/wp-content/uploads/2008/11/082611_i18n_en_error.jpg"><img src="http://ukstudio.jp/wp-content/uploads/2008/11/082611_i18n_en_error.jpg" alt="" title="082611_i18n_en_error" width="300" height="281" class="alignnone size-medium wp-image-257" /></a>

普通のバリデーションのエラーとは違うエラーがでているけど、これは翻訳ファイルをちゃんと書いてないからでているエラー。英語の方はちょっと面倒なので無視するが、とりあえず日本語化をすすめる。

<pre lang="ruby">
#config/locales/ja.yml
ja:
  site_title: サイトタイトル
    activerecord:
      errors:
        template:
          header: "{{model}}でエラーが発生しました。"
          body:   以下のエラー内容を確認してください。
        messages:
          blank:  が空白です。
      models:
        entry: エントリー
      attributes:
        entry:
          title: タイトル
          body: 本文
</pre>

以上の修正をして、もう一度エラーを出してみるとエラーが日本語に変わっているはずだ。翻訳ファイルのどの部分がどの部分に対応してるかは雰囲気でわかると思う。

<a href="http://ukstudio.jp/wp-content/uploads/2008/11/081126_i18n_ja_error.jpg"><img src="http://ukstudio.jp/wp-content/uploads/2008/11/081126_i18n_ja_error.jpg" alt="" title="081126_i18n_ja_error" width="300" height="225" class="alignnone size-medium wp-image-258" /></a>

今回は必要な部分だけ翻訳したけど、もうちょっとちゃんとした翻訳ファイルが必要なら<a href="http://i18n-demo.phusion.nl/pages/setup">Railsをローカライズする</a>も参考にするといいと思う。

諸々めんどくせー!って人は松田さんの<a href="http://blog.dio.jp/2008/11/22/japanizing-rails-2-2-by-i18n-generators">Rails 2.2の I18nによる日本語化を最も簡単に行う方法</a>へどうぞ。gemで一発です。

まだ2.2はリリースされたばかりで、i18nまわりの日本語の情報はあまり多くはないと思うけど、そこまで複雑な仕組みでもないし、翻訳ファイルに関して言えば基本的な部分(ActiveRecordとか)は使い回しができるので手間もそこまで大きくはないと思う。ブラウザの言語設定での判断もそのうちプラグインがでてくるんじゃないかと思っている。

「国際化とか必要ないよー」の人も、バリデーションのエラーを日本語化するのにgettextを入れる必要がなくなったりとこれでかなりラクになるんじゃなかろうか。
</article><hr /><article><h2><a href="/2008/11/23/vimm3-2/">2008-11-23 VimM#3を開催してきました</a></h2>﻿﻿﻿﻿﻿﻿﻿﻿﻿本日、VimM#3を東京大学秋葉原キャンパスにて開催してきました。協力頂いた、星さん、笹田さんありがとうございました。また、参加頂いたみなさん、本当にありがとうございました。グダグダな部分もありましたが、無事終えることができました。

以下、簡単な感想。

<h2>Vimで効率的なテキスト編集 - ukstudio</h2>
自分の発表。相変わらず準備不足・・・とりあえず資料。


なるべく、チュートリアルに載っていなくて初心者が知らなそうなものをいくつか選んだつもりだったけど、ちょっと微妙だったかも。

<h2>マクロ - taku-o</h2>
<a href="http://nanasi.jp/">名無しのvim使い</a>のtaku-oさんによるマクロの説明。

実はマクロとか全然使ったことがなかったので参考になりました。なんとなくマクロは避けてた、と言うよりは無理に触れようとしてなかったんだけど仕組み自体は簡単そうなのでちょっと使っていこうかなと。とりあえずこう言うのは無理にでも書かないと感覚が掴めなさそうなのでちょっと頑張る。

<h2>俺の.vimrcを見ろ!PHP使いの為の設定プラグイン - halt</h2>
PHPerである<a href="http://project-p.jp/halt/">halt</a>さんによる発表。

「武士にとっての刀」というフレーズがおれの発表と丸被りで焦ったw autocomplpop.vimの紹介も実は簡単にしようかなと思っていたのだけど、こちらは省いたおかげで被らずに済んだ・・・

PHPのマニュアルをVimのヘルプにコンバートはいいアイディアだなと思った。確かにマニュアルを見るときはプログラミングを書いてるときなので、その方が手間は少なそう。
<h2>operator. the true power of Vim - kana</h2>
<a href="http://whileimautomaton.net/">kana</a>さんによる発表。

Vimの習熟度によってLv0〜Lv7を定義。ちなみにおれはLv3でした。ビジュアルモードを使わなくなってやっとLv4らしい。あとテキストオブジェクトやばい。ライフチェンジン>グとは聞いていたけど、なかなか馴染めなくて後回しにしてたせいで結局身についてない・・・

とりあえず、ap、ipから覚えることにした。ちなみにLv7は1年じっくりVimを使えば辿りつけるらしい。

<h2>第２部 Q&Aセッション</h2>
Lingrだかどっかでkanaさんがボソっと言ったことにより企画したセッション。会場の人に質問してもらって、会場の人に答えてもらう。

正直、始めるまでは「質問なかったらどうしよう」とビクビクしたけど、正直グダグダなところはありつつも結構盛り上がったようなので良かったのかなと。もうちょっとうまく仕切れたらよかったのだけれど。あとマイクとかはあった方が良かったのかもしれない。

それともったいないなぁと終わったあとに思ったのは、質問内容とそれに対する回答を記録してなかったこと。前で仕切りながらやるのは厳しいので誰かにお願いしとけばよかったのかも。


<h2>謝辞</h2>
何はともあれ、なんとか無事に終えることができました。多数のご参加とご協力ありがとうございました!
</article><hr /><article><h2><a href="/2008/11/14/rubygems_update/">2008-11-14 RubyGemsのupdateの方法が変わっていた</a></h2>せっかくMerb1.0がでたことだしインストールしてみようかと思ったら、gemを1.3以上いれやがれ!と怒られてしまった。それならアップデートするかーと思い、update --systemをやってsuccessと出たはいいけど、gem -vで1.2と表示される。MacPortsの方でアップデートして、1.3入れても-vは1.2でなんぞーとか思っていたらupdateの方法が変わってたみたい。

以下、update手順。

<ol>
<li><a href="http://rubyforge.org/frs/?group_id=126&release_id=16500">RubyForge</a>からrubygems-upate-1.3.1.gemをダウンロード</li>
<li><pre lang="bash">$ sudo gem install rubygems-update-1.3.1.gem</pre></li>
<li>update_rubygemsというコマンドができてるので実行。
<pre lang="bash">$ sudo update_rubygems</pre></li>
<li>完了</li>
</ol>

これで無事、RubyGemsの1.3.1がインストールされた。

<pre lang="bash">
$ gem -v
1.3.1
</pre>

<pre lang="bash">
$ sudo gem install merb
・・・
・・・
37 gems installed
</pre>

これでOK。37gems installedってのも凄いな。
</article><hr /><article><h2><a href="/2008/11/10/skitch/">2008-11-10 Skitchでキャプチャアップロード</a></h2><a href="http://d.hatena.ne.jp/snow-bell/20081110/1226249937">セキュリティの教訓 - snow-bellの日記</a>

snow-bellのところでgyazoのセキュリティが話題になってたので、ちょっとレスもかねてエントリー書く。

<a href="http://skitch.com/">Skitch.com</a>

今、オレが使ってるツールはgyazoじゃなくてSkitchというものを使ってる。デモが上で見れるのでそれを見てもらえばどんなものか大体わかるはず。

基本的な用途は、キャプチャ->編集->アップロード。大体gyazoと同じ。オレがgyazoを使わない理由は、画像の削除と公開範囲が指定できないってところが大きい。嘘です、先にSkitchを使ってたからです。

Skitchでできることは大体下記のとおり。

<ul>
<li>スクリーンキャプチャ</li>
<li>簡単な編集</li>
<li>アップロード</li>
<li>公開(非公開設定も可能)</li>
<li>アップロードした画像の削除</li>
</li>

アップロードした画像はskitch.comにログインすると自分のページから一覧することができる。
<div class="thumbnail"><a href="http://skitch.com/ukstudio/5rxm/skitch-sample"><img src="http://img.skitch.com/20081110-tr84wa9qcxag6cyj23954hfc5g.preview.jpg" alt="skitch-sample" /></a><br /><span style="font-family: Lucida Grande, Trebuchet, sans-serif, Helvetica, Arial; font-size: 10px; color: #808080">Uploaded with <a href="http://plasq.com/">plasq</a>'s <a href="http://skitch.com">Skitch</a>!</span></div>

アップロードした画像にはそれぞれにURLが割り当てられて、コピーしてすぐ使うことができる。

<img src="http://img.skitch.com/20081110-m89den1adars4y7qrahbsakdc2.jpg" alt="skitch-sample2"/>

ちなみにこのエントリーで使った画像もSkitchでキャプチャしたものです。多分、gyazoの方がアップロードの手間は少ないのかもしれないけど、編集(文字入れたいときとかたまにある)や、画像の削除、一覧がラクなのでSkitch愛用してます。
</article><hr /><article><h2><a href="/2008/11/07/vimrc/">2008-11-07 「地味に便利なVim設定」をもうちょい地味に便利にする</a></h2><a href="http://blog.blueblack.net/item_317">地味に便利なVim設定 - ナレッジエース</a>

いくつかもうちょい便利にできるよーってところがあったので書いてみる。

<h2>スペース + wで保存</h2>
別に¥¥で保存でもいいと思うけど、ちょっと指が遠い気がする。ので僕はスペース + wで保存してる。同じ要領でquitも。
<pre lang="vim">
nnoremap <space>w :<c-u>write<cr>
nnoremap <space>q :<c-u>quit<cr>
</pre>

<h2>jとkでカーソルキーを中心に保ってスクロール</h2>
わざわざスペースを使わなくてもできる。gj、gkにしておくと表示行で上下に移動できるので折り返しの行があるときとかに便利。
<pre lang="vim">
nnoremap j gjzz
nnoremap k gkzz
</pre>

ちなみに僕のvimrcはgithubに公開してあるのでよかったら参考にどうぞ。そんな大したものでもないですが。

<a href="http://github.com/ukstudio/config/tree/master">.vimrc at master from ukstudio's config - GitHub</a>
</article><hr /><article><h2><a href="/2008/10/28/todo/">2008-10-28 RTMとか挫折するので自分に合うTODO管理を考えてみた</a></h2>RTMとか今までに数回使おうとして、なぜかいつも使わなくなる。RTM自体は使いやすいんだけど、多分ブラウザベースが合わないんだろう。CUIでタスク管理したい!って思って以前試したけど(名前わすれちゃった)、なんかそれも合わなかった。

んで、今回自分なりに考えたToDo管理は下のような感じ。ちなみにオレの使ってるOSはMacな。Linuxでも大丈夫だと思うけど。windowsはしらん。

<ul>
<li>ToDoの作成は「touch todo名.txt」</li>
<li>ToDoの詳細はそのファイルに書き込めばいい</li>
<li>終わったToDoは「rm todo名.txt」</li>
<li>プロジェクトや階層分けしたかったら「mkdir project名」</li>
<li>オンライン管理はdropboxかgitとか</li>
</ul>

正直、ToDo作るときはブラウザでBTSみながらとか作るので、ブラウザでToDOを作るのは相性が悪い。それに対してMacのTerminalはブラウザとセットで開いてることが多い(webプログラマだからね)、ブラウザで見ながらToDoを作るのは非常にラク。

なにより、touch、rm、mkdir、mvといったコマンドは普段から日常的に使っているのですぐ馴染みそう。あと、この方式の利点はunix系のコマンドが使えることかな。grepとかfindとかsortとか。

オンライン管理はとりあえず必要性を感じてないけれど、最近流行りのdropboxとかgitとかでいいかなと思ってる。変更履歴とか差分とか見たかったらgitだけどそこまでする必要も感じてないし、dropboxでいいのかな。iPhone対応してるらしいし。iPhoneもってないけどさ。

そんな感じでしばらく試してみることにする。
</article><hr /><article><h2><a href="/2008/10/27/xss/">2008-10-27 XSS対策に入力時エスケープは非常にややこしい</a></h2>to-Rさんの<a href="http://blog.webcreativepark.net/2008/10/24-201629.html">XSSの脆弱性を限りなくなくす方法</a>を読んでなんかもにょもにょしたのでエントリーを書く。多分、to-Rさんはこれから書くことに関して理解してて、あの対策を行なってるのかもしれないけど、それでも書く。自分の勉強も兼てるので変なところがあれば教えていただけるとありがたいです。

入力時エスケープは非常に<strong>ややこしい</strong>

確かに、入力値に必ずエスケープしておけば、XSS対策漏れにはなるかもしれない。けれど非常にややこしいことになる。

例えば、受け取ったデータの文字列に対して文字数制限のバリデーションを行なうときにわざわざアンエスケープの処理を行なわないといけないし、DBへの保存の際にもアンエスケープが必要になる。ブログとかでフォームから受け取ったデータのうち、一部のタグは許容するときとかもかな。

<blockquote>
ベストの対策はアプリの性質に合わせたエスケープなんだけども、これって完全になくすにはかなりの几帳面さが必要になるんじゃないかなと思います。(規模が大きくなればなるほど)
</blockquote>

とエントリーでは書かれているけど、この対策が大規模になればなるほどXSSに限らず色々な問題が発生する気がする。大規模であればあるほど、出力箇所をみて「対策されている」というのがわかるのが大事。

コードを書きながら「DBに保存するからアンエスケープ・・・」「スクリプトとして出力するからアンエスケープ」って考えるよりは、「HTMLの出力時にエスケープ」の方がわかりやすいはず。出力時をみればいいんだから。

ちなみにフレームワークやテンプレートエンジンが出力時のエスケープをデフォルトで行なうってのは賛成です。なぜなら使っているフレームワークまたはテンプレートエンジンがエスケープしているということが自明なら、エスケープの有無を確認する必要がなくなるから。PHPとかWeb特化とか言うぐらいなら、デフォルトでエスケープして出力すればいいのにと思う。

なんかXSS対策とかエスケープって言い方がよくない気もするな。普通に「スクリプトを無効にする」とかで良い気がしてきた。スクリプトが有効になるのは、HTML出力時なんだからその時に無効化すればいいよね。

というか、PHPの人はmagick quoteでこりたと思ってたんだけど。

<h2>追記</h2>
ブクマコメ、高木さんより。
<blockquote>
「普通に「スクリプトを無効にする」とかで良い気がしてきた」&lt; XSSはスクリプトだけじゃない。&gt;iframe&lt;の挿入&lt;form&gt;の挿入を考えてみるよろし。CERT CA-2000-02ではXSSと呼ばず「Malicious HTML Tags Embedded in Client Web Requests」と呼んだ
</blockquote>

あー、確かにそうですね。指摘ありがとうございます。Malicious HTML Tags Embedded in Client Web Requestsは初耳でした。
</article><hr /><article><h2><a href="/2008/10/06/vimm3/">2008-10-06 VimM#3開催のお知らせ</a></h2>11月の22日(土)の14時からVimM#3を開催します。

今回のテーマは「脱初心者」ということでなるべくなら初心者の方に来てもらいたいなと思っています。なんかメンバーみると結構「おまえ初心者じゃないだろう!」て人がいるので、負けずに初心者の方もいっぱい来てください。

スピーカーもまだ募集しているので応募お待ちしております。

今回の会場もささださんとほしさんにご協力頂きました。二回連続にわたりありがとうございます。

<a href="http://wiki.livedoor.jp/biowithit/d/VimM%233">VimM#3</a>
</article><hr /><article><h2><a href="/2008/10/04/rails_many_db/">2008-10-04 RailsでMySQLとPostgreSQLを同時に扱う方法(+問題点)</a></h2>プラグインとか無しで、複数のDB(MySQLとPostgreSQL)を扱う方法。Rails2.1でしか試してないけど、多分1.2とかでも大丈夫。多分。MySQLとPostgreSQLの接続ライブラリはgemからインストールしておくこと。

まずは、database.ymlに扱うデータベースの定義を書く。

<pre lang="ruby">
development:
  adapter: mysql
  encoding: utf8
  database: db_development
  username: root
  password:

test:
(面倒だから略)

production:
(面倒だから略)

psql_development:
  adapter: postgres
  encoding: utf8
  database: ma2_mcd
  username: root
  password:

psql_test:
(面倒だから略)

psql_production:
(面倒だから略)

</pre>

次にPostgreSQLに接続させたいモデルを編集する。例えば、ProfileモデルはPostgreSQLの方に接続させたい場合は以下のようになる。

<pre lang="ruby">
class Profile < ActiveRecord::Base
  establish_connection("psql_#{RAILS_ENV}".to_sym)
end
</pre>

establish_connectionにシンボルでdatabase.ymlの定義を渡せば、そのモデルはその定義のデータベースに接続する。本番、テスト、開発でそれぞれ定義が違うだろうから、RAILS_ENVで今起動している環境の定義を呼び出すようにしてやる。

<h2>追記</h2>
上記の設定で一応アプリは動作するけど、いくつか問題点があるのでそれをメモしておく。

<h3>マイグレーションの使い分けはどうする</h3>
例えば、db/migrateにcreate_hoge_for_psql.rb(数値は略)とcreate_foo_for_mysql.rbと合った場合、それをどう実行するかが問題になってくる。

普通にrake db:migrateやrake db:migrate RAILS_ENV=psql_developmentとやったら、hogeとfooが両方とも作られてしまう。こちらとして望んでるのは、hogeがPostgreSQLのみ、fooがMySQLのみにできて欲しい。

うーむ、弱った。
</article><hr /><article><h2><a href="/2008/09/19/no_use_number_prime/">2008-09-19 数字を使わずに素数判定</a></h2>86のSkypeチャットで話題になったのでちょこちょこっと書いた。普通にループして比較するだけお。もっといい方法あるんだろうけど、とりあえずはよしとする。

<pre lang="ruby">
class Integer
  def prime?
    return false if self.zero? || self == [[]].size
    ([[],[]].size...self).each do |i|
      return false if (self%i).zero?
    end
    true
  end
end
</pre>

suztomoのやつ。
<a href="http://d.hatena.ne.jp/suztomo/20080918/1221746629">http://d.hatena.ne.jp/suztomo/20080918/1221746629</a>
</article><hr /><article><h2><a href="/2008/09/18/firefox_addon/">2008-09-18 Firefoxの拡張の整理</a></h2>1つ前の記事でプロファイルの使い分けの設定をしたけど、整理もかねて~/Library/Application Support/Firefoxを削除して、1から構築しなおした。

<h2>拡張のインストール</h2>
<h3>開発/普段共通</h3>
<dl>
<dt>Nightly Tester Tools</dt>
<dd>今、メインに使っているのがShiretoko(Firefox3.1α2)なので、これを入れないと動かない拡張が多い</dd>
<dt>Vimperator</dt>
<dd>Firefoxをvimみたいに操作。もうこいつがないと生きていけない体になってしまった。</dd>
<dt>XUL/Migemo</dt>
<dd>Vimpでmigemo_hint.jsを使うために。</dd>
<dt>GreaseMonkey</dt>
<dd>あんまりグリモンは使っていなくてAutopagerizeぐらいかな。でも必須。</dd>
</dl>

<h3>開発</h3>
<dl>
<dt>Web Developer</dt>
<dd>HTMLやCSSいじったりするときに。ブロック要素の枠表示が一番使用率高いかも。</dd>
<dt>Firebug</dt>
<dd>JavaScriptを書くときに。Inspect Element(日本語だと要素を表示とかだっけ?)が地味に便利。</dd>
<dt>Live HTTP Headers<dt>
<dd>ブラウザがどんなリクエストを送って、どんなレスポンスを受けとってるか調べるときに。HTTPステータスとか。</dd>
<dt>HTML Validator</dt>
<dd>名前のとおり。タグの閉じ忘れとかもわかる。</dd>
<dt>SQLite Manager</dt>
<dd>RailsでたまにSQLiteを使うのでその時に。</dd>
<dt>SeleniumIDE</dt>
<dd>Seleniumのテストケースを作る時に。ブラウザが勝手に動くのはおもしろい。</dd>
<dt>RestTest</dt>
<dd>RESTアプリのテストに。GET/POST/PUT/DELETEのヘッダを偽装。</dd>
</dl>

大体こんな感じか。普段は基本的に閲覧しかしないので、vimpとグリモンがあればOK。他の拡張はほとんど開発のときにしか使わないので、必要なときだけ読み込めばいい。

vimpのプラグインと設定ファイルに関しては、<a href="http://github.com/ukstudio/config/tree/master">githubに置いてある</a>ので、それをもってくるだけ。

とりあえずこんなもんかなー。
</article><hr /><article><h2><a href="/2008/09/18/firefox/">2008-09-18 MacでFirefoxのプロファイルの使い分けと別バージョンの同時起動をする</a></h2>Firefoxのプロファイルの使い分け(普段用/開発用)と別バージョン(2.0と3.1)の同時起動がしたかったのでちょっと設定してみた。

<h2>プロファイルの作成</h2>
まずは使い分けるためのプロファイルを作成する。今回作成したのは以下の3つ。
<ul>
<li>Firefox3.1</li>
<li>Firefox3.1_development</li>
<li>Firefox2.0</li>
</ul>

プロファイルの作成の仕方はTerminalから-Pオプションを付けて、Firefoxを起動させればいい。

<pre lang="bash">
$ /Applications/Firefox.app/Contents/MacOS/firefox -P
</pre>

プロファイルマネージャーが開くのでそこで「新しいプロファイルを作成」を選び、わかりやすいように名前をつける。

<h2>起動コマンドの作成</h2>
プロファイルを指定して起動させるには-P "プロファイル名"のオプションを付ける必要がある。毎回Terminalで指定して起動させるのも手間なので、起動コマンド用に3つ程ファイルを作成する。(後でapp化する)

ちなみにこんなことしなくても、複数のプロファイルがあれば起動時に使用するプロファイルを聞かれるので必要ない人は別にしなくても大丈夫。

<h3>Firefox3.1普段用</h3>
<pre lang="shell">
#!/bin/sh

/Applications/Shiretoko.app/Contents/MacOS/firefox -P Firefox3.1 &
exit 0
</pre>

<h3>Firefox3.1開発用</h3>
<pre lang="shell">
#!/bin/sh

/Applications/Shiretoko.app/Contents/MacOS/firefox -P Firefox3.1_development &
exit 0
</pre>

<h3>Firefox2.0</h3>
<pre lang="shell">
#!/bin/sh

/Applications/Firefox.app/Contents/MacOS/firefox -P Firefox2.0 -no-remote &
exit 0
</pre>

Firefox2.0のにだけ、-no-remoteオプションが付いているのは、同時起動を想定している為。別のバージョンを同時に起動する場合は、大抵は最初に起動しておく方は-no-remoteオプションは無し、後から起動する方に-no-remoteオプションを付けるようにしておけばいい。
<h2>app化</h2>
起動コマンドを作ったところで、せっかくなのでそれをapp化する。

app化に関しては<a href="http://www.pqrs.org/tekezo/macosx/doc/makeapp/">[Mac OS X] シェルスクリプトとかの CUI アプリケーションを Mac OS X 方式の .app にする方法 [簡単 5 ステップ]</a>を参照。

上記エントリのcore.shの部分をさっき作った起動コマンドスクリプトに置き換えればOK。Firefoxのアイコンは/Applications/Firefox.app/Contents/Resources/firefox.icnsを使用。Shiretokoのアイコンを使いたければ、/Applications/Shiretoko.app/(ry から取ってくればいい。

あとはapp化したのを直接クリックするなり、QuickSilverから呼びだすようにしておけばいい。

<table  border="0" cellpadding="5"><tr><td colspan="2"><a href="http://www.amazon.co.jp/Firefox-Hacks-Mozilla%E3%83%86%E3%82%AF%E3%83%8E%E3%83%AD%E3%82%B8%E5%BE%B9%E5%BA%95%E6%B4%BB%E7%94%A8%E3%83%86%E3%82%AF%E3%83%8B%E3%83%83%E3%82%AF-%E6%B1%9F%E6%9D%91-%E7%A7%80%E4%B9%8B/dp/487311375X%3FSubscriptionId%3D0G91FPYVW6ZGWBH4Y9G2%26tag%3D2004-05-22%26linkCode%3Dxm2%26camp%3D2025%26creative%3D165953%26creativeASIN%3D487311375X" target="_blank">Firefox 3 Hacks Mozillaテクノロジ徹底活用テクニック</a><img src='http://www.assoc-amazon.jp/e/ir?t=2004-05-22&l=ur2&o=9' width='1' height='1' border='0' alt='' /></td></tr><tr><td valign="top"><a href="http://www.amazon.co.jp/Firefox-Hacks-Mozilla%E3%83%86%E3%82%AF%E3%83%8E%E3%83%AD%E3%82%B8%E5%BE%B9%E5%BA%95%E6%B4%BB%E7%94%A8%E3%83%86%E3%82%AF%E3%83%8B%E3%83%83%E3%82%AF-%E6%B1%9F%E6%9D%91-%E7%A7%80%E4%B9%8B/dp/487311375X%3FSubscriptionId%3D0G91FPYVW6ZGWBH4Y9G2%26tag%3D2004-05-22%26linkCode%3Dxm2%26camp%3D2025%26creative%3D165953%26creativeASIN%3D487311375X" target="_blank"><img src="http://ecx.images-amazon.com/images/I/41664CPo6pL._SL160_.jpg" border="0" alt="Firefox 3 Hacks Mozillaテクノロジ徹底活用テクニック" /></a></td><td valign="top"><font size="-1">江村 秀之<br /><br />オライリージャパン  2008-08-27<br />売り上げランキング : 11045<br /><br /><br /><a href="http://www.amazon.co.jp/Firefox-Hacks-Mozilla%E3%83%86%E3%82%AF%E3%83%8E%E3%83%AD%E3%82%B8%E5%BE%B9%E5%BA%95%E6%B4%BB%E7%94%A8%E3%83%86%E3%82%AF%E3%83%8B%E3%83%83%E3%82%AF-%E6%B1%9F%E6%9D%91-%E7%A7%80%E4%B9%8B/dp/487311375X%3FSubscriptionId%3D0G91FPYVW6ZGWBH4Y9G2%26tag%3D2004-05-22%26linkCode%3Dxm2%26camp%3D2025%26creative%3D165953%26creativeASIN%3D487311375X" target="_blank">Amazonで詳しく見る</a></font><font size="-2"> by <a href="http://www.goodpic.com/mt/aws/index.html" >G-Tools</a></font></td></tr></table>
</article><hr /><article><h2><a href="/2008/09/09/firefox3_1/">2008-09-09 Firefoxα2とβ1preを試してみた</a></h2>いつのまにかFirefoxのα2とβ1preがリリースされてたので試してみた。個人的にVimpとかグリモンがないとどうにもならない体になってしまったので<a href="https://addons.mozilla.org/ja/firefox/addon/6543">Nightly Tester Tools</a>をインストール。これで3.01で動いていた拡張は大体動く模様。

それとTraceMonkeyを使えるようにするためabout:configを開いて、「jit」で検索。2項目ほどヒットするので、それぞれの値をfalseからtrueに変更する。これでTraceMonkeyはONになるみたい。

使ってみた感想をざっと過剰書きであげてみると

<ul>
<li>レンダリングが結構向上しているのが体感でわかる。</li>
<li>Mac版FirefoxのFLAHの日本語入力問題が解決してるっぽい。</li>
<li>β1preでLDRを開いたらちゃんと表示されなかった。α2は大丈夫。</li>
<li>Ctrl+Tabがかっこいい。でもvimp使ってると関係ない話。</li>
</ul>

ざっとこんな感じ。レンダリングの向上がかなりうれしい。今のところβの方でLDRが表示できなかったこと以外特に問題は起きていない。まぁLDRが見れないのは致命的なのでとりあえずα2の方を使っていこうと思う。

TraceMonkeyに関しては、オン、オフそれぞれ試したけど普通に使っている分には違いがわからなかった。オフでも十分はやくなっている。ベンチマークをとったらもしかしたら違うのかもしれないけど。

なんにせよ、個人的には今回のα2とβ1preには非常に満足しているので、正式リリースが楽しみになってきた。

<a href="http://developer.mozilla.org/devnews/index.php/2008/09/05/firefox-31-alpha-2-now-available-for-download/">Mozilla開発者向け公式ブログの記事</a>
<a href="ftp://ftp.mozilla.org/pub/firefox/nightly/latest-trunk/">Firefox3.1β1pre</a>
<a href="https://wiki.mozilla.org/JavaScript:TraceMonkey#Playing_with_TraceMonkey">TraceMonkeyの有効化</a>
</article><hr /><article><h2><a href="/2008/09/07/vimm_railsvim/">2008-09-07 VimM#2でRails.vimについて話してきました</a></h2><a href="http://wiki.livedoor.jp/biowithit/d/VimM%232">VimM#2</a>

とりあえず資料。正直、これだけ見てもさっぱりな資料だとは思いますがw


Vimの人達の集りでRails.vimというRails使う人限定のプラグインの話はどうなんだろーとか思っていたけど、結構Rails使ってる人いたみたいでよかった。

発表内容自体はかなりgdgdというか、伝えたいことをうまく伝えられなかったなーと言った感じ。やっぱり事前に練習しとくべき。あとは慣れかなー。しばらくは積極的に発表する側で頑張りたい。

それと、RSpecの具体的な対応については<a href="http://ukstudio.jp/2008/06/05/rails_vim_rspec/">rails.vimのファイル切り替えをRSpecに対応させる(仮)</a>を参照。

それにしても、エディタ1つで4時間(懇親会含めるともっとある)発表があって、それに40人集まるってのもすごい話だ。

あと、VimMのMはみみのMらしいです。VimM#2はmickey24がうさみみをつけて主催するそうです。期待。
</article><hr /><article><h2><a href="/2008/08/31/web_design_questionnaire/">2008-08-31 wuたんのWebデザインに関するアンケートにご協力を。</a></h2><strong>結果が公開されています</strong>
<a href="http://3ping.org/2008/08/31/0120">Webデザインに関するアンケート結果</a>
<hr />

<a href="http://3ping.org/2008/08/31/0120">Web デザインに関するアンケートにご協力ください - 3ping.org</a>

このブログはWebデザイナよりは、プログラマ、エンジニアと言った方が多いと思うのですが、よろしかったらご協力お願いします。以下のフォームからでも回答可能です。結果は公開してもらえるようです。よろしくお願いします。

<div style="margin: 1em 20px; border: 7px solid #eee; padding: 20px;"><iframe src="http://spreadsheets.google.com/embeddedform?key=pqZ008056mIlxmXskWwiMbg" width="310" height="1319" frameborder="0" marginheight="0" marginwidth="0">読込中...</iframe></div>
</article><hr /><article><h2><a href="/2008/08/25/selenium_on_rspec/">2008-08-25 Selenium on Rspecを軽く試してみた</a></h2>とりあえずはScaffoldで簡単なアプリを作って、そのテストケースを作成、実行してみるところまで。そんな難しいことはしない。Railsは2.0.2を使用。2.1だとSeleniumにパッチを当てなきゃいけないので面倒。2.1の人は<a href="http://clearspace.openqa.org/docs/DOC-1072">Selenium on Rails patch for RoR 2.1</a>からパッチをあててください。

<h3>準備</h3>
まずは準備としてプラグインのインストールと、Scaffoldで簡単なアプリを作成する。
<pre lang="ruby">
$ rails _2.0.2_ blog
$ cd blog
$ ruby script/plugin install http://svn.openqa.org/svn/selenium-on-rails/selenium-on-rails
$ ruby script/generate scaffold entry title:string description:text
$ rake db:migrate
</pre>

ここまでできたらtest環境でサーバーを起動し、seleniumがちゃんと起動するか確認する。
<pre lang="ruby">
$ ruby script/server -e test
</pre>

そうすると下記エラーがでるが、sessionをデータベースであつかうように変更するととりあえず回避できる。原因はよくわかんない。
<blockquote>
CGI::Session::CookieStore::TamperedWithCookie in SeleniumController#support_file
</blockquote>

sessionをデータベースで扱うようにするにはconfig/environment.rbの47行目のコメントアウトをはずし、migrateする。
<pre lang="ruby">
config.action_controller.session_store = :active_record_store
</pre>

<pre lang="bash">
$ rake db:sessions:create
$ rake db:migrate
$ rake db:test:prepare
$ ruby script/server -e test
</pre>

ブラウザでhttp://localhost:3000/selenium/を表示して以下のような画面になればOK。

[caption id="attachment_171" align="alignnone" width="300" caption="Selenium初期画面"]<a href="http://ukstudio.jp/wp-content/uploads/2008/08/init-selenium.jpg"><img src="http://ukstudio.jp/wp-content/uploads/2008/08/init-selenium.jpg" alt="Selenium初期画面" title="Selenium初期画面" width="300" height="240" class="size-medium wp-image-171" /></a>[/caption]

<h3>テストケースの作成</h3>
次にテストケースを作成する。SeleniumはテストケースをHTMLで書くので手書きでも書けるけど、面倒なのでFirefoxのaddonの1つ、<a href="https://addons.mozilla.org/ja/firefox/addon/2079">Selenium IDE</a>を使用する。

Selenium IDEを使用すると、自分の操作を記録しそのままテストケースに変換できるので非常にラク。Selenium IDEを開き、右上の赤いボタンを押すと操作の記録が始まる。あとはテストしたい操作を手動で行なえばいい。

[caption id="attachment_177" align="aligncenter" width="242" caption="Selenium IDE"]<a href="http://ukstudio.jp/wp-content/uploads/2008/08/selenium-ide.jpg"><img src="http://ukstudio.jp/wp-content/uploads/2008/08/selenium-ide.jpg" alt="Selenium IDE" title="Selenium IDE" width="242" height="300" class="size-medium wp-image-177" /></a>[/caption]

今回のテストは「/entriesにアクセスし、そこから/entries/newに移動、タイトルと詳細を入力・保存し、/entries/showでタイトルが実際に表示されている」という内容にした。基本的には記録ボタンを押し、そのまま普通に入力していけばいい。最期の「タイトルが実際に表示されている」というものに関しては文言を範囲選択し、右クリックしverifyTextPresentを選択すればいい。

[caption id="attachment_180" align="aligncenter" width="251" caption="verityTextPresent"]<a href="http://ukstudio.jp/wp-content/uploads/2008/08/selenium-ide-veritytextpresent1.jpg"><img src="http://ukstudio.jp/wp-content/uploads/2008/08/selenium-ide-veritytextpresent1.jpg" alt="verityTextPresent" title="verityTextPresent" width="251" height="300" class="size-medium wp-image-180" /></a>[/caption]

ここまでできたらもう一度赤いボタンを押し、操作の記録を終了させる。最期に今の操作をテストケースとして出力させればいい。

出力方法はIDEのウィンドウにフォーカスを合わせて、ファイル > テストケースに名前をつけて保存。ここではファイル名はadd_entryとしといた。本来なら命名規約的なものもあった方がいいかもしれないけどここでは気にしないことにする。保存先はseleniumに読み込ませるため、RAILS_ROOT/test/selenium/以下に保存。

以上でテストケースの作成は完了。

<h3>テストの実行</h3>
もう一度http://localhost:3000/selenium/を開くと、今つくったテストケースが読み込まれているはず。あとはそのテストを右側のSelenium TestRunnerから実行すると、ブラウザがガチャガチャ動いてテストケースを実行してくれる。

今回はさっきのテストケースを作ってから何も変更を加えていないので、オールグリーンになるはず。

<h3>まとめ</h3>
かなり単純なケースだけど、大体テストケースの作成から実行までを試してみた。まぁとりあえず導入してみるには丁度いいレベルかなと。Selenium IDEを使用すればプログラマ/エンジニアじゃなくてもテスト書けそうだし。

あとは確かSelenium on Railsの機能にfixturesのロード機能とかあった気がするので、その辺りも調べていきたいと思う。
</article><hr /><article><h2><a href="/2008/08/13/ruby_on_rails_partial/">2008-08-13 Railsのpartialの使い方</a></h2>あまりpartialをちゃんと使いこなせていない気がするので(いつもインスタンス変数で適当に値わたしてる)使い方をちょっとメモ。

<pre lang="ruby">
render :partial => 'entry'
</pre>

一番基本となるpartialの使い方。_entry.html.erbを描画。

<pre lang="ruby">
render :partial => 'entry', :locals => {:title => "タイトル"}
</pre>

localsでpartial側に値を渡す。partial側ではローカル変数titleで文字列"タイトル"を参照できる。

<pre lang="ruby">
render :partial => 'entry', :object => @object
render :partial => @entry # インスタンス変数で単数形
</pre>

objectでpartial側に値を渡す。@objectの内容をpartial側でローカル変数entryで参照できる。

<pre lang="ruby">
render :partial => 'entry', :collection => @objects
render :partial => @entries # インスタンス変数で複数形
</pre>

collectionで値を渡す。@objectsの値を1つずつ、partial側でentryとして参照できる。もちろん描画は@objects分繰り返される。
</article><hr /><article><h2><a href="/2008/08/08/quill/">2008-08-08 Quillリリースおめでとうございます</a></h2><a href="http://quill.to/">Quill [羽根のように軽い、メモメモwebサービス]</a>
<a href="http://blog.inafog.jp/archives/314">blog in a fog >> Quillリリースしました</a>
<a href="http://blog.woopsdez.jp/?p=841">ウープスデザインブログ >> 羽根のように軽いメモメモwebサービス 「Quill」公開されました</a>

と言うわけで、どうやら知り合いの人が開発に携わっているようなので、おめでとうございますエントリー。

とりあえず簡単に使ってみて、なんやかんや言ってみようと思ったんだけれどちょっと問題が。自分、オンラインのメモって使わないんだよね。

理由としては
<ul>
<li>いつも持ち歩いてるMOLESKINEにメモする</li>
<li>ちょっとしたメモ(ToDoとかお買い物リスト的な)ものは付箋とかに書く</li>
<li>長めの文章はTerminalでVimで書く</li>
</ul>
と言った感じかなぁ。

多分、オンラインのメモってどこでも見れるってのが利点なんだろうけど、正直そこらへんはアナログで事足りちゃってる。それに携帯(WILLCOMユーザです)の通信速度があまり早くないからサッと見れない。まぁこれはある程度仕方ないけれど。と言うか、モバイル対応はまだしてないっぽいね。

あとは、メモを書くのをもうちょいストレスフリーにしたい。例えば、おれがメモをするシーンは、「ネットで調べ物」とか「電話対応」とかなんだけど、ネットしてるときは当然ブラウザは別のページをみてるので、ブラウザでメモするのはちょっと手間。わざわざFxのウィンドウを2つにするのもいやだし。電話対応は片手が塞がるので、片手でメモできるペン・紙がラク。

理想を言えば、QuickSilverでアプリを起動するのと同じぐらいスムーズに入力したいw まぁクライアントを提供するまではいかなくても、APIとかがあれば適当にQuickSilverやVimperatorのプラグインとかも自作できるだろうし。

あ、でも新規入力の検索はいいね。開きたいメモをサッと検索できて、サッと編集に移れる。それとなんやかんや言ってますが、あくまで僕のスタイルにうまくハマらないってだけなので、別にサービス自体が悪いってわけではないです。実際かなりサクサク動いてますし、かなりシンプルなので使い方は人それぞれって感じかと。

それとなんかショートカットキーが充実してるってことなのでJS読んで勝手に暴いてみた。ショートカットがあるのは一覧だけなのかな。JSの前半しか見てないんだけれども。

<dl>
<dt>j</dt>
<dd>メモの選択を下に移動</dd>
<dt>k</dt>
<dd>メモの選択を上に移動</dd>
<dt>x</dt>
<dd>選択してるメモにチェックボックスのオン/オフ</dd>
<dt>d</dt>
<dd>チェックボックスがオンのメモを削除</dd>
<dt>o</dt>
<dd>選択してるメモを開く</dd>
<dt>e<dt>
<dd>選択してるメモを編集する</dd>
<dt>Enter/Return</dt>
<dd>選択してるメモを編集する</dd>
<dt>s</dt>
<dd>選択してるメモの星のオン/オフ</dd>
<dt>c</dt>
<dd>選択してるメモのラベル(鳥?)の変更</dd>
</dl>

多分、大体こんな感じかなー。間違ってたらごめんなさい。
</article><hr /><article><h2><a href="/2008/07/29/iphone_seminar/">2008-07-29 Apple主催のiPhoneアプリケーション開発入門セミナーに参加してきた</a></h2>会場が家からすぐ近くだったので行ってきました。なるべく話しても大丈夫そうなところを選んで書きますが、場合によってはエントリーが消えることもあるかも。セミナーの内容が完全黙秘なのか、SDKの部分はダメなのかどっちかよくわからないので。英語苦手だ。

<h2>ドキュメントみろ</h2>
今回、話を聞いてきたことの大半は既にドキュメントとしてあるとのこと。英語だけど。なので英語がわかる人はそちらを読めばいいと思います。というか他にドキュメントがないので、英語読めなくても読まなきゃいけないんだけど。

<a href="http://developer.apple.com/jp">http://developer.apple.com/jp</a>

<h2>iPhoneでできないこと(と言うよりはやっちゃいけないこと)</h2>
いくつかAppleから「これはできない」と言われたアプリがあります。

<ul>
<li>リアルタイムにルーティングするもの(カーナビとか。位置情報のみはOK)</li>
<li>インストーラー、インタプリタは無理。(エグゼキュータブルは無理って言ってた)</li>
<li>データの読み書きはバンドル内のみ(バンドル = アプリケーションの実行フォルダ)</li>
</ul>

ちなみにOpenURLでアプリケーションを立ち上げるのは大丈夫らしいです。

<h2>開発手順</h2>
ほぼドキュメントそのままなので省きます。

<h2>App Storeへの登録</h2>
個人的な印象からすると、無料・個人であれば、そこまでハードルは高くなさそうな感じ。

無料・個人であれば、アプリ情報を登録し、公開条件や配布する国の指定のみで大丈夫そうです。法人に関しては場合によっては登記標本が必要かもしれません。

それに加えて有料の場合は、なんか書類を送る必要があります。ちょっとこの辺り聞き損ねてしまいましたが、特別ハードルが高いって程でもなさそうです。

アプリの審査に関して言えば、現状は「実物を見て、評価し、判断する」のが前提だそうです。つまり、「これはダメ」という線引きが曖昧で実際に審査をお願いしてみないと何とも言えないとのこと。もちろん、上に書いた「できないこと」は即はじかれるのかもしれませんが。brainfuckインタプリタを「翻訳アプリ」とか言えば、もしかしたら通るのかもしれないですけどw とりあえずはApp Storeに登録されてるものから判断するしかなさそうです。

<h2>アプリのアップデート</h2>
アプリのアップデートは機能としてあるそうです。つまり、アップデートをするのにお金がかかったり、特別な作業が必要というわけではなさそうです。ただ、アップデートが差分アップデートではなく、丸ごととりかえるそうです。

Q&Aで「例えばテキストエディタなのでバンドルに保存されてるデータはアップロード時どうなるのか?」と言った質問がありましたが「確かバックアップの仕組みがあったはずだが、確認してみないとわからない」とのこと。

<h2>アプリのローカライズ</h2>
どこの国に配布するにせよ、登録するバイナリは1つです。つまり1つのバイナリをローカライズするってことかと。翻訳の仕組みは・・・聞き損ねたか、忘れました。確かビルド時に「single binary supporting multiple languages」を選ぶとかそんなん。これ書いちゃまずいのかな。まぁいいや。

まぁ、大体こんな感じです。他にも色々聞いてますが、ほとんどドキュメントに書いてあるようなことばかりでした。ここに書いた内容がちょっと際どいので、さっきも書きましたがエントリが消えてる可能性もあります。その時はごめんなさい。
</article><hr /><article><h2><a href="/2008/07/27/ukstudio_controlled_git/">2008-07-27 ukstudio.jpをgitで管理するようにしてみた</a></h2>最近流行りのgitを使ってみようかなーってことでとりあえずukstudio.jpを全部gitで管理するようにした。

最終的に以下のような構成になった。

<a href="http://ukstudio.jp/wp-content/uploads/2008/07/git-ukstudio.png"><img src="http://ukstudio.jp/wp-content/uploads/2008/07/git-ukstudio.png" alt="" title="git-ukstudio" width="284" height="284" class="alignnone size-medium wp-image-145" /></a>

<h2>MacBookにgitをインストールする</h2>
MacBookにgitをインストールするのは簡単だった。MacPortsですんなり入った。

参考: <a href="http://d.hatena.ne.jp/from_kyushu/20080414/git_on_mac">MacPortsを使ってgitをインストールしてみた - Post-itみたいな</a>

<h2>サーバにgitをインストールする</h2>
サーバはslicehostのCentOS5.1を使用。インストールされてるsvnが1.4なのでこちらは一旦remove。

<pre lang="bash">
$ yum remove subversion
</pre>

gitはyumの標準リポジトリでは管理されてないので、外部リポジトリ(<a href="http://dag.wieers.com/rpm/">DAG</a>)を登録してそこからインストールした。

<pre lang="bash">
$ wget http://dag.wieers.com/packages/rpmforge-release/rpmforge-release-$0.3.6-1.el5.rf.i386.rpm
$ rpm -ivh rpmforge-release-0.3.6-1.el5.rf.i386.rpm
$ yum install git
</pre>

<h2>リポジトリを作る</h2>
とりあえずコミットする人の名前とメールアドレスを登録しないといけないらしいので登録。これはサーバの方も同じ。

<pre lang="bash">
$ git config --global user.email yuki.0w0[at]gmail.com
$ git config --global user.name YukiAkamatsu
</pre>

次にローカルのファイル群をcommitする。
<pre lang="bash">
$ cd ~/ukstudio.jp
$ git init
$ git add .
$ git commit -m "first commit"
</pre>

この状態だとまだローカル内での変更のみ。なので、この変更をサーバ側で受け取れるようにする。

<pre lang="bash">
# ukstudio.jpにログインした状態
[ukstudio.jp]$ mkdir /var/git/ukstudio.jp
[ukstudio.jp]$ cd /var/git/ukstudio.jp
[ukstudio.jp]$ git init-db
</pre>

んで、またローカルに戻ってさっきcommitしたのをpushして反映させる。

<pre lang="bash">
$ git remote add ukstudio.jp ssh://ukstudio@ukstudio.jp/var/git/ukstudio.jp
$ git push ukstudio.jp ukstudio.jp master
</pre>

最後に外部から見れるように配置する。

<pre lang="bash">
# ukstudio.jp
[ukstudio.jp]$ cd /var/www/vhost/
[ukstudio.jp]$ git clone /var/git/ukstudio.jp
</pre>

これで/var/www/vhost/ukstudio.jpが作成されて、そこにずらーっとファイルができてるはず。とりあえずこれでukstudio.jpをgitで管理できるようになった。(と思う)

<h2>ローカルで変更を加えてみる</h2>
本当にうまく管理できているのか、適当なファイルを作って確かめてみたいと思う。

<pre lang="bash">
$ cd ~/ukstudio.jp
$ touch hoge.txt
$ git add hoge.txt
$ git commit -m "commit test"
$ git push ukstudio.jp master

#ukstudio.jp
[ukstudio.jp]$ cd ~/var/www/vhost/ukstudio.jp
[ukstudio.jp]$ git pull
</pre>

これでhoge.txtがあれば、うまく管理できてることになると思う。

そんな感じで、とりあえずしばらくはgitを使ってみようかなーと思う。「git log -p」とやるとコミットログがdiff付きでみれて便利。

<h3>参考</h3>
<a href="http://www8.atwiki.jp/git_jp/pub/Documentation.ja/user-manual.html">Git ユーザマニュアル(1.5.3以降)</a>
<a href="http://www8.atwiki.jp/git_jp/pub/Documentation.ja/tutorial.html">Gitチュートリアル(1.5.1以降)</a>
<a href="http://www.nofuture.tv/index.rb?GitMemo">Gitメモ</a>
<a href="http://blog.champierre.com/archives/670">せっかちな人のためのgit入門</a>
<a href="http://www.kaeruspoon.net/articles/477">バージョン管理をsubversionからgitに移行してみた</a>

<h2>SSHについて補足</h2>
サーバへのSSH接続は鍵認証でやっています。秘密鍵を~/.ssh/id_dsa_ukstudio.jpで保存して、~/.ssh/configに以下のように書いています。

<pre lang="bash">
Host ukstudio.jp
IdentityFile ~/.ssh/id_dsa_ukstudio.jp
Protocol 2,1
</pre>
</article><hr /><article><h2><a href="/2008/07/23/categories_and_tags_in_order/">2008-07-23 カテゴリとタグを整理しました</a></h2>なんかWordPressにいつのまにかタグ機能が実装されていたので、せっかくなので使ってみることにしました。

ベースはヤスヒサさんの<a href="http://www.yasuhisa.com/could/article/category-tag/">カテゴリとタグを上手に使い分ける</a>を参考にしています。

ヤスヒサさんの記事を読んだあと、自分なりに色々考えて、カテゴリを廃止しタグのみにすることも検討したんですが、今まで書いたエントリーを見直して、タグだけじゃカバーしきれないなと思ったので、結局カテゴリも使ってみることにしました。

カテゴリは、「プログラミング」「日記」「告知」の3種類にしようとも思ったんですが、そうすると例えばHTMLの話題やWeb全般に関する話題はどのカテゴリにも該当しないことに気づいたので、「記事」「日記」「告知」の3種類に最終的に決定しました。

基本的にこのブログはRSS、検索、はてブ経由で来る人が多いので、1つの記事から関連のある他の記事に辿れることを重視しています。現状、デザインを修正してないのでわからないと思いますが・・・例えば、カテゴリ・タグをベースに関連エントリなど他のエントリとの繋りを作るといった感じですかね。カテゴリやタグ以外にははてブ数や時間とかもちょっと考慮に入れてます。

今までは、1つのエントリで完結させてましたが、今後は「他にもこんな記事があるよ」と言ったことができたらなぁと思っています。
</article><hr /><article><h2><a href="/2008/07/18/amazon_crossreview/">2008-07-18 Amazon商品ページにcrossreviewのレビューを表示するgreasemonkeyスクリプト書いた</a></h2>初グリモン。結構適当に書いたけど、とりあえず動くのでよし。codereposに上げたのでいじりたい人はご自由にどうぞー。

<a href="http://coderepos.org/share/browser/lang/javascript/userscripts/amazon_crossreview.user.js?">amazon_crossreview.user.js</a>

現状、取得できるレビュー数が7件までなのは仕様です。ごめんなさい!

サンプル画像
<img src="http://img.skitch.com/20080718-bs6mqgs1nrjggarixunr4wgmdd.jpg" alt="greasemonkey_for_crossreview"/>
</article><hr /><article><h2><a href="/2008/07/15/iphone-developer-program/">2008-07-15 iPhone Developer Programに登録しました。</a></h2>結論から言うと、まだ実機検証も配布もできてない段階です。そもそもアプリ作れてないですしね。ただ、米国在住者じゃないと登録できないってことはないですね。とりあえず登録はできたっぽいので。

端的に今の状況を説明すると、

<ul>
<li>iPhone Developer Program(Standardの方、$99)を日本のオンラインApple Storeから注文する</li>
<li>activate codeがメールで届く</li>
<li><blockquote>
We are unable to activate your iPhone Developer Program membership because we are unable to successfully verify your identity. Please contact us and reference Enrollment ID#xxxxxxx for further assistance.</blockquote></li>
<li>activateできねーよ!って日本語と英語でADC(Apple Developer Connection)のcontact usから送信</li>
<li>数時間後、「あんたのアカウント情報調整したからもっかい試してみ」って返事がくる(日本語できた)</li>
<li>めでたくactivate完了</li>
</ul>

そんな感じでとりあえずDeveloper Programには登録できましたーと。んで、そのあとも実機検証までデバイスの登録とか証明書の作成とか色々ある。やり方は一応英語でドキュメントがあるけれど、なんかキレイにまとまってない。とりあえずはProgram Portal(activate後、ログインできるページ)のメニューを順番にやっていけばいいんじゃないかねー。各メニューにHow Toがあるからそれに従えばいいはず。

おれがやったのは

<ul>
<li>Certificatesの追加</li>
<li>Devicesの追加</li>
<li>App IDsの追加</li>
<li>Provisioningの追加</li>
<li>xcodeのオーガナイザ上で、iPod Touchのrestore</li>
<li>オーガナイザでTouchにProvisionを追加</li>
<li>xcodeのプロジェクトのinfoでDeviceを選択しようにも選択肢にでない! <- ｲﾏｺｺ</li>
</ul>

正直、手順が悪かったのか何が悪かったのかがよくわからない。AppleIDに登録してある情報が日本語だからから至るところで文字化けしてるし。証明書のコモンネームまで文字化けしてる。

xcodeのinfoでiPhoneDeveloper:<firstname><lastname>を入力するところがあるんだけど、そこに証明書のコモンネームを書けってドキュメントに書いてあったけど、上で書いたようにコモンネームが文字化けしてるのでどうしたもんかなーと。

んで、証明書を作りなおししまくってたら、Errorがでるようになって追加できなくなってしまった。んで、またメールでなんとかしてーって連絡したところ。

そんな感じでまだiPod Touchで自作appを作るところまではいってない。これからやる人は英語のApple ID作った方がいい気がする。その方が問題なさそう。ただ、あれって日本の住所でも英語で登録できたっけ・・・

とりあえずまた進展があったらエントリ書く。

<h2>追記</h2>
どうやら大抵の人は一発でactivateできてないっぽいですね(We are unable to activate your iPhone...ってやつ)。そう言うときはとりあえずメールでなんとかしてくれーと頼むのがいいんじゃないですかね。

実機で動かすまでが長いですなぁ。
</article><hr /><article><h2><a href="/2008/07/03/release_crossreview/">2008-07-03 crossreviewがリリースされました!</a></h2>今日、<a href="http://crossreview.jp/">crossreview</a>というサービスがリリースしました。smashmediaの河野さんのアイディアと元に、僕の勤め先であるRAWHIDE.が開発を手伝わさせていただきました。

<a href="http://blog.crossreview.jp/plessrelease">プレスリリース</a>
<a href="http://smashmedia.jp/blog/2008/07/001654.html">ぼくとcrossreviewの誕生日</a>

Amazonの商品をレビューするサイトなのですが、Twitterみたいに気軽にレビューできます。他にもお気に入り機能(Twitterでいうfollowみたいなもの)があるので、似た趣味の人のレビューを追ったりすると色々とおもしろいんじゃないかと思います。

ちなみに僕のページは<a href="http://crossreview.jp/ukstudio/">http://crossreview.jp/ukstudio/</a>ですよー。


ブログパーツ、横のもほしいなぁー。あとで要望だしちゃおう。
</article><hr /><article><h2><a href="/2008/06/30/song_for_autotest/">2008-06-30 autotestの結果をMacのsayコマンドで通知する</a></h2>かなりネタなエントリー。

Macにはsayコマンドと言うものがあって、入力した英単語とかをしゃべらせることができる。詳細はMacの手書き説明書さんが最近エントリー書いているのでそちらを見てくださいな。

<a href="http://veadardiary.blog29.fc2.com/blog-entry-1645.html">Macが歌いだす！？ | Macの手書き説明書</a>

んで、今回はそのsayコマンドを使って、autotestの結果をしゃべらせよう!というネタ企画。実用性はほぼ皆無。

まずは~/.autotestを修正。最下行に以下を追記する。既にgrowlの通知などの設定がある場合はそこにsayコマンドの実行文を追記すればOK。

<pre lang="ruby">
module Autotest::Growl
  Autotest.add_hook :ran_command do |at|
    results = [at.results].flatten.flatten.join("\n")
    output = results.slice(/(\d+)\s+examples?,\s*(\d+)\s+failures?(,\s*(\d+)\s+not implemented)?/)
    if output
      if $~[2].to_i > 0
        `say -v bad faild`
      else
        `say -v good success!`
      end
    end
  end
end
</pre>

`で括っている2箇所でsayコマンドを実行している。失敗したときはbadな声で、成功したときはgoodな声で結果を通知する。他にも色んな声があるらしいので、そこらへんは好みで。

<pre lang="bash">
ls /System/Library/Speech/Voices
</pre>

とすると声の一覧がでるっぽい。
</article><hr /><article><h2><a href="/2008/06/13/rails2_1min/">2008-06-13 Ruby on Rails 2.0アプリを10秒で作る2.0</a></h2><ul>
<li>Railsのインストールは作業時間に含みません</li>
<li>shファイル作る時間も含みません</li>
<li>筆者の環境がMacBookなのでそれ以外の環境は適当に脳内変換すべし</li>
<li>ネタです</li>
</ul>

適当なディレクトリにhoge.shを作る。

<pre lang="sh">
rails itpro
cd itpro
script/generate scaffold itpro userid:string name:string
rake db:migrate
</pre>

<pre lang="bash">
$ chmod 775 hoge.sh
#別に775じゃなくてもとりあえず実行権限あたえればおk
</pre>

んじゃ、こっからスタート。以下の3行を10秒でうちこむ。Tabキー使えば余裕でしょ。あと、hoge.shの実行時間とserverの起動は考慮してないから。
<pre lang="bash">
$ ./hoge.sh
$ cd itpro
$ ruby ./script/server
</pre>

んで、http://localhost:3000/itprosにブラウザからアクセス。表示されればおk。

<a href="http://itpro.nikkeibp.co.jp/article/COLUMN/20080606/306873/">Ruby on Rails 2.0アプリを1分で作る : IT Pro</a>
</article><hr /><article><h2><a href="/2008/06/05/rails_vim_rspec/">2008-06-05 rails.vimのファイル切り替えをRSpecに対応させる(仮)</a></h2>rails.vimをインストールすると、RcontrollerとかRmodelコマンドでRSpecファイルからControllerやModelファイルに切り替えることができるんだけど、その逆ができないので対応させた。仮なのはVimスクリプトをちゃんと書けなくてコピペのごまかしだから。

書きかえるファイルは~/.vim/autoload/rails.vim。一応行数も書いたけどもしかしたらズレてるかもしれないので参考程度に。あと、バージョンは2.0使ってる。

まずは、:Rspec、:Rspeccontroller、:Rspecmodelを呼び出せるようにする。
<pre lang="vim">
1777   call s:addfilecmds("integrationtest")
1778   call s:addfilecmds("spec")
1779   call s:addfilecmds("speccontroller")
1780   call s:addfilecmds("specmodel")
1781   call s:addfilecmds("stylesheet")
</pre>
なんでわざわざ3つあるのかと言うと、「:Rspec hoge」ってやった時にControllerのスペックなのか、Modelのスペックなのか判断する方法がわからなかったから。だからとりあえず「:Rspec」とやったときは、今開いているファイルに対応するスペックファイルを開き、個別に指定して開きたいときは「:Rspeccontroller hoge」もしくは「:Rspecmodel hoge」で明示的にControllerかModelかを指定するようにした。

次に「:Rspeccontroller [tab]」や「:Rspecmodel [tab]」としたときに、スペック名を補完できるようにfunctionを追加する。
<pre lang="vim">
1941 function! s:speccontrollerList(A,L,P)
1942   return s:autocamelize(s:relglob("spec/controllers/",s:recurse,"_controller_spec.rb"),a:A)
1943 endfunction
1944
1945 function! s:specmodelList(A,L,P)
1946   return s:autocamelize(s:relglob("spec/models/",s:recurse,"_spec.rb"),a:A)
1947 endfunction
</pre>

最後に実際にファイルを開く部分。2331、2334、2340、2345の"spec"、"speccontroller"、"specmodel"が最初に設定したaddfilecmdsの引数と対応するっぽい。なのでfunction名はなんでもいいと思うけど、とりあえず他のに合わせた。

specEditは「:Rspec」に対応していて、開いたファイルがControllerかModelかで開くスペックファイルもかわる。speccontrollerEditとspecmodelEditはControllerかModelどちらか決まったものしか開かない。

<pre lang="vim">
2328 function! s:specEdit(bang,cmd,...)
2329   if s:model() != ''
2330     let f = s:model()
2331     return s:EditSimpleRb(a:bang,a:cmd,"spec",f,"spec/models/","_spec.rb")
2332   else
2333     let f = s:controller()
2334     return s:EditSimpleRb(a:bang,a:cmd,"spec",f,"spec/controllers/","_controller_spec.rb")
2335   endif
2336 endfunction
2337
2338 function! s:speccontrollerEdit(bang,cmd,...)
2339   let f = s:controller()
2340   return s:EditSimpleRb(a:bang,a:cmd,"speccontroller",f,"spec/controllers/","_controller_spec.rb")
2341 endfunction
2342
2343 function! s:specmodelEdit(bang,cmd,...)
2344   let f = s:model()
2345   return s:EditSimpleRb(a:bang,a:cmd,"specmodel",f,"spec/models/","_spec.rb")
2346 endfunction
</pre>

とりあえず、現状の設定で簡易的にRSpecに対応させることができる。「:Rspec」の存在が気持ち悪いのであれば、それは消して開いているファイルがControllerかModelか自分で判断して「:Rspeccontroller」か「:Rspecmodel」を使いわければいいと思う。「:Rspec [tab]」でエラーが出るし個人的には気持ちわるいんだけど、対応させたスペックを開くことの方がおおいし、その時は短いコマンドの方が都合がいいのでここらへんは妥協。今回Viewには対応させていないけれど、同じ要領でできるはず。

rails.vimを少しよんだだけだし、実際の動作もまともに検証してないので変な動作したらごめんなさい。まぁ致命的な問題は起きないだろうけど。正式にrails.vimがRSpecに対応してくれるといいんだけどね。
</article><hr /><article><h2><a href="/2008/06/04/rails_for_beginner/">2008-06-04 RE:Rails初心者はどうやって他人のRailsコードを読めばいいか</a></h2>オレもRailsを初めて3ヶ月(もうちょいあるかも)たったので、ある程度オレの経験を元にまとめてみる。参考になるといいなー。

<h2>1. まずはアプリケーションを実際に動作させる</h2>
<pre lang="bash">
% ruby script/server
</pre>
とりあえずコード読む前にそのアプリケーションがどんなものを把握するのが重要。コード読んでもわかるだろうけど、実際にブラウザでいじくりまわした方がはやく理解できると思う。その時にコントローラー名とアクション名もみといた方がよさげ。

<h2>2. モデル図を書く</h2>
これはid:Hash本人も重要って書いてたけど、ほんとに重要。そんなにキレイな図とかじゃなくていいから、紙とかに多対多なのか1対多なのかとか、参照名はなにかとかぐらいメモがてら書いておくと吉。モデルの関連さえ把握できれば、そのRailsアプリの半分以上理解できたも同然ってぐらい重要。

<h2>3. Logをみる</h2>
<pre lang="bash">
% tail -f log/development.log
</pre>
開発時にも言えることだけどなるべくLogはみた方がいい。log/の下にdevelopment.log(多分ないと思うけど、productionで動作させてるならproduction.log)があるのでtailコマンドとかでみるといい。フォームのsubmit時のパラメータが見れたり、あとはlogger.infoで出力をチェックしたりとかできる。

<h2>4. script/consoleを使う</h2>
<pre lang="bash">
% ruby ./script/console
</pre>
基本的な使い勝手はirbと同じ。irbと違うのはRails環境があらかじめロードされていること。例えば、モデルのメソッド名を呼び出したりとか。メソッドレベルで動作をみたい場合に便利。あと、2.0以降からモデル名を入力するとカラムの一覧も表示される。

<pre lang="ruby">
>> User
=> User(id: integer,  created_at: datetime, updated_at: datetime)
>> User.find(:all)
=> []
>> user = User.new
=> #<user id: nil, created_at: nil, updated_at: nil>
</pre>

<h2>test(or spec)があれば見る *追記08/06/04*</h2>
<blockquote>
できれば「test(or spec)があれば、見ろ」も入れて欲しい。
あれは「どういう挙動をして欲しいか」=「どう使うか」が書いてあるんだから、
どんな構造のアプリなんだか理解する助けになるよ。
てか、ならないなら書く意味ないもの。
</blockquote>
コメント欄での指摘。このエントリを書こうと決めたときは書くつもりだったのに、実際に書いたら忘れてたっていう。

thx、faultier。

<h2>まとめとオマケ</h2>
なんかTips的なエントリになったけど、とりあえずざっと思いついたのはこんな感じ。あとはコントローラのアクションからスタートして、モデルのメソッドや一連の流れを追えばいいんじゃないかな。コントローラーのアクションも上から順に読むよりは、機能ごとの流れで追った方がいいと思う。例えば、new->create->showとかedit->update->showとか。実際はもうちょい複雑な場合もあるだろうけど。実際の流れがどんな風になってるかは実際にアプリを動かしながらURLを確認したり、ログの出力やビューのフォームのアクションを見れば大体わかるはず。

あとはオマケ的な指摘だけど、Railsが2系であればビューファイルの拡張子は「.rhtml」より「.html.erb」の方がいい。この辺はActionPackのマルチビューに関係してる。この辺は初心者のうちはとりあえず「.html.erb」にしとくぐらいでいいと思うし、なによりオレがマルチビューについてまだちゃんと理解してないので詳細ははぶく。ｻｰｾﾝ｡

respond_toは1つのアクションで複数のフォーマットを出力するときに使う。
<pre lang="ruby">
respond_to do |format|
  format.html
  format.xml { render :xml => @user }
end
</pre>
上記のように書くと、ブラウザからの通常アクセス時はhtmlを、WebサービスなどでXMLを指定された場合はXMLを出力する。Webアプリは、例えばブラウザからのアクセスとAPIでのアクセスで、処理は同じだけど出力が違うなんてことがあったりする。そういうときにrespond_toで指定してやることで無闇にアクションを増やさなくてすむ。

<table  border="0" cellpadding="5"><tr><td colspan="2"><a href="http://www.amazon.co.jp/gp/redirect.html%3FASIN=4797336625%26tag=2004-05-22%26lcode=xm2%26cID=2025%26ccmID=165953%26location=/o/ASIN/4797336625%253FSubscriptionId=0G91FPYVW6ZGWBH4Y9G2" target="_top">Railsレシピブック 183の技</a><img src='http://www.assoc-amazon.jp/e/ir?t=2004-05-22&l=ur2&o=9' width='1' height='1' border='0' alt='' /></td></tr><tr><td valign="top"><a href="http://www.amazon.co.jp/gp/redirect.html%3FASIN=4797336625%26tag=2004-05-22%26lcode=xm2%26cID=2025%26ccmID=165953%26location=/o/ASIN/4797336625%253FSubscriptionId=0G91FPYVW6ZGWBH4Y9G2" target="_top"><img src="http://ecx.images-amazon.com/images/I/419FtZYCmyL._SL160_.jpg" border="0" alt="Railsレシピブック 183の技" /></a></td><td valign="top"><font size="-1">高橋 征義<br /><br />ソフトバンククリエイティブ  2008-05-31<br />売り上げランキング : 1080<br /><br /><br /><a href="http://www.amazon.co.jp/gp/redirect.html%3FASIN=4797336625%26tag=2004-05-22%26lcode=xm2%26cID=2025%26ccmID=165953%26location=/o/ASIN/4797336625%253FSubscriptionId=0G91FPYVW6ZGWBH4Y9G2" target="_top">Amazonで詳しく見る</a></font><font size="-2"> by <a href="http://www.goodpic.com/mt/aws/index.html" >G-Tools</a></font></td></tr></table>

<table  border="0" cellpadding="5"><tr><td colspan="2"><a href="http://www.amazon.co.jp/gp/redirect.html%3FASIN=4274066967%26tag=2004-05-22%26lcode=xm2%26cID=2025%26ccmID=165953%26location=/o/ASIN/4274066967%253FSubscriptionId=0G91FPYVW6ZGWBH4Y9G2" target="_top">RailsによるアジャイルWebアプリケーション開発 第2版</a><img src='http://www.assoc-amazon.jp/e/ir?t=2004-05-22&l=ur2&o=9' width='1' height='1' border='0' alt='' /></td></tr><tr><td valign="top"><a href="http://www.amazon.co.jp/gp/redirect.html%3FASIN=4274066967%26tag=2004-05-22%26lcode=xm2%26cID=2025%26ccmID=165953%26location=/o/ASIN/4274066967%253FSubscriptionId=0G91FPYVW6ZGWBH4Y9G2" target="_top"><img src="http://ecx.images-amazon.com/images/I/51Y%2BviLzM5L._SL160_.jpg" border="0" alt="RailsによるアジャイルWebアプリケーション開発 第2版" /></a></td><td valign="top"><font size="-1">前田 修吾 <br /><br />オーム社  2007-10-26<br />売り上げランキング : 8708<br /><br /><strong>おすすめ平均  </strong><img src="http://g-images.amazon.com/images/G/01/detail/stars-5-0.gif" alt="star" /><br /><img src="http://g-images.amazon.com/images/G/01/detail/stars-5-0.gif" alt="star" />充実した内容でわかりやすい<br /><img src="http://g-images.amazon.com/images/G/01/detail/stars-5-0.gif" alt="star" />railsが良いのかrubyが良いのか本が良いのか<br /><img src="http://g-images.amazon.com/images/G/01/detail/stars-5-0.gif" alt="star" />１日に少しの時間で成果が分かる１冊<br /><br /><a href="http://www.amazon.co.jp/gp/redirect.html%3FASIN=4274066967%26tag=2004-05-22%26lcode=xm2%26cID=2025%26ccmID=165953%26location=/o/ASIN/4274066967%253FSubscriptionId=0G91FPYVW6ZGWBH4Y9G2" target="_top">Amazonで詳しく見る</a></font><font size="-2"> by <a href="http://www.goodpic.com/mt/aws/index.html" >G-Tools</a></font></td></tr></table>
</article><hr /><article><h2><a href="/2008/05/27/rawhide-designer/">2008-05-27 RAWHIDE.ではデザイナを募集しています。</a></h2>ども、お久しぶりです。久々のエントリで求人ってのも微妙な感じですが、できるだけ色んな人に見てもらいたいですからねー。そもそもこのブログをデザイナが見てるのかどうかが微妙なのかもしれませんが。

そんな感じでどうぞよろしくですよー(0w0)

<a href="http://blog.raw-hide.jp/wp/?p=371">FIGHT! THE RAWHIDE★ &raquo; デザイナー募集のお知らせ</a>

<h3>募集する職種</h3>
<p>
デザイナー　１名
</p>
<h3>仕事内容</h3>
<p>
企画ごとに編成されるチームの一員として、立ち上げから制作、監修までの一連の業務。
※当面は、ディレクション担当者とともに制作進行していただきます。
</p>
<p>
主に平面デザインが主体です。サイトデザイン、ブログパーツデザイン、キャラクターデザイン、など、企画にあがったプロダクト全般のデザインを担当していただきます。
</p>
<p>
FlashオーサリングやHTML+CSSコーディングなどはチームメンバーに担当者がおりますので経験なくとも協力しながら作業をすすめることが可能です。
</p>
<h3>対象となる方</h3>
<p>
専門学校、短大、大学にてグラフィックデザインの教育を受けたデザインの経験者。（アシスタント経験も可）
WEB制作ソフト、グラフィック制作ソフトの知識経験は必須です。
</p>
<h3>ご用意いただくもの</h3>
<ul>
<li>エントリーシート（履歴書・職務経歴書など）</li>
<li>ポートフォリオ（作品集）</li>
</ul>

<h4>ポートフォリオ（作品集）について</h4>
<p>
CD-RかDVDのデータ、または出力書類にてA3サイズまでの封筒で提出してください。
WEBの場合は、URLをエントリーシート内に明記してください。
もしくは画面キャプチャをプリントしてご用意ください。
</p>
<p>
作品については返却しませんので大切なものはコピーなど複製したものをご提出ください。
</p>

<h3>個人情報の取り扱いについて</h3>
<p>応募者情報につきましては、厳重に管理いたします。</p>
<p>
当該個人情報は、採用選考および入社手続きに必要な範囲で利用し、
法令で定められる場合、安全管理処置を講じた委託先に業務委託をする場合をのぞき、
ご本人の同意なく、他の目的では利用することはありません。
</p>
<p>
なお、お送りいただいた各種書類およびデータは、返却いたしませんのでご了承ください。
</p>
<p>
不採用とさせていただいた場合は、選考終了後適切な方法にて破棄いたします。
</p>
</article><hr /><article><h2><a href="/2008/03/14/autotest_for_macbook/">2008-03-14 MacBookにRailsの自動テスト環境を構築した</a></h2>なんかautotestが流行りつつある今日この頃ですが、みなさまいかがお過ごしでしょうか。とりあえず丁度うちの会社でも自動テストしようかーみたいな話がでてたので構築してみましたよ!

<h2>ZenTestのインストール</h2>
とりあえずは定番のZenTest(autotest)とRedGreen(結果の色付け)をインストールします。

<pre lang="bash">
$ sudo gem install ZenTest
$ sudo gem install RedGreen
</pre>

次にautotestの設定ファイルの作成。example_dot_autotest.rbのパスは人によって違うと思うので適当に読み替えてください。

<pre lang="bash">
cp /opt/local/lib/ruby/gems/1.8/gems/ZenTest-3.9.1/example_dot_autotest.rb ~/.autotest
</pre>

~/.autotestの15行目のコメントアウトを解除。

<pre lang="ruby">
require 'autotest/redgreen'
</pre>

RAILS_ROOTでautotestを実行。起動時に全部のテストを実行するのでちょっとだけ重くなるかもしれません。それ以降はテストファイルやモデル、コントローラファイルなどを修正する度に該当のテストが走ります。

<pre lang="bash">
$ cd RAILS_ROOT
$ autotest
</pre>

実行するテストはtest/unit、もしくはRailsにRSpecが入れてあればRspecのテストを実行します。

なんかspec_serverを立ち上げておくと処理が早くなるらしいですがよくわかってないです。まぁとりあえず設定しといて損はなさそうです。

<pre lang="bash">
$ vi spec/spec.opts # 最下行に --drb を追記。drbでテスト用サーバへ繋ぐようになります。
$ ruby script/spec_server
</pre>

テストの結果は成功なら緑色のバーが、失敗なら赤色のバーが表示されます。

<h2>結果通知用にGrowlとScreenの設定をする</h2>

これでも自動テストは走るので問題ないですが、結果を見るのがちょっと面倒ですね。ということでGrowlとScreenで結果が見えるようにしましょう。

screenの場合は<a href="http://kakutani.com/20070912.html#p02">角谷さんのエントリーを</a>見るといいと思います。基本的にそのまま~/.autotestにコピペするだけで問題ないはずです。

<pre lang="ruby">
require 'autotest/screen'   # コメントアウトを外す

Autotest::HOOKS.delete(:interrupt)
Autotest::Screen.statusline = %q[|%c %m/%d|%w %=]

class Autotest::Screen
  SCREEN_COLOR[:green] = 'gw'
  SCREEN_COLOR[:yellow] = 'yk'

  Autotest.add_hook :run_command do |at|
    message 'Running' if execute?
  end

  Autotest.add_hook :quit do |at|
    clear if execute?
  end

  Autotest.add_hook :ran_command do |at|
    return unless execute?
    results = [at.results].flatten.join("¥n")
    output = results.slice(/(¥d+)¥sexamples?,¥s*(¥d+)¥s.*failures?(?:,¥s*(¥d+)¥s.*pendings?)?/)
    if output
      ex,fail,pend = $~.captures.map {|e| e.to_i}
      if 0 < fail
        message "FAIL #{ex}ex, F:#{fail} ", :red
      elsif 0 < pend
        message "Pend #{ex}ex, F:#{fail} P:#{pend}", :yellow
      else
        message "All Green #{ex}ex", :green
      end
    end
  end
end
</pre>

この設定でscreenとautotestを起動しておくと、ステータスバーの右側にテストの結果が表示されます。

<img src="http://img.skitch.com/20080314-d6gq6bsmbbxh99ynx349bfcckf.jpg" alt="autotest"/>

これ貼ってから気づいたけど、Terminalから透けてみえる絵がなんかあれですなw

次にGlowlの設定ですが、Leopardではruby-growlのインストールが必要っぽいです。とりあえずmacportsからインストールしておきましょう。それとGrowlの設定でリモートを許可しておきましょう。

<pre lang="bash">
$ sudo port install ruby-glowl
</pre>

<img src="http://img.skitch.com/20080314-r92e97nip77qfj7u4p2a1ch8e6.jpg" alt="Growl"/>

Growlで結果を通知するにはgrowlnotifyのインストールが必要です。もしインストールしていなければ<a href="http://growl.info/">本家</a>からdmgファイルをDLし、その中にあるinstall.shを実行します。

<pre lang="bash">
$ cp -r /Volumes/Growl\ 1.1.2/Extras/growlnotify ~/tmp
$ cd ~/tmp/growlnotify
$ sudo ./install.sh
$ growlnotify -m "hoge" # growlの通知が表示されればインストール完了
</pre>

~/.autotestを修正し、glowlで結果が通知されるようにします。

<pre lang="ruby">
require 'autotest/glowl' # コメントアウトを解除
</pre>

これでテストが失敗したとき、失敗から成功になったときにGrowlが通知してくれます。Growlの見た目を変更しようと思ったけれど、個人的にscreenだけで十分だったので今回はナシ。

とりあえず自動テストはテストを書くのが楽しくなりますな。オススメ。
</article><hr /><article><h2><a href="/2008/03/04/from_unittest_to_rspec/">2008-03-04 test/unitで書いたテストにRSpecでテストを追記する方法</a></h2>10分ぐらい調べて試してみただけだけど。

<pre lang="ruby">
require 'rubygems'
require 'test/unit'
require 'spec'

class TestArray < Test::Unit::TestCase

  # test/unit
  def test_1
    assert_equal(0, Array.new.size)
  end

  # rspec
  describe Array, "when empty" do
    before do
      @empty_array = []
    end

    it "should be empty" do
      @empty_array.should be_empty
    end

    it "should size 0" do
      @empty_array.size.should == 0
    end

    after do
      @empty_array = nil
    end
  end
end
</pre>

<pre lang="bash">
$ ruby test.rb
....

Finished in 0.007974 seconds

4 examples, 0 failures
</pre>

RSpecの方のテストはるびまの角谷さんの<a href="http://jp.rubyist.net/magazine/?0021-Rspec">記事</a>から拝借しました。

spceをrequireして、クラスに書きこんでいけばよさそう。仕事だとtest/unitで書いてしまったテストも多いだろうから、test/unitからRSpecに移行するのにいいかもしれない。
</article><hr /><article><h2><a href="/2008/03/01/rawhide/">2008-03-01 RAWHIDE.入社のお知らせ</a></h2>こんばんわ、UKです。

実は2月22日に今まで勤務していた会社を退職しました。ついったーやmixiでつながっている人達は知ってたかもですが。

で、新しい職場ですが実は年末から話がすすんでおり(これも一部の人達は知ってたかもですね)、この度3月1日付けで正式にRAWHIDE.に入社することになりました。わーい。

<a href="http://blog.raw-hide.jp/wp/?p=336">FIGHT! THE RAWHIDE★ » RAWHIDE.に入社しました。</a>

早くRAWHIDE.の一員、戦力として役立てるよう頑張る所存です。よろしくお願いします。

<a href="http://twitter.com/Hamachiya2/statuses/742737192">オマケ</a>: こないだ出社したときの話です。ふふふ・・・
</article><hr /><article><h2><a href="/2008/02/27/haskell_sec3/">2008-02-27 ふつケル第3章</a></h2><h2>型と値</h2>
Haskellには<strong>型推論</strong>という機能がある。型推論は処理系の方で型を推測し、<strong>矛盾なく全ての式が型づけできればコンパイル時にエラーにはならない</strong>。Haskell以外にも、OCaml、Scala、MLなど静的型付け関数型言語のほとんどが型推論の機能を供えている。

Haskellの型には、<strong>Int(整数値)、Char(文字)、String(文字列)、Bool(真偽値)</strong>がある。Intは最低30ビット幅の符号付き整数値を意味する。CharやStringで扱う文字(列)のエンコードにはUnicodeを採用しているが、GHCの実装は中途半端で入出力でのエンコーディング変換などが実装されていない。

また、Int型のリスト、Char型のリストと言う風にリストの型を表現し、Int型のリストの各要素はInt型になる。<strong>ソースコード上では[Int]や[Char]と書く</strong>。文字列は文字のリストなので[Char]ということになり、別名として上記したString型が用意されている。

関数の型をは引数の型と返り値の型を組合せて表現する。例えば、<strong>String -> [String]というのは第1引数の型がString(文字列)で、返り値の型が[String](文字列のリスト)となる</strong>。

<pre lang="haskell">
第1引数の型 -> 第2引数の型 -> ・・・ -> 返り値の型
</pre>

では、引数の型が決まっていない場合どうするのかと言うと、<strong>型変数</strong>と言うものを使う。型変数はアルファベット小文字であらわし、アルファベット小文字の部分は好きな型に読み替えてよい。

<pre lang="haskell">
[a] -> Int
Int -> [a] -> [a]
</pre>

上記の場合だと、1行目は任意の型のリストを引数にもち、Intを返す関数。2行目はIntを第1引数、任意の型のリストを第2引数にもち、第2引数と同じ型のリストを返す関数という意味になる。

<strong>関数の型を宣言</strong>するには、先程関数の型を表現したものに少し付け足せばいい。Haskellは型推論の機能をもつので必ずしも型の宣言が必要というわけではないが、なるべく宣言しておくのが好ましい。

<pre lang="haskell">
関数名 :: 第1引数の型 -> 第2引数の型 -> ・・・ -> 返り値の型
</pre>

<h2>高階関数</h2>
高階関数とは<strong>引数に関数をとる関数</strong>のこと。

<pre lang="haskell">
main = do cs < - getContents
          putStr $ expand cs

expand :: String -> string
expand cs = map translate cs

translate :: Char -> Char
translate c = if c == '\t' then '@' else c
</pre>

このプログラムでは5行目で高階関数のmap関数が使われている。map translate csと言うのは、<strong>translate関数そのものにmapを適用しているのであって、translateの結果にmapを適用しているわけではない</strong>。

mapの型は
<pre lang="haskell">
map :: (a -> b) -> [a] -> [b]
</pre>
となっており、<strong>(a -> b)は「a型の値を引数にとりb型の値を返す関数」</strong>を意味する。今回の場合だと、translate関数の型が Char -> Char となっているので、「Char型の値を引数にとりChar型の値を返す関数」と読み替えることができる。更にいうと(a -> b) -> [a] -> [b] は (Char -> Char) -> [Char] -> [Char]となる。

<pre lang="haskell">
main = do cs < - getContents
          putStr $ expand cs

expand :: String -> String
expand cs = concat $ map expandTab cs

expandTab :: Char -> String
expandTab c = if c == '\t' then "        " else [c]
</pre>

この辺はちょっとややこしくなってくるが、ちゃんと順に考えていけば問題ない。

<h2>パターンマッチ(1)</h2>

<pre lang="haskell">
tabStop = 8

main = do cs < - getContents
          putStr $ expand cs

expand :: String -> String
expand cs = concatMap expandTab cs

expandTab :: Char -> String
expandTab '\t' = replicate tabStop ' '
expandTab c = [c]
</pre>

個人的にtabStopがグローバル変数みたいでなんか気持ち悪い。定数と考えればいいのかな。まぁ今はとりあえず置いておこう。

今回のプログラムの最後2行で<strong>パターンマッチ</strong>を使用している。下から2行目が引数が「\t」の時に使われる定義。最後の行は仮引数が使われているので、「どんな値」にもマッチする。<strong>パターンマッチは上に書いたものが優先され、マッチするパターンが無い場合には実行時にエラーが発生する</strong>。

<pre lang="haskell">
関数名 第1引数のパターン 第2引数のパターン ・・・・ = 定義1
関数名 第1引数のパターン 第2引数のパターン ・・・・ = 定義2
関数名 第1引数のパターン 第2引数のパターン ・・・・ = 定義3
</pre>

<h2>パターンマッチ(2)</h2>
<pre lang="haskell">
map :: (a -> b) -> [a] -> [b]
map f []     = []
map f (x:xs) = f x : map f xs
</pre>

2行目のパターンマッチは空リストに一致する。つまりmapの第2引数が[]だった場合、必ず[]を返すと言うことになる。

3行目の(x:xs)もリストに対するパターンで、空リスト以外のリストにマッチする。<strong>リストの最初の要素がxに束縛され、残りの要素がxsに束縛される</strong>。まぁSchemeのcarやcdrみたいなものかな。

3行目での定義ではまたさらにmapを適用している。つまり、<strong>再帰を用いて処理している</strong>。Haskellには<strong>ループを扱う構文は存在しない</strong>為である。

<pre lang="haskell">
map length ["abc", "de", "f"]
  length "abc" : map length ["de", "f"]
    length "de" : map length ["f"]
      length "f" : map length []
      (1 : [])
    (2 : [1])
  (3:[2,1])
[3, 2, 1]
</pre>

例えば「map length ["abc", "de", "f"」だと多分こんな感じ。<strong>「:」演算子はリストを生成する演算子で(y:ys)ならリストysの先頭に要素yを追加する</strong>。

<h2>練習問題</h2>
<pre lang="haskell">
main = do cs < - getContents
          putStr $ swapa cs

swapa :: String -> String
swapa cs = map replaceA cs

replaceA :: Char -> Char
replaceA 'a' = 'A'
replaceA 'A' = 'a'
replaceA c = c
</pre>

とりあえず動く。

<h2>追記(08/02/27)</h2>
<pre lang="haskell">
main = do cs < - getContents
          putStr $ map swapa cs

swapa :: Char -> Char
swapa 'a' = 'A'
swapa 'A' = 'a'
swapa c = c
</pre>

書き直した。この方が短い。
</article><hr /><article><h2><a href="/2008/02/25/haskell_sec2/">2008-02-25 ふつケル第2章</a></h2><h2>ハロー、ワールド</h2>
<pre lang="haskell">
main = putStrLn "Hello, World!"
</pre>

「main = 」は変数mainの定義. 「putStrLn "Hello, World!"」が変数mainの値となる。putStrLnは標準出力に文字列と開業を出力する時に使う関数で、正確に言うと<strong>文字列を1つ受けとり、その文字列と改行を出力するアクションを返す関数</strong>.

「putStrLn "Hello, World!"」の式を、Haskellでは<strong>"Hello,World!"にputStrLn関数を適用する</strong>と言うらしいけど、今一ピンとこないな. 普段Rubyやってるからかな. putStrLn関数を"Hello,World!"にあてはめて用いると言いなおせばまだわかるかな. ・・・あんまり変わらないか.

<h2>cat</h2>
<pre lang="haskell">
main = do cs < - getContents
          putStr cs
</pre>

1行目のcs < - getContentsとputStr csの2つの式が揃っているのには意味があるらしい。インデントに意味があるなんてPythonみたいなやつだ。複数の式のインデントを揃えることで、do式で1つのブロックに束ねることができる。この規則をレイアウトやオフサイドルールと言う。<strong>複数のアクションをdo式でまとめると上から下へ実行されることが保証される</strong>。

アクションの結果を得るときに「< -」を使う。このサンプルの場合だと、getContentsアクションで入力した文字列が変数csに結びつき、それを「<strong>変数を値(アクションの結果)に束縛する(bind)</strong>」と言う。値が変数を束縛するのか。値は寂しがりやさんだな。

このサンプルには遅延評価も関連してるが、ここではあまり詳しく触れてないのでスルー。

<h2>countline</h2>
</pre><pre lang="haskell">
main = do cs < - getContents
          print $ length $ lines cs
</pre>

Haskellにおいてリストはかなり重要。Haskellでは<strong>文字列もリスト</strong>となっている。リストには<strong>一種類の値しか入れられない</strong>。このあたりはRuby、JavaScriptあたりをやっていると忘れがちなので注意。

</pre><pre lang="haskell">
['a', 'b', 'c'] => "abc"
[1, 2, 'a'] => NG
</pre>

$演算子は+や-と同じような二項演算子。ここでは<strong>式を区切る</strong>ために使われている。$を()に置き換えると以下のようになる。

<pre lang="haskell">
main = do cs < - getContents
          print (length (lines cs))
</pre>

<h2>head</h2>
</pre><pre lang="haskell">
main = do cs < - getContents
          putStr $ firstNLines 10 cs

firstNLines n cs = unlines $ take n $ lines cs
</pre>

4行目のfirstNLinesは関数の定義。基本的にmainの時と同じだけど、今回は仮引数が登場している。nとcsがそれぞれ第1仮引数、第2引数。

</pre><pre lang="haskell">
関数名 仮引数1 仮引数2・・・ = 関数本体
</pre>

<h2>tail</h2>
<pre lang="haskell">
main = do cs < - getContents
          putStr $ lastNLines 10 cs

lastNLines n cs = unlines $ takeLast n $ lines cs
takeLast n ss = reverse $ take n $ reverse ss
</pre>

今迄に登場したものだけを使っているので、特別なことはなし。

<h2>練習問題</h2>

countbyte.hs
</pre><pre lang="haskell">
main = do cs < - getContents
          print $ length cs
</pre>

countword.hs
</pre><pre lang="haskell">
main = do cs < - getContents
          print $ length $ words cs
</pre>

とりあえずチャチャっと書いてみた。countword.hsは単語数だから問題ないと思うけど、countbyte.hsは日本語の全角文字とかも1byte扱いすると思う。と思ったらちゃんと計算してくれた。でも、ghciで"あ"のlengthをとると1が返ってくる。よくわからん。

</pre><pre lang="haskell">
Prelude> length "あ"
1
</pre>
</article><hr /><article><h2><a href="/2008/02/15/vim_ruby_on_rails/">2008-02-15 VimでRuby on Railsの開発する為の環境構築</a></h2>ちょこっとだけ環境整えたので忘備録エントリとして。

<h2>Vim/Rubyのインストール</h2>
Ruby(.rb)とeruby(.rhtml)ファイルでシンタックスハイライトとオムニ補完が有効になる拡張。gemからインストール可能。

<pre lang="bash">
$ sudo gem install vim-ruby
$ vim-ruby-install.rb
</pre>

vim-ruby-install.rbを実行するとインストール先の選択肢が表示される。1が自分のみ、2が全体へのインストールになる。基本的にどちらでもいいと思うけど、今回は1を選択しといた。

オムニ補完の<c -X></c><c -O>の入力が面倒なのと、補完がRailsのメソッド名にも対応するように.vimrcを修正する。タブで補完できるInsertTabWrapper()は<a href="http://subtech.g.hatena.ne.jp/cho45/20071108/1194475703">Vim の自動補完候補表示 - 冬通りに消え行く制服ガールは、夢物語にリアルを求めない。 - subtech</a>よりコピペ。

<pre>
set nocompatible

syntax on

"omni
function InsertTabWrapper()
  if pumvisible()
    return "\<c -n>"
  endif
  let col = col('.') - 1
  if !col || getline('.')[col -1] !~ '\k\|< \|/'
    return "\<tab>"
  elseif exists('&omnifunc') && &omnifunc == ''
    return "\</c><c -n>"
  else
    return "\</c><c -x>\</c><c -o>"
  endif
endfunction
inoremap <tab> <c -r>=InsertTabWrapper()<cr>

" rubycomplete.vim
let g:rubycomplete_buffer_loading = 1
let g:rubycomplete_rails = 1
let g:rubycomplete_classes_in_global = 1
</cr></c></tab></c></pre>

<h2>Rails.vimのインストール</h2>
<a href="http://d.hatena.ne.jp/secondlife/20061222/1166781841">rails.vim まとめ - 川o・-・）＜2nd life</a>を参考にインストール。インストール方法は・・・リンク先参照でw

.vimrcに以下を追記。

<pre>
" rails.vim
let g:rails_level=4
let g:rails_default_file="app/controllers/application.rb"
</pre>

対応ファイル切り替えがかなり便利。

まだ補完と対応ファイル切り替えぐらいしか機能を使えてないので、追々使い方を学んでいこうと思う。

<h2>追記: 2/18 omni補完でvimが落ちる問題</h2>
omni補完をするとvimが落ちる問題が発生している。

<pre lang="bash">
im: Caught deadly signal ABRT
Vim: preserving files...
Vim: Finished.
</pre>

普通のRubyプログラム上では問題なく補完できる。(例えば10.toで<tab>10.to_sに補完とか)問題はRailsの方の補完で例えばmodelでvalida</tab><tab>とすると上記のエラーと共にvimが落ちる。とりあえず、rails.vimを外すとちゃんと補完できるようだけど、ファイル切り替えが便利なので悩み所。うまく共存させる方法はないのかな。</tab></c>
</article><hr /><article><h2><a href="/2008/02/07/programming_for_beginner/">2008-02-07 そろそろ「初心者用言語」について一言いっておくか</a></h2><a href="http://generation1986.g.hatena.ne.jp/ukstudio/20080204/1202113687">最もタメになる「初心者用言語」まとめ UK is not Britonish</a>

「いい嫁」程度のお遊びのつもりでいたら、結構な騒ぎになっちゃっいました。とりあえずあのまとめを見ても、初心者の人は混乱してしまうと思うので自分なりに初心者さんへのメッセージもこめてエントリーを書いてみました。

<h2>簡単な流れの説明</h2>
一応簡単に今回の流れを説明しておくと、「初心者用言語」の流れの発端はまつもとさんの「<a href="http://www.rubyist.net/~matz/20080204.html#p01">初心者向けの言語</a>」。その後に、amachangの「<a href="http://d.hatena.ne.jp/amachang/20080204/1202096633">最もタメになる「初心者用言語」はJavaScript</a>」、西尾さんの「<a href="http://d.hatena.ne.jp/nishiohirokazu/20080204/1202104617">最もタメになる「初心者用言語」はPython!</a>」、hayamizの「<a href="http://d.hatena.ne.jp/hayamiz/20080204/1202108447">最もタメになる「初心者用言語」はScheme!</a>」と続く。後続の人達は彼等のエントリーや、オレのまとめを見て流れにのったんだと思う。

<h2>初心者の定義</h2>
流石に後の方になって「初心者とは具体的にどのような人を指すのか」という指摘がチラホラ出てきた。確かに今回の祭り全体を通して「初心者」の定義が曖昧で、エントリーを書いている人が想定している初心者像は各人それぞれな感じ。

今更「初心者」の定義をここでしたところで時既に遅しなのと、プログラマ経験者達が一般に言う「初心者」が多様なので、その辺りはあまり拘らずに話をすすめたいと思う。

<h2>何がしたいのか</h2>
今更言うことでもないのかもしれないけど、プログラミング言語はあくまでツールであり、プログラミングは手段。(まぁオレの場合、プログラミングそのものが目的になってる時も多いけど)

ツールである以上、<strong>達成したい目的に合わせて言語は選ぶべき。</strong>

その為にはまず<strong>自分が何がしたいのか</strong>を考えた方がいい。仕事でプログラミングを覚える必要があるなら、仕事で使う言語を選ぶべきだろうし、Webアプリを作りたいのであれば、PHP、Perl、Rubyあたりになると思う。そこからさらに開発環境や使えるサーバーから絞り込んでいけばいい。

もし、特に目的がなく漠然と「プログラミングしてみたい」と思っているとしたら、それこそ言語は何でもいいと思う。ただ、最初からプログラミングを目的してるとなんとなく挫折しやすい様にも思える。
とりあえず何でもいいから目的(ブログを作りたい、Twitterクライアントを作りたい、etc...)があった方が、モチベーションも保つし、自ずと方向性も決まってくるから学習しやすいと思う。

<h2>まわりに教えてくれる人がいるか</h2>
それと出来ればまわりに教えてくれる人がいる言語を選んで欲しい。もちろん、本やネットの情報だけで独学することも可能と言えば可能だけど、<strong>やっぱり身近に質問ができる人、アドバイスをしてくれる人がいるっていうのは大きい。</strong>

<blockquote>
そのジャンルにおける本当の初心者にとっては助けてくれる人の存在がかなり大事だと思う。
</blockquote>
<a href="http://www.akiyan.com/blog/archives/2008/02/post_106.html">あなたがプログラミングの初心者なら、友人知人が使っている言語にするといい</a>

<h2>興味があれば他の言語にも触れてみて</h2>
「達人プログラマー - システム開発の職人から名匠への道 -」では「<strong>毎年少なくとも一つの言語を学習する</strong>」ことを薦めている。

<blockquote>
言語が異なると、同じ問題でも違った解決方法が採用されます。つまり、いくつかの異なったアプローチを学習することにより、幅広い思考ができるようになるわけです。
</blockquote>

例えば、普段使っている言語がPHPだとしたら、低レベルかつ静的型付けのCや、関数型言語のHaskell、Lisp(Common Lisp、Scheme)などに手を出してみるといいと思う。

参考:<a href="http://itpro.nikkeibp.co.jp/article/COLUMN/20070618/275142/">総論 複数のプログラミング言語を学ぶ意義 - IT Pro</a>
参考:<a href="http://d.hatena.ne.jp/yuki_neko_nyan/20071011/1192069372">「関数型言語を学ばないといけませんか?」- 猫的怠惰生活Days</a>

<table border="0" cellpadding="5"><tr><td valign="top"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/4894712741/ukstudio0c-22/" target="_top"><img src="http://ecx.images-amazon.com/images/I/119HY1S5M2L.jpg" border="0" alt="達人プログラマー―システム開発の職人から名匠への道" /></a></td><td valign="top"><font size="-1"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/4894712741/ukstudio0c-22/" target="_top">達人プログラマー―システム開発の職人から名匠への道</a><br />アンドリュー ハント デビッド トーマス Andrew Hunt <br /><br />ピアソンエデュケーション  2000-11<br />売り上げランキング : 8641<br /><br /><a href="http://www.amazon.co.jp/exec/obidos/ASIN/4894712741/ukstudio0c-22/" target="_top">Amazonで詳しく見る</a></font><font size="-2"> by <a href="http://www.goodpic.com/mt/aws/index.html" >G-Tools</a></font></td></tr></table>

<h2>なにより楽しむ</h2>
色々書き並べてみましたが、一番大事なのは<strong>あなたがプログラミングを楽しむことです。</strong> 仕事でも趣味でも大いにプログラミングを楽しんで下さい。
</article><hr /><article><h2><a href="/2008/02/02/doukaku_lifegame/">2008-02-02 Rubyでライフゲーム書いた</a></h2><a href="http://ja.doukaku.org/comment/5581/">どう書く?org #5581</a>

久々にどう書くorgに投稿してみた。1個1個セルの周り調べてくのも面白みがないなと思って、生きてるセルの周りをスコア付けしてくやり方でやってみた。

生きてるセルに+10し、生きてるセルの周りに+1していく。最終的にスコアが3(まわりに3つの生きてるセルがある)のセルは次世代で誕生するセルと判断。スコアが12もしくは13の(今の世代で生きてるセルで、まわりに2つもしくは3つの生きてるセルがある)のセルは次世代も維持するセルと判断。

テストはWikipediaの<a href="http://ja.wikipedia.org/wiki/ライフゲーム">ライフゲームのページ</a>から振動型(ブリンカー、ヒキガエルなど)を試しただけで、テストコードすら書いてない。だからもしかしたら間違ってるかもしれない。許せ。

<pre lang="ruby">
require 'curses'

module LifeGame
  class World
    def initialize(map)
      @map = map
    end

    def to_s
      str = ""
      @map.each do |line|
        line.each do |cell|
          str += "[#{cell}]"
        end
        str += "¥n"
      end

      str
    end

    def next
      ranking.each_with_index do |line, h|
        @map[h] = line.map {|cell| [3, 12, 13].include?(cell) ? '*' : ' ' }
      end
    end

    private
    def live_list
      list = []
      @map.each_with_index do |line, h|
        line.each_with_index {|cell, w| list < < [h,w] if cell == '*'}
      end

      list
    end

    def set_score(rank_map, live)
      (-1..1).each do |x|
        (-1..1).each do |y|
          score = x == y && y  == 0 ? 10 : 1
          rank_map[live[0]+x][live[1]+y] = rank_map[live[0]+x][live[1]+y] + score
        end
      end
    end

    def ranking
      rank_map = List.new
      @map.size.times { rank_map << List.new(@map[0].size, 0) }

      live_list.each do |live|
        set_score(rank_map.clone, live)
      end

      rank_map
    end
  end

  class List < Array
    alias original_get []
    alias original_set []=

      def [](index)
        original_get(index % size)
      end

    def []=(index, value)
      original_set(index % size, value)
    end
  end
end

if __FILE__ == $0
  begin
    game = LifeGame::World.new([
                                [' ', '*', ' ', ' ', ' ', ' ', '*', '*', '*', ' '],
                                [' ', ' ', ' ', ' ', '*', ' ', ' ', '*', '*', ' '],
                                [' ', ' ', ' ', '*', ' ', ' ', '*', ' ', '*', ' '],
                                ['*', ' ', '*', '*', ' ', ' ', '*', ' ', ' ', ' '],
                                [' ', '*', ' ', ' ', ' ', ' ', ' ', ' ', '*', ' '],
                                ['*', ' ', ' ', ' ', '*', ' ', '*', '*', ' ', '*'],
                                [' ', '*', ' ', ' ', ' ', ' ', '*', ' ', ' ', ' '],
                                [' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '*'],
                                ['*', ' ', ' ', ' ', ' ', ' ', '*', ' ', ' ', '*'],
                                [' ', ' ', ' ', ' ', '*', '*', ' ', ' ', '*', ' ']])

    window = Curses::Window.new(Curses.lines, Curses.cols, 0, 0)
    loop do
      window.setpos(0, 0)
      window.addstr(game.to_s)
      game.next
      window.getch
    end
  ensure
    window.close
  end
end
</pre></pre>
</article><hr /><article><h2><a href="/2008/01/22/yaboo/">2008-01-22 野望新年会に参加してきました</a></h2>書くのが遅くなっちゃいましたが、なんとかエントリーアップです。


<a href="http://www.yabooo.org/archives/13">いずれにせよ野望新年会2008</a>

19日、pinkmacさん主催の野望新年会に乗り込んできました。きっかけとしてはpinkmacさんの1981sでのエントリー。(<a href="http://born1981.g.hatena.ne.jp/pinkmac/20080108/1199798490">いま、日本のITは変わるかもしれない</a>)


1986って書いてあったので、せっかくだから行ってみるかーぐらいのノリ。こっそり1986sの方で<a href="http://generation1986.g.hatena.ne.jp/ukstudio/20080111/1200060303">宣伝</a>してたわけだけど、86sの人に聞いたら結構これを見て知ったって人が何人かいた。よかったよかった。


参加者は大体20人ほど。86世代から団塊世代(オレの40歳ぐらい年上!!)まで。学生や社会人、さらには外人の方まで!かなり多種多様な人達で構成されてました。実は参加者を事前に一切知らなくて、いざ集まってみたら、エロギークのyusukebeさんや先日はてなを退職し、百度にうつったid:mizuno_takaakiさんとかがいてびっくり。


LTの詳細は各人の資料やエントリーにまかせたいと思うけど、印象としてはみんな色んなことしてるんだなぁって感じ。個人的に特に印象に残っているのは、<a href="http://d.hatena.ne.jp/earth2001y/">id:earth2001y</a>さんのC++でのFizzBuzz、<a href="http://yusukebe.com/">yusukebe</a>さんのYourAVHostの話、<a href="http://d.hatena.ne.jp/mizuno_takaaki/">id:mizuno_takaaki</a>さんの中国との開発の話(文字コードとか)がおもしろかった。


で、結局「野望会」ってなんなの？って話なんだけど、正直うまく説明できない。そこで、みんなはレポどんなの書いてるわけと色々漁ってたら、yusukebeさんがうまく言い表してくれてた。<a href="http://yusukebe.com/archives/08/01/21/205726.html">「わからない」という求心力</a>。うまいなぁ・・・


そんなわけで、無事「野望新年会」おわりました。pinkmacさんをはじめ、事務局の皆さん、参加者の皆さん、お疲れ様でした。とても楽しかったです。なんか色々これからもおもしろそうなことがありそうな集まりなので、ちょこちょこ参加していけたらいいなぁと思います。

どうぞよろしく!!
</article><hr /><article><h2><a href="/2008/01/12/ruby_tumblr_getimages_2nd/">2008-01-12 Tumblrの全画像を取得するRubyスクリプト改</a></h2><a href="http://uk-studio.net/2008/01/11/ruby_tumblr_getimages/">Tumblrの全画像を取得するRubyスクリプトを書いた・・・けど</a>

上のエントリーのコードを書き直した。これで10kb未満の画像でも問題ないはず。それとTumblrのIDを引数で与えるようにも修正した。独自ドメインのやつには対応してないです。ごめんなさい。

あとこっそり<a href="http://coderepos.org/share/browser/lang/ruby/misc/tumblr_getimages.rb">CodeReposにCommitした</a>ので、煮るなり焼くなりお好きにどうぞ。

<pre lang="ruby">
require 'open-uri'
require 'rexml/document'
require 'FileUtils'

if ARGV.size != 1
  puts "Usage: #{$0} [id] "
  exit
end

id = ARGV[0]

res = open(url)
doc = REXML::Document.new(res.read)
total = REXML::XPath.first(doc, "/tumblr/posts").attributes['total'].to_i

0.step(total, 50){|n|
  image_list = []
  res = open(url + "&start=#{n}")
  doc = REXML::Document.new(res.read)
  data = REXML::XPath.match(doc, "/tumblr/posts/post")
  data.each{|i| image_list < < i.elements['photo-url'].text }

  image_list.each{|image_url|
    open(image_url) do |image|
      open(image_url.split(/\//).last, "w") do |local_image|
        local_image.write(image.read)
      end
    end
  }
}
</pre></pre>
</article><hr /><article><h2><a href="/2008/01/12/blog/">2008-01-12 オレがブログを書く理由</a></h2>まめこの「<a href="http://blog.woopsdez.jp/2008/01/post_294.php">車輪の再発明だとしても記事は書くべき</a>」に反応してみる。「記事をかくべき」というのには非常に同意。

じゃあ、なぜ「かくべき」なのか。それは人それぞれになると思うけど、オレがブログを書く理由を簡単にまとめてみたのでよければ参考にしてほしい。

<h2>ブログは自分の為に書く</h2>
基本的にブログは自分の為に書いている。あまり他の人に役立つかどうかとか、誰か似たようなこと書いてるだろうなとかは気にしない。

<h3>思考のツールとしてのブログ</h3>
文章を書くということは、ある程度自分の思考を整理することになる。別にこれだけならブログでなくとも、ノートや日記帳、テキストファイルやローカルなWikiでもいい。けれど、公開してるブログにはそれらにない特徴がある。

不特定多数の人に見られるということである。

不特定多数に見られるということは、少なくとも自分が「人にみせてもいい」と思えるレベルになるまで文章を推古することになる。その過程で自分なりになるべく客観的に文章を判断しようとする。そうすることで今迄とはまた違った視点で物事を考えられるわけだ。

また、不特定多数から何らかの反応(コメント、トラックバック、etc)があった場合、それはローカルな環境での記録ではなかなか得られないものだ。自分のノートに書いといただけでは、誰もそれについて考えるといったことはしない。

<h3>最大の読者は自分</h3>
当たり前の話だけど、過去の自分に会うことはできない。もちろん、昔に自分がどんなことを考え、どんなことをしていたのか覚えてるとも限らない。人は忘れる生き物だ。

けれどブログに記事を書いておけば、その記事を見にいくことによって擬似的にだけど当時の自分と会うことができる。過去の自分は全くの別人なのではないかと思う時もある程、思考の違いに驚くことがある。過去のエントリと現在の自分の思考の違いから学ぶことも多いものだ。

ある一定以上、ブログを続けているとそのうちデータベースとして機能するようになる。自分が何を考え、何に悩んでいたのか。そしてどんな行動をしてきたのか。それらが記録されているブログは後に貴重な財産となるはず。

<h3>コラボレーション</h3>
各人のアウトプットが1つのコラボレーションを生むことがある。最近の例で言えば、<a href="http://born1981.g.hatena.ne.jp/">1981s</a>がそうなのではないかと思う。

<a href="http://d.hatena.ne.jp/kamawada/20071128/1196228938">ゆーすけべーさんが発案</a>し、<a href="http://d.hatena.ne.jp/amachang/20071128/1196241194">amachangが呼び掛ける</a>。実はあまり詳しい経緯を追ってないので間違ってたら申し訳ないけれど、少なくともゆーすけべーさんが記事をかかなければ1981sが存在しなかったのは確か。

1981sに限らず、誰かがブログで言いだしたのがきっかけで生まれたものはたくさんあるんじゃないかと思う。

<h2>「書くべき」は言い過ぎかもしれないけど</h2>
最初に同意しといてここで言い過ぎと言うのはおかしいかもしれないけど、そもそも強制されるようなものでもないと思うので。ただ、少なくともオレはブログを書くことで色々得るものが多いと思うので「ブログイイヨー、オススメダヨー」ぐらいのノリでオススメしておきます。
</article><hr /><article><h2><a href="/2008/01/11/ruby_tumblr_getimages/">2008-01-11 Tumblrの全画像を取得するRubyスクリプトを書いた・・・けど</a></h2>今じゃほとんどTumblrは使ってないんだけど、なんとなく画像を取得するスクリプトを書いてみた。iPod touchに放り込んでみようかなとか思ったのよ。

とりあえずコード。
<pre lang="ruby">
require 'open-uri'
require 'rexml/document'
require 'FileUtils'

res = open(url)
doc = REXML::Document.new(res.read)
total = REXML::XPath.first(doc, "/tumblr/posts").attributes['total'].to_i

0.step(total, 50){|n|
  image_list = []
  res = open(url + "&start=#{n}")
  doc = REXML::Document.new(res.read)

  data = REXML::XPath.match(doc, "/tumblr/posts/post")
  data.each{|i| image_list < < i.elements['photo-url'].text }

  image_list.each{|image|
    tempfile = open(image)
    FileUtils.cp(tempfile.path, image.split(/\//).last)
  }
}
</pre>
ちなみにXPathはどんなものかなんとなくは知っていたけれど使うのは初めて。

処理内容としてはTumblr APIを使って50件ずつ画像のURLを取得して、1個ずつカレントディレクトリにコピーすると言う至極単純な方法を選んだ。人によっては1000単位で画像があるだろうから(ちなみにオレは1000ちょいだった)かなり時間がかかると思う。

1つよくわからない現象が起きていて、とある画像を取得するタイミングで必ずエラーが発生する。どの画像かまでは調べてないけど、いつも同じ画像なのは確か。

</pre><pre lang="bash">
/opt/local/lib/ruby/1.8/FileUtils.rb:1407:in `fu_each_src_dest0': undefined method `to_str' for nil:NilClass (NoMethodError)
        from /opt/local/lib/ruby/1.8/FileUtils.rb:1393:in `fu_each_src_dest'
        from /opt/local/lib/ruby/1.8/FileUtils.rb:382:in `cp'
        from tumblr_getimages.rb:19
        from tumblr_getimages.rb:17:in `each'
        from tumblr_getimages.rb:17
        from tumblr_getimages.rb:10:in `step'
        from tumblr_getimages.rb:10
</pre>

とりあえず、openで取得したtempfileとtempfile#pathをpで表示してみた。以下がその問題が起きる部分。なぜにStringIO・・・?
<pre lang="bash">
#<file :/var/folders/ni/niHXwO9-GoO0yPJpz3WMm++++TI/-Tmp-/open-uri.1153.4>
"/var/folders/ni/niHXwO9-GoO0yPJpz3WMm++++TI/-Tmp-/open-uri.1153.4"
#</file><file :/var/folders/ni/niHXwO9-GoO0yPJpz3WMm++++TI/-Tmp-/open-uri.1153.5>
"/var/folders/ni/niHXwO9-GoO0yPJpz3WMm++++TI/-Tmp-/open-uri.1153.5"
#<stringio :0x5c4af4>
nil
</stringio></file></pre>

無理矢理な対処としてはコピーの処理の時にオブジェクトのクラスを調べて、StringIOを回避すればとりあえずは何とかなる。そのかわり、その画像はローカルに保存されないけれど。

<pre lang="ruby">
  FileUtils.cp(tempfile.path, image.split(/\//).last) if tempfile.kind_of?(Tempfile)
</pre>

ちなみに1000件も取得するのが途中で面倒になってしまったので最後まで取得できるかまでは試してない。一応100件ぐらいは取得できたけど。

tumblrのIDとか取得の開始地点、1回で取得する件数とかそのまま直書きしちゃってるけど、コマンドラインの引数で与えるようにすればそれなりに使い勝手がよくなるかもしれない。

本当はページ番号と1ページごとの件数を与えれば、そのページの画像を取得するようにするつもりだったんだけどね。他にもテキストとかがたんぶらってあったりすると画像の数が不確定で、そこらへんどううまく処理するかとか考えると結構時間かかりそうだったからやめた。

<h2>追記: 08/01/11 6:13</h2>
エラーが発生する画像を特定した。
<a href="http://data.tumblr.com/14065003_500.jpg">http://data.tumblr.com/14065003_500.jpg</a>

パっと見、普通の画像なんだけどな。試しにirbから取得してみる。
<pre lang="ruby">
>> require 'open-uri'
=> true
>> tempfile = open("http://data.tumblr.com/14065003_500.jpg")
=> #<stringio :0x3d4384>
</stringio></pre>
やっぱり、StringIOオブジェクトだ・・・なんでー?

<h2>追記: 08/01/11 10:25</h2>
ちょっとググってみたらruby-listの過去ログが引っかかった。

<a href="http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-list/40937">Re: multipartフォームから受け取ったオブジェクトにstatメソッドでエラー</a>

上のリンクはcgi.rbの話だけど、open-uriでもどうやら10kb未満の画像だとTempfileではなく、StringIOになる模様。ちなみに該当の画像は8kbでした。こやつめ、ハハハ。

<h2>追記 08/01/12 1:27</h2>
コードを修正しました。
<a href="http://uk-studio.net/2008/01/12/ruby_tumblr_getimages_2nd/">Tumblrの全画像を取得するRubyスクリプト改</a>
</article><hr /><article><h2><a href="/2008/01/09/2007_history/">2008-01-09 2007年はTwitterが中心の1年でした</a></h2>今更感があふれるエントリですね。

<h2>1、2、3月</h2>
<ul>
<li>覚えてない</li>
</ul>
<h2>4月</h2>
<ul>
<li><a href="http://twitter.com/ukstudio/statuses/20520981">Twitterを始める</a></li>
</ul>
<h2>5月</h2>
<ul>
<li>CSS Nite LP3に参加</li>
</ul>
<h2>6月</h2>
<ul>
<li><a href="http://uk-studio.net/2007/06/21/twitter_offline_party/">amachang主催のついったーオフに参加</a></li>
<li>miniturbo主催のモバイル勉強会に参加</li>
<li><a href="http://uk-studio.net/2007/06/24/twitter_meganeoff/">ついったーメガネオフに参加</a></li>
</ul>
<h2>7月</h2>
<ul>
<li>amachang主催、JSを語り合う会に参加</li>
<li><a href="http://uk-studio.net/2007/07/16/070714_js/">JS勉強会を主催</a></li>
<li><a href="http://uk-studio.net/2007/07/08/start-macbook/">UK、マカーになる</a></li>
<li>WEB標準の日々に参加</li>
</ul>
<h2>8月</h2>
<ul>
<li>ついったー盆フェスに参加</li>
<li>LL魂に参加</li>
<li>@youchan主催セキュリティ勉強会に参加</li>
</ul>
<h2>9月</h2>
<ul>
<li>PHPカンファレンス2007に参加</li>
<li>Shibuya.js 24に参加</li>
<li>ついったー写真部スタジオ勉強会に参加</li>
<li>woopsdez主催デザイン勉強会に参加</li>
<li><a href="http://uk-studio.net/2007/09/07/ipod_touch/">iPod touchを予約する</a></li>
<li>Rubyを始めた気がする</li>
</ul>
<h2>10月</h2>
<ul>
<li>なんかのんびりしてた気がする</li>
</ul>
<h2>11月</h2>
<ul>
<li>ジョジョの奇妙な冒険にハマる</li>
<li>某社面接</li>
</ul>
<h2>12月</h2>
<ul>
<li>ついったー忘年会に参加</li>
<li><a href="http://uk-studio.net/2007/12/28/mac_leopard/">Leopard買った</a></li>
<li><a href="http://generation1986.g.hatena.ne.jp/">1986's発足</a></li>
<li>@yoshioriの家で年越し</li>
</ul>
<h2>ついったーで生活が一変</h2>
いや、本当に変わりすぎだろっていうぐらい変わってるなぁ。特に6月から9月がやばい。かなりアクティブ。まさか勉強会まで主催するとは。上には書いてないけれど、他にも結構細々としたところで生活が変わってる。まさについったー中心の年でした。

<h2>ありがとう。今年もよろしく</h2>
ついったーで知り合ったとある数名(名前は出さないけど察しろ。約3名だ)は5、6月ぐらいからかなりお世話になってるわけだけど、本当にありがたいことです。かなりプライベートな面までお世話になってるような・・・色々迷惑かけてると思うけど今年もよろしくです。

他にも直接面識はないけれど、ついったーを始めるきっかけになった100SHIKIの田口さんや、はじめてついったったーと会う勇気をくれた@amachang、@miniturbo。イベントを企画・主催してくれた人達や、勉強会の会場を提供してくれた@elfさん。本当に関西に住んでるんだかよくわからない某ぺんぎんをはじめ、たくさんのついったったーにもお世話になりました。ありがとうございます。

あと忘れちゃいけないのが、ついったーの開発陣ですね。遅延だのメンテだの色々あったけれど、ついったーがあって本当によかったと思います。ありがとう。

そんなわけで2007年はなかなか忘れられない年になりそうです。2008年はどんな年にしようかな。
</article><hr /><article><h2><a href="/2008/01/06/1986s/">2008-01-06 86世代あつまれー</a></h2>ちょこちょこと一部で話題にあがってた同世代のエンジニアで集まってみようの件だけど、yuyarinさんがはてなグループを作ってくれました。

<a href="http://d.hatena.ne.jp/yuyarin/20071221/1198240756">IT＆IS系の'86世代でちょっと集まってみませんか？＠東京</a>
<a href="http://generation1986.g.hatena.ne.jp/yuyarin/20071230/1199018717">1986のはてなグループ作ったよー</a>
<a href="http://generation1986.g.hatena.ne.jp/">1986s</a>

現時点のメンバーはこんな感じ↓
<a href="http://generation1986.g.hatena.ne.jp/keyword/メンバー一覧">メンバー一覧</a>
まだまだ少ないので参加者求む。

<a href="http://twitter.com/_tad_/statuses/565676282">都市伝説と思われていたujihisaさん</a>もいるよ!

それにしても、年上だと思ってた人が結構いるんだよなぁ。なんか「若い」ってことを言い訳にできない気がした。
</article><hr /><article><h2><a href="/2008/01/02/agile_practice/">2008-01-02 アジャイルプラクティス - 達人プログラマに学ぶ現場開発者の習慣</a></h2><a href="http://fkino.net/">木下さん</a>と<a href="http://kakutani.com/">角谷さん</a>が監訳したアジャイル本。なんとか年内に読み終わった。このエントリーを書くのは2008年になってしまったけど。

<h2>アジャイルな開発者もそうでない開発者も</h2>
今までアジャイルな開発とは無縁だった人達も、既にアジャイルな開発手法を採用している人達、どちらの人達にも得るものがある本だと思う。前者の人達にはこれからの道標として、後者の人達には振り返りとして。ちなみに私は前者。

そもそも本書での「アジャイル」の定義は以下のようになっている。
<blockquote>
開発がアジャイルであるということは、協調性を重んじる環境で、フィードバックに基づいた調整を行ない続けることである
</blockquote>

つまり、開発手法がXPとかScrumである必要はないし、極端な話、組織とかすら関係なく開発者が自分1人だけでもアジャイルな開発は行なえる。なぜなら、未来の自分に対してフィードバックをすればいい話だから。アジャイルプラクティスにも1人で実践できるプラクティスがいくつか載っている。

<h2>悪魔の囁き、天使の助言</h2>
各プラクティスの構成は、悪魔の囁きに打ち勝つべく天使の助言を授かるという形ですすめられている。まさに表紙の通り悪魔 VS 天使の構図なわけだ。悪魔の囁きはちょっと表現がオーバーな気もするけど、そこが悪魔っぽいと言えば確かに悪魔っぽい。仮に悪魔の囁きにピンとこなかったとしても、天使の助言は聞いとくべきだし、なんなら悪魔の囁きを自分なりに変えてみるのもいいと思う。

<h2>まずは1つのプラクティスから</h2>
いくら天使の助言を聞いたところで、それを習慣にしなければ意味がない。アジャイルプラクティスには全部で45のプラクティスが掲載されているが、流石に一度に全部実践しようと思ってもまず無理だ。とりあえず自分にとって重要なプラクティスを1つ選んで、それが習慣づいたところで次のプラクティスに進むのがいいと思う。(プラクティスによっては複数同時に実践できるかもしれない)

この辺に関しては「第9章 終章：アジャイルへ踏み出す」を読んでもらえればいいと思う。アジャイルへ踏み出すと言うタイトルからもわかるように、この本を読んで終わりじゃいけない。むしろ読み終わってからが本番なのだろう。

<table border="0" cellpadding="5"><tr><td colspan="2"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/4274066940/ukstudio0c-22/" target="_top">アジャイルプラクティス 達人プログラマに学ぶ現場開発者の習慣</a></td></tr><tr><td valign="top"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/4274066940/ukstudio0c-22/" target="_top"><img src="http://ecx.images-amazon.com/images/I/31paqWCAEVL.jpg" border="0" alt="アジャイルプラクティス 達人プログラマに学ぶ現場開発者の習慣" /></a></td><td valign="top"><font size="-1">Venkat Subramaniam Andy Hunt 木下 史彦 <br /><br />オーム社  2007-12-22<br />売り上げランキング : 16000<br /><br /><strong>おすすめ平均  </strong><img src="http://g-images.amazon.com/images/G/01/detail/stars-5-0.gif" alt="star" /><br /><img src="http://g-images.amazon.com/images/G/01/detail/stars-5-0.gif" alt="star" />迷える開発者への最初の一歩となる本<br /><br /><a href="http://www.amazon.co.jp/exec/obidos/ASIN/4274066940/ukstudio0c-22/" target="_top">Amazonで詳しく見る</a></font><font size="-2"> by <a href="http://www.goodpic.com/mt/aws/index.html" >G-Tools</a></font></td></tr></table>
</article><hr /></div></body></html>