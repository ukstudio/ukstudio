<!DOCTYPE html><html><head><meta charset="utf-8" /><!--Always force latest IE rendering engine or request Chrome Frame--><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><!--Use title if it's in the page YAML frontmatter--><title>The Middleman</title><link href="http://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet" type="text/css" /><link href="/stylesheets/normalize.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/all.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/highlight.css" media="screen" rel="stylesheet" type="text/css" /><script src="/javascripts/all.js" type="text/javascript"></script><link href="/feed.xml" rel="alternate" title="atom" type="application/atom+xml" /><script type="text/javascript">var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-12755601-1']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></head><body class="2009 2009_04 2009_04_index"><div class="cointainer-fluid"><div class="navbar navbar-default" role="navigation"><div class="container-fluid"><div class="navbar-header"><a class="navbar-brand" href="/">UKSTUDIO</a></div><div class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a href="http://twitter.com/ukstudio">Twitter</a></li><li><a href="http://github.com/ukstudio">GitHub</a></li></ul></div></div></div></div><div class="container"><h1><Archive></Archive>Apr 2009</h1><article><h2><a href="/2009/04/28/vim_hacks_project/">2009-04-28 Vim Hacks Projectはじめました</a></h2><a href="http://www.lingr.com/room/vim-users.jp/archives/2009/04/24#msg-66101529">Lingrでのkanaさんの発言がきっかけ</a>でVim Hacks Projectをはじめることにしました。

<h2>Vim Hacks Projectとは</h2>

<blockquote>
Foobar Hacksが出版されている昨今、是非Vim Hacksを出そうではないか! という訳で、手始めに有志を募って各々のVim Hacksをvim-users.jpにて認め、頃合いを見計らって企画を持ちかけよう! という計画。</blockquote>

とりあえず僕も参加します。僕の記事は29日0時に公開予定です。現在5人のローテーションで1hack/2dayで書き連ねていく予定です。

書き手はまだ募集中なので「我こそは!」という人がいれば是非参加を!

<a href="http://vim-users.jp/vim-hacks-project/">Vim-users.jp - Vim Hacks Project</a>
</article><hr /><article><h2><a href="/2009/04/20/atmarkit_1986/">2009-04-20 @ITの86世代の記事に載りました</a></h2>今月頭に<a href="http://jibun.atmarkit.co.jp/ljibun01/cs/200904/05/01.html">「ハチロク世代」がIT業界を変える日</a>という記事の取材を受けてて、先日その記事が公開されました。頭ぼさぼさの人が僕です。

まぁ大したことは話してないので、補足とかは特にないんですが、実際のところはタイトルに反して当の本人達は「おれたちがIT業界を変えるぞ!」っていう感じではないのかなーと。少なくとも自分自身と近しい86世代の人達は。(あくまでおれの印象だけど)

個人的な感覚としては同年代の頑張りをみて「おれもがんばるぞ!」的なモチベーションにつながればいいかなって感じ。なんだかんだで同年代の活動は刺激をうけます。

それと同じことは他の世代にも言えて、<q>こうやって無意味に世代間闘争に火を付けようとする報道に意味はあるのか？</q>ってコメントがはてブにあったけど、少なくとも俺個人には世代間闘争って感じはなくて、多分おれの知ってる範囲では他の人もそうだと思うんだけど、今回の記事をみて89世代や81世代の人達のモチベーションに繋がればいいんじゃないかなと僕は思います。逆に89世代や81世代、もちろん他の世代の人達を見て僕達のモチベーションもあがるわけで。

なんかそのうち(もうすでにいるかもしれないけど)、「記事に載ってるわりには大したことしてないじゃないか!なんかサービスを運営してたり、起業してたりしないの?」って人もいるかもしれないけど、そう言う人達も多分1986年生れの人で探せばいるだろうけど、少なくとも僕に関しては「僕が目指してるのはそこじゃないんで」としか言えないかなぁ。

なんか何が言いたいのかよくわからないエントリですが、よかったら記事を読んで頂けるとうれしいです。ちなみに髪を切れというリクエストには今のところ答えるつもりはないのであしからず。
</article><hr /><article><h2><a href="/2009/04/20/cucumber/">2009-04-20 Cucumberの登場でRailsのテスティング環境が変わった</a></h2>ちょっと大げさなタイトルかもしれないですが、個人的にはそれぐらいの感動。「これで勝つる!」な気分。何に勝つのか知らないけれど。

今までのRailsのテストはもっぱらRSpecで書いてて、確かにこれはこれで素晴らしい。採用当初はバグが減ってその時も「これで勝つる!」な気分でした。でもやっぱり受け入れテストがネックになるんですよね。Seleniumとかも使ったりしてましたけど、ブラウザががちゃがちゃ動くし、なんとなく面倒で結局手動で確認という感じになってしまいました。

そこでCucumberの登場ですよ。個人的に素晴しいと思うのは

<ul>
<li>テストケースが自然文(っぽい)</li>
<li>そんなに邪魔じゃない</li>
</ul>

あたりかなぁ。テストケースが自然文っぽいというのは実はかなり大事で例えば

<blockquote>
お客さん: まずトップページにアクセスするとログインフォームがあって、そこにログインすると「ようこそ!ほげほげさん」と出すようにして欲しい
</blockquote>

っていう要望、つまりユーザーストーリがあった場合に割とそのままシナリオとしてテストに変換できる。

<pre lang='ruby'>
もし トップページ にアクセス
かつ メールアドレス に hogehoge@hoge.com と入力
かつ パスワード に hogehoge と入力
かつ ログイン ボタンを押す

ならば ようこそ!ほげほげさん と表示されること
</pre>

これは疑似言語とかじゃなくて、これがそのままテストとして実行できる。つまり今までこっちがブラウザをポチポチしてお客さんに「できましたー(多分)」と報告していて、お客さんからすると何をどうテストしていたのかが曖昧という問題があったのだけれど、 Cucumberだと<strong>お客さんと一緒に受け入れテストを作ることができて、そのテストケースもお客さんが読むことができる</strong>から曖昧さが消えて安心が生まれる。

もちろん開発者にもメリットはあって、Cucumberはユーザ視点レベルのテストだからテストとしては一番外側なテストでここのテストがちゃんと通っていれば、アプリケーションの動作がユーザ視点での正しく動くという保証ができるわけです。

その保証ができるとどうなるかと言うと、極端な話、ユーザ視点での動作が正しければ内部の動作なんて割とどうでもいいわけで、内部に自由がでてきます。内部に自由がでてくると、コードの修正や設計の変更が怖くなくなり、リファクタリングがしやすくなります。結果、メンテのしやすいアプリが出来上がります。

Cucumberは残念なことに、Ajaxのテストができないのでその辺りはSeleniumや手動での確認、あとはjsonやxmlを吐き出すアクションをRspecでテストするなど臨機応変に対応する必要がありそうです。

最後にオマケですが、僕が実際にCucumberを使ったときの開発の流れをば。

<ul>
<li>Cucumberのシナリオを書く</li>
<li>Rspecでモデルのテストを書く</li>
<li>モデルにロジックを書く</li>
<li>Rspecでコントローラとビューのテストを書く</li>
<li>コントーラとビューを書く</li>
<li>Cucumberのテストが通ったのを確認して、実際に手動でも確認する</li>
<li>それぞれのテストをautotestとかでまわしながらリファクタリング</li>
</ul>

まず最初にCucumberのシナリオを書きます。仕様のブレを防ぐためです。この時点では当然Cucumberのテストは通りませんが、とりあえずモデルからビューにかけてボトムアップでコードを書きます。基本的にテストファーストです。

ビューまで書いたらこの時点でCucumberのテストが通っていれば手動で確認、通っていなければ同じ要領でテストファーストでコードを書きます。

最後に今まで書いたテストが落ちないようにリファクタリングを行います。ここまでで1つのユーザストーリ(Cucumberでいうフィーチャ)の実装が完了します。

CucumberはRspecの時もそうでしたが、新しく導入するときにどうしてもコストがかかります。でも慣れてくればそのコストは大分減りますし、stepもある程度使いまわせるものが多いので長期的に見れば逆にコストが減ると思っています。個人的にはCucumberを採用しない理由はないと思うので、この記事を読んでいる人も是非試してみてください。
</article><hr /><article><h2><a href="/2009/04/14/accepts_nested_attributes_for/">2009-04-14 accepts_nested_attributes_forしたモデルの日本語化</a></h2>名前、長いよね。accepts_nested_attributes_for。以下、ネストしたって言います。長いので。

最近はもっぱら日本語化はi18nにしてるんですが、今回ちょこっとこのネスト関係ではまったのでメモ。

<script src="http://gist.github.com/94931.js"></script>

とりあえずモデルの作成までガッとやります。Railsのバージョンは2.3.2です。最下行はgemのインストールが必要です(<a href="http://github.com/amatsuda/i18n_generators/tree/master">http://github.com/amatsuda/i18n_generators/tree/master</a>)

<script src="http://gist.github.com/94933.js"></script>
<script src="http://gist.github.com/94934.js"></script>

それぞれアソシエーションとバリデーションのコードを追記しておきます。当然、accepts_nested_attributes_forの記述も必要です。その辺の詳細は省くので適当にググってみてください。

で、日本語化はモデルを作成した後に行なっているのでとりあえずカラムは日本語化されてる筈です。その辺の詳細も省きます。

<script src="http://gist.github.com/94935.js"></script>

されてるはずなのですが、一部日本語化されてない箇所があるのでこれを日本語化させます。

<script src="http://gist.github.com/94936.js"></script>

userモデルのところにentries_xxxが追記されています。ちなみにhas_oneの場合はentry_xxxになります。xxxはカラム名。

<script src="http://gist.github.com/94937.js"></script>

おわり。
</article><hr /><article><h2><a href="/2009/04/06/vim_mtl/">2009-04-06 Vim勉強会 in MTLで話してきました</a></h2><a href="http://atnd.org/events/482">Vim勉強会 in MTL : ATND</a>
当日の<a href="http://www.lingr.com/room/vim_mtl/archives/2009/04/03">Lingrのログ</a>と<a href="http://www.flickr.com/photos/iandeth/sets/72157616306681532/">写真</a>と<a href="http://www.ustream.tv/channel/vimmtl20090403">録画</a>

録画はあまり質に期待しないでとのこと(見てない)

<h2>便利なVimスクリプトやTips紹介 id:iandeth</h2>
タイトル通り便利なTipsの紹介。個人的には今回の勉強会に参加してくれた人達を見ると、これぐらいの内容が丁度よかったのかなーって思う。おれのはちょっと調子に乗りすぎたw

<h2><de>Vim捌きを上達させる、たったひとつの冴えたやり方</del>至高のエディタには、至高のキーボード id:ursm</h2>
Vim勉強会なのにVimの話を一切しないという荒技。4万円ぐらいのキーボードの営業してました。フットペダル欲しいです。

<h2>Vim Script DE OOP id:ukstudio</h2>
とりあえず<a href="http://www.slideshare.net/ukstudio/vim-de-oop">資料</a>

完全に参加者置いてけぼりの発表内容でした。まぁネタだからいいんです。Vim ScriptでOOPはネタです。

Vim Scriptは名前空間とスクリプトローカルなスコープとかがあるのである程度規模が大きくてもなんとかなるので、無理矢理OOPする必要ないです。

if_rubyもOOPできるというよりはVim Scriptヨクワカラナイヨーな人が気軽にスクリプト書きたい時にちょこちょこっと使うってのが多いんじゃないですかね。if_rubyのプラグインってほとんどみないいし。ujihisaのmixi.vimだっけ、そこらへんの連投スクリプトぐらい。

今回のはどっちかというと僕個人がおれおれOOPというかそゆのをVim Scriptで作るのが楽しかったという理由だけでこの内容をチョイスしました。 ちなみにVim Scriptはスコープや可変長引数の文法がパッと見わかりづらいですけど、慣れればそんな難しい言語ではないですよ。一度挑戦してみるといいと思います。

<h2>懇親会</h2>
懇親会ではピザを食べながら適当に談笑しつつ、Rails.vimやオススメのプラグイン教えてと言われたので適当にプロジェクタ使って話してました。以下プラグインのリスト。

<h3><a href="http://www.vim.org/scripts/script.php?script_id=1567">Rails.vim</a></h3>
VimでRails開発するなら必須です。最初はとりあえず:Rcontroller, :Rmodel, :Rviewとgf、:Rpartialあたり使っておけばいいんじゃないでしょうか。

<h3><a href="http://www.vim.org/scripts/script.php?script_id=294">Align.vim</a></h3>
整形したいコードをヴィジュアルモードなどで選択して,t=とかやると=でキレイに並べてくれます。コードの整形にこだわりのある人へ。

:[Range]Align=>とかやると複数の文字(この例だと=>)で整形できます。これはid:ursmさんに教えてもらいました。

<h3><a href="http://www.vim.org/scripts/script.php?script_id=2290">smartchr.vim</a></h3>
id:haltさんの記事を読むといいと思います。

<a href="http://project-p.jp/halt/anubis/blog_show/1068">smartchrというvim pluginが簡単便利で目ウロコ - /halt/Snapshot</a>

<h3><a href="http://www.vim.org/scripts/script.php?script_id=1984">fuzzyfinder.vim</a></h3>
バッファで開いてるファイルとか最近使ったファイルとかを開くのに便利です。コマンド呼び出すのは面倒なので適当にマッピングして使いましょう。

<blockquote>
nmap fb :FuzzyFinderBuffer<cr>
nmap ff :FuzzyFinderFile<cr>
nmap fm :FuzzyFinderMruFile<cr>
</blockquote>

これtaku-oさんの<a href="http://d.hatena.ne.jp/taku-o/20090404/1238829761">指摘</a>で気づきましたけど、fがもろに被ってますね。よい子は他のキーにマッピングしましょう。

<h3><a href="http://github.com/Shougo/neocomplcache/blob/master/presen/neocomplcache.txt">neocomplecache.vim</a></h3>
autocomplpop.vim的な補完プラグインです。詳細はとりあえずリンク先を見ればいいと思います。

<a href="http://www.lingr.com/room/vim-users.jp">vim-users.jpのlingr</a>に作者がいるので興味がある人、物申したい人は来たらいいんじゃないでしょうか。


<h2>永和システムマネジメント及びMTLの皆様に感謝</h2>
今回はちょっとしたことがきっかけで勉強会を行うことになったわけですが、永和システムマネジメントの角谷さん、MTLの石橋さん、小林さん他、このような場を提供して頂きありがとうございました!

また、ATNDを見る限り50人弱の人に参加して頂いたようなのですが、お忙しいところありがとうございました。

またどこか別の機会がありましたらよろしくお願いします。

追記: 永和システムマネジメントを永和マネージメントシステムと誤表記していました。ごめんなさい。
</article><hr /></div></body></html>