{"componentChunkName":"component---src-templates-blog-post-js","path":"/posts//2008/10/04/rails_many_db/","result":{"data":{"site":{"siteMetadata":{"title":"UKSTUDIO BLOG"}},"markdownRemark":{"id":"74e1a9aa-12a9-5dcc-bb3f-61eaacbe62d1","excerpt":"プラグインとか無しで、複数のDB(MySQLとPostgreSQL)を扱う方法。Rails2.1でしか試してないけど、多分1.2とかでも大丈夫。多分。MySQLとPostgreSQLの接続ライブラリはgemからインストールしておくこと。 まずは、database.yml…","html":"<p>プラグインとか無しで、複数のDB(MySQLとPostgreSQL)を扱う方法。Rails2.1でしか試してないけど、多分1.2とかでも大丈夫。多分。MySQLとPostgreSQLの接続ライブラリはgemからインストールしておくこと。</p>\n<p>まずは、database.ymlに扱うデータベースの定義を書く。</p>\n<pre lang=\"ruby\">\ndevelopment:\n  adapter: mysql\n  encoding: utf8\n  database: db_development\n  username: root\n  password:\n\ntest:\n(面倒だから略)\n\nproduction:\n(面倒だから略)\n\npsql_development:\n  adapter: postgres\n  encoding: utf8\n  database: ma2_mcd\n  username: root\n  password:\n\npsql_test:\n(面倒だから略)\n\npsql_production:\n(面倒だから略)\n\n</pre>\n<p>次にPostgreSQLに接続させたいモデルを編集する。例えば、ProfileモデルはPostgreSQLの方に接続させたい場合は以下のようになる。</p>\n<pre lang=\"ruby\">\nclass Profile < ActiveRecord::Base\n  establish_connection(\"psql_#{RAILS_ENV}\".to_sym)\nend\n</pre>\n<p>establish<em>connectionにシンボルでdatabase.ymlの定義を渡せば、そのモデルはその定義のデータベースに接続する。本番、テスト、開発でそれぞれ定義が違うだろうから、RAILS</em>ENVで今起動している環境の定義を呼び出すようにしてやる。</p>\n<h2>追記</h2>\n上記の設定で一応アプリは動作するけど、いくつか問題点があるのでそれをメモしておく。\n<h3>マイグレーションの使い分けはどうする</h3>\n例えば、db/migrateにcreate_hoge_for_psql.rb(数値は略)とcreate_foo_for_mysql.rbと合った場合、それをどう実行するかが問題になってくる。\n<p>普通にrake db:migrateやrake db:migrate RAILS<em>ENV=psql</em>developmentとやったら、hogeとfooが両方とも作られてしまう。こちらとして望んでるのは、hogeがPostgreSQLのみ、fooがMySQLのみにできて欲しい。</p>\n<p>うーむ、弱った。</p>","frontmatter":{"title":"RailsでMySQLとPostgreSQLを同時に扱う方法(+問題点)","date":"October 04, 2008","description":null}},"previous":{"fields":{"slug":"posts//2008/09/19/no_use_number_prime/"},"frontmatter":{"title":"数字を使わずに素数判定"}},"next":{"fields":{"slug":"posts//2008/10/06/vimm3/"},"frontmatter":{"title":"VimM#3開催のお知らせ"}}},"pageContext":{"id":"74e1a9aa-12a9-5dcc-bb3f-61eaacbe62d1","previousPostId":"8a25d727-6d24-5ebe-98bb-a846abde0bdc","nextPostId":"1edd4bed-8624-503b-8f67-eb980787fd54"}},"staticQueryHashes":["2841359383"]}