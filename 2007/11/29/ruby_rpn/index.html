<!DOCTYPE html><html><head><meta charset="utf-8" /><!--Always force latest IE rendering engine or request Chrome Frame--><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><!--Use title if it's in the page YAML frontmatter--><title>後置記法での計算</title><link href="http://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet" type="text/css" /><link href="/stylesheets/normalize.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/all.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/highlight.css" media="screen" rel="stylesheet" type="text/css" /><script src="/javascripts/all.js" type="text/javascript"></script><link href="/feed.xml" rel="alternate" title="atom" type="application/atom+xml" /><script type="text/javascript">var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-12755601-1']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></head><body class="2007 2007_11 2007_11_29 2007_11_29_ruby_rpn 2007_11_29_ruby_rpn_index"><div class="cointainer-fluid"><div class="navbar navbar-default" role="navigation"><div class="container-fluid"><div class="navbar-header"><a class="navbar-brand" href="/">UKSTUDIO</a></div><div class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a href="http://twitter.com/ukstudio">Twitter</a></li><li><a href="http://github.com/ukstudio">GitHub</a></li></ul></div></div></div></div><div class="container"><article><h1>後置記法での計算</h1><hr /><div class="article-body"><a href="http://ja.wikipedia.org/wiki/逆ポーランド記法">後置記法</a>の文字列を計算するようStringクラスを拡張してみた。
<strong>rpn.rb</strong>
<pre lang="ruby">
class String
  def rpn
    @expr = self.split(" ")
    stack = Array.new

    @expr.each {|i|
      if i == "+" || i == "-" || i == "*" || i == "/"
        stack = calc(i, stack)
      else
        stack < < i
      end
    }

    return stack[0]
  end

  private
  def calc(operator, stack)
    return Array(stack[1..-1].inject(stack[0].to_i){|result, i|
      reslut = result.__send__(operator, i.to_i)
    })
  end
end
</pre>
</pre><pre lang="ruby">
require 'rpn.rb'
"2 8 +".rpn #=> 10
"4 6 -".rpn #=> -2
"81 9 /".rpn #=> 9
"4 3 *".rpn => 12
"3 7 + 10 20 + 2 * 10 + 80 -".rpn
#=>10
</pre>
入力は文字列で返り値が数値なのが違和感あるかもしれないけど、String#hexもそんな感じだし別にいいかなと。

最初はモジュールにして、それをStringクラスにincludeしようとか思ってたんだけど、モジュールにするとselfで自身の文字列を取得する方法がわからなくて断念。モジュールのselfだとモジュール自身を指しちゃうんだよね。

あとはcalcメソッドの中がなんか汚いのも気になるなぁ。

全然関係ないけど、後置記法よりSchemeみたいな前置記法の方がわかりやすいと思った。
</div></article></div></body></html>