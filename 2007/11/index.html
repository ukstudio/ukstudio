<!DOCTYPE html><html><head><meta charset="utf-8" /><!--Always force latest IE rendering engine or request Chrome Frame--><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><!--Use title if it's in the page YAML frontmatter--><title>The Middleman</title><link href="http://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet" type="text/css" /><link href="/stylesheets/normalize.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/all.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/highlight.css" media="screen" rel="stylesheet" type="text/css" /><script src="/javascripts/all.js" type="text/javascript"></script><link href="/feed.xml" rel="alternate" title="atom" type="application/atom+xml" /><script type="text/javascript">var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-12755601-1']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></head><body class="2007 2007_11 2007_11_index"><div class="header"><div class="header-navigation"><ul><li><i class="fa fa-twitter"></i><a href="http://twitter.com/ukstudio">Twitter</a></li><li><i class="fa fa-github-alt"></i><a href="http://github.com/ukstudio">GitHub</a></li></ul></div><div class="header-title"><a href="/">UKSTUDIO</a></div></div><div class="container"><h1><Archive></Archive>Nov 2007</h1><article><h2><a href="/2007/11/29/ruby_rpn/">2007-11-29 後置記法での計算</a></h2><a href="http://ja.wikipedia.org/wiki/逆ポーランド記法">後置記法</a>の文字列を計算するようStringクラスを拡張してみた。
<strong>rpn.rb</strong>
<pre lang="ruby">
class String
  def rpn
    @expr = self.split(" ")
    stack = Array.new

    @expr.each {|i|
      if i == "+" || i == "-" || i == "*" || i == "/"
        stack = calc(i, stack)
      else
        stack < < i
      end
    }

    return stack[0]
  end

  private
  def calc(operator, stack)
    return Array(stack[1..-1].inject(stack[0].to_i){|result, i|
      reslut = result.__send__(operator, i.to_i)
    })
  end
end
</pre>
</pre><pre lang="ruby">
require 'rpn.rb'
"2 8 +".rpn #=> 10
"4 6 -".rpn #=> -2
"81 9 /".rpn #=> 9
"4 3 *".rpn => 12
"3 7 + 10 20 + 2 * 10 + 80 -".rpn
#=>10
</pre>
入力は文字列で返り値が数値なのが違和感あるかもしれないけど、String#hexもそんな感じだし別にいいかなと。

最初はモジュールにして、それをStringクラスにincludeしようとか思ってたんだけど、モジュールにするとselfで自身の文字列を取得する方法がわからなくて断念。モジュールのselfだとモジュール自身を指しちゃうんだよね。

あとはcalcメソッドの中がなんか汚いのも気になるなぁ。

全然関係ないけど、後置記法よりSchemeみたいな前置記法の方がわかりやすいと思った。
</article><hr /><article><h2><a href="/2007/11/27/ruby_euclid/">2007-11-27 ユークリッドの互除法をRubyで書いた</a></h2><pre lang="ruby">
def euclid(a, b)
  return nil if a < b
  return (a%b).zero? ? b : euclid(b, a%b)
end
</pre>

Rubyは三項演算子でもちゃんと値返すから3行目みたいな書き方が出来るからラクだ。</pre>
</article><hr /><article><h2><a href="/2007/11/24/the_little_schemer/">2007-11-24 The Little Schemer</a></h2><table class="g-tools_table"><tr><td colspan="2"><span class="g-tools_title"><a href="http://www.amazon.co.jp/gp/redirect.html%3FASIN=0262560992%26tag=ukstudio0c-22%26lcode=xm2%26cID=2025%26ccmID=165953%26location=/o/ASIN/0262560992%253FSubscriptionId=0G91FPYVW6ZGWBH4Y9G2" target="_top">The Little Schemer</a></span></td></tr><tr><td valign="top"><span class="g-tools_img"><a href="http://www.amazon.co.jp/gp/redirect.html%3FASIN=0262560992%26tag=ukstudio0c-22%26lcode=xm2%26cID=2025%26ccmID=165953%26location=/o/ASIN/0262560992%253FSubscriptionId=0G91FPYVW6ZGWBH4Y9G2" target="_top"><img src="http://ecx.images-amazon.com/images/I/115J0Y2ZQBL.jpg"  alt="The Little Schemer" /></a></span></td><td valign="top"><span class="g-tools_body">Daniel P. Friedman Matthias Felleisen Duane Bibby <br /><br /><strong>おすすめ平均</strong> <img src="http://g-images.amazon.com/images/G/01/detail/stars-5-0.gif" /><br /><img src="http://g-images.amazon.com/images/G/01/detail/stars-5-0.gif" alt="stars" />Schemeが好きになります<br /><img src="http://g-images.amazon.com/images/G/01/detail/stars-5-0.gif" alt="stars" />英語であるのが苦痛にならない楽しさ<br /><img src="http://g-images.amazon.com/images/G/01/detail/stars-5-0.gif" alt="stars" />面白いスタイル<br /><br /><a href="http://www.amazon.co.jp/gp/redirect.html%3FASIN=0262560992%26tag=ukstudio0c-22%26lcode=xm2%26cID=2025%26ccmID=165953%26location=/o/ASIN/0262560992%253FSubscriptionId=0G91FPYVW6ZGWBH4Y9G2" target="_top">Amazonで詳しく見る</a></span><span class="g-tools_by"> by <a href="http://www.goodpic.com/mt/aws/index.html" >G-Tools</a></span></td></tr></table>

Amazonさんから届いた。結構軽い本だから電車とかで読むのも悪くないかもしれない。洋書だけど、そんな難しい英語はなさそうだからそんなに苦労はなさそう。

The Five Rules
<dl>
<dt>The Law of Car</dt>
<dd>The primitive car is defined only for non-empty lists.</dd>
<dt>The Law of Cdr</dt>
<dd>The primitive cdr is defined only for non-empty lists. The cdr of any non-empty list is always another list.</dd>
<dt>The Law of Cons</dt>
<dd>The primitive cons takes two arguments. The second argument to cons must be a list. The result is a list.</dd>
<dt>The Law of Null?</dt>
<dd>The primitive null? is defined only for lists.</dd>
<dt>The Law of Eq?</dt>
<dd>The primitive eq? takes two arguments. Each must be a non-numeric atom.</dd>
</dl>
</article><hr /><article><h2><a href="/2007/11/24/ruby_brainfuck/">2007-11-24 RubyでBrainFuck処理系を書いてみた</a></h2><pre lang="ruby">
class BrainFuck
  def convert(code)
    @code = code
    @memory = Array.new
    @code_ptr = @mem_ptr = 0
    @output = ""

    while @code.size > @code_ptr
      @memory[@mem_ptr] ||= 0

      case @code[@code_ptr]
      when ?>
        @mem_ptr += 1
      when ?< raise ArgumentError if @mem_ptr.zero?
        @mem_ptr -= 1
      when ?+
        @memory[@mem_ptr] += 1
      when ?-
        @memory[@mem_ptr] -= 1
      when ?.
        @output += @memory[@mem_ptr].chr
      when ?,
        @memory[@mem_ptr] = $stdin.getc
      when ?[
        if @memory[@mem_ptr].zero?
          nest = 1
          until nest.zero?
            @code_ptr += 1
            case @code[@code_ptr]
            when ?[
              nest += 1
            when ?]
              nest -= 1
            end
          end
        end
      when ?]
        if @memory[@mem_ptr].nonzero?
          nest = 1
          until nest.zero?
            @code_ptr -= 1
            case @code[@code_ptr]
            when ?[
              nest -= 1
            when ?]
              nest += 1
            end
          end
        end
      end
      @code_ptr += 1
    end

    return @output
  end
end
</pre>
こんな感じで使う。
</pre><pre lang="ruby">
hello = "++++++++[>+++++++++< -]>." # H
hello += "< +++++[>++++++< -]>-."         # e
hello += "< ++[>+++< -]>+."                      # l
hello += "."                                                 # l
hello += "+++."                                          # o

bf = BrainFuck.new
p bf.convert(hello) #=> Hello
</pre>

[と]の処理内容が似てるのが気になる。似てるっていうかほとんど一緒なんだよね。なんかこううまく抽象化することはできないものか。あと無意味にインスタンス変数使い過ぎだな。
</article><hr /><article><h2><a href="/2007/11/22/re_startruby/">2007-11-22 Re: Try Ruby! 第1章</a></h2>msngさんがstartRubyというブログを始めたようです。せっかくなんで少しだけ補足しとこうかな。

<a href="http://startruby.com/20071122.html">Try Ruby! 第1章</a>

<h2>演算子(一部除く)は再定義可能なメソッド</h2>
Rubyの演算子は一部を除いて再定義可能なメソッド。例えば「+」演算子をメソッド呼び出しと同じ構文で書くことができる。
<pre lang="ruby">
1 + 1
#=> 2
1.+(1)
#=. 2
</pre>
メソッド呼び出しの構文
<blockquote>
オブジェクト.メソッド名(引数1, 引数2,  ....)
</blockquote>
ちなみにこの構文のオブジェクトのことをレシーバって言います。なぜかと言うと、メソッドを呼び出すことを「オブジェクトにメッセージを送る」と表現するので、オブジェクトはメッセージを受け取る(レシーブする)側なのでレシーバ。

ちなみに一部のメソッドは組込み演算子なので再定義することは不可能です。=とか!とか&&とかは無理。そこらへんはリファレンスを見るように。

<h2>mathオブジェクトとtextオブジェクト</h2>
これは多分、Numeric(数値)クラスとString(文字列)クラスのオブジェクトって意味だと思う。
<pre lang="ruby">
1.class
#=> Fixnum
"aaa".class
#=> String
</pre>
classメソッドはオブジェクトが何のクラスのオブジェクトなのかを調べるメソッド。つまり1はFixnumクラスのオブジェクト、文字列aaaはStringクラスのオブジェクトってこと。

なんで最初にNumericクラスって言ってるのに、1のクラスがFixnumクラスなのかと言うとFixnumクラスはNumericクラスのサブクラスだから。他にもFloatクラスとかある。
<img src="http://farm3.static.flickr.com/2257/2052393193_d80b5f873a.jpg?v=0"/>

<h2>msngさんがんばって!</h2>
そんなわけで適当に補足してみました。細かいところはリファレンスにも載ってるから一度見てみるといいと思う。最近503エラーがしょっちゅうでてるけどね・・・

<a href="http://www.ruby-lang.org/ja/man/">Rubyリファレンス</a>

UK STUDIOはstartRubyを応援しています。
</article><hr /><article><h2><a href="/2007/11/18/ruby_amazon/">2007-11-18 Ruby/Amazonライブラリ</a></h2>URL:<a href="http://www.caliban.org/ruby/ruby-amazon.shtml">http://www.caliban.org/ruby/ruby-amazon.shtml</a>

ちょっとAWSを使うプログラムを書こうと思ったので、準備としてRuby/Amazonライブラリを試してみた。
<h2>Ruby/Amazonのインストール</h2>
<ol>
<li>ライブラリのアーカイブを<a href="http://www.caliban.org/ruby/ruby-amazon.shtml#files">ダウンロード</a></li>
<li>アーカイブを解凍</li>
<li>解凍してできたディレクトリにsetup.rbがあるので、それを使用してインストール</li>
</ol>
<pre lang="bash">
% ruby setup.rb config
% ruby setup.rb setup
% ruby setup.rb install
</pre>
<h2>ISBN/ASINで検索</h2>
<h3>ソースコード</h3>
<pre lang="ruby">
#! ruby -Ku

require 'amazon/search'
include Amazon::Search

DEV_TOKEN = "****************"
ASSOCIATE_ID = "ukstudio0c-22"

request = Request.new(DEV_TOKEN, ASSOCIATE_ID, "jp")

# ASIN/ISBNで検索
res = request.asin_search("4274066428", LITE) # HEAVYを指定した場合、詳細な情報が得られる

# ヒット数
puts res.products.size #=> 1 ASINでの検索なので1件のみ該当

# ヒットした製品の情報
puts res.products[0]
</pre>
<h3>実行結果</h3>
<pre lang="bash">
asin             = "4274066428"
authors          = ["Dave Thomas", "Chad Fowler", "Andy Hunt", "田和 勝", "まつもと ゆきひろ"]
availability     = "通常24時間以内に発送"
catalog          = "Book"
image_url_large  = "http://ecx.images-amazon.com/images/I/4151YFZ27NL.jpg"
image_url_medium = "http://ecx.images-amazon.com/images/I/21QGW56WGCL.jpg"
image_url_small  = "http://ecx.images-amazon.com/images/I/11V7Q88BZ3L.jpg"
list_price       = "￥ 3,990"
manufacturer     = "オーム社"
our_price        = "￥ 3,990"
product_name     = "プログラミングRuby 第2版 言語編"
release_date     = "2006/08/26"
url              = "http://www.amazon.co.jp/gp/product/4274066428%3ftag=ukstudio0c-22%26link_code=xm2%26camp=2025%26dev-t=0GTT93KAWBX07WMKM002"
used_price       = "￥ 3,200"
</pre>
<h2>キーワード検索</h2>
<h3>ソースコード</h3>
Requestオブジェクトを作るところまでは同じなので省略。
<pre lang="ruby">
res = request.keyword_search("ruby", 'books', LITE) # booksはモードの指定。musicとか。

# ヒット数
puts res.products.size #=> 11/18日現在、10件ヒットした。なんか少ないな・・・

# ヒットした製品のタイトルを表示
res.products.each{|item|
  puts item.product_name
}
</pre>
<h3>実行結果</h3>
<pre lang="bash">
The Ruby (ザ・ルビー) 2007年 12月号 [雑誌]
Ruby on Rails入門―優しいRailsの育て方
たのしいRuby 第2版 Rubyではじめる気軽なプログラミング
プログラミングRuby 第2版 言語編
プログラミングRuby 第2版 ライブラリ編
Rubyではじめるゲームプログラミング―人気の国産言語で、誰でも簡単にゲームが作れる! (I/O BOOKS)
基礎Ruby on Rails (IMPRESS KISO SERIES)
Rubyレシピブック 第2版 268の技
はじめよう Ruby on Rails
WEB+DB PRESS Vol.38
</pre>
<h3>追記(07-11-19)</h3>
キーワード検索で10件しかヒットしなかったのはkeyword_searchメソッドにALL_PAGESオプションを指定してなかったためでした。
<h3>キーワードがヒットしなかった場合</h3>
検索したキーワードで何もヒットしなかった場合、例外が発生するみたいなので例外処理が必要。
<pre lang="bash">
/opt/local/lib/ruby/site_ruby/1.8/amazon/search.rb:1172:in `get_args': There are no exact matches for the search. (Amazon::Search::Request::SearchError)
</pre>
</article><hr /><article><h2><a href="/2007/11/16/coding_rule_ruby/">2007-11-16 個人用のコーディング規約を書き始めたんよ</a></h2><a href="/coding_rule/">CodingRule</a>

とりあえずはRubyから書き始めたんよ。思ったよりまとめるのが大変。

と言うより、普段何も考えてないのがわかる。暗黙的というか、その場のフィーリングで決めてるようで以前のRubyプログラムを見なおしてみると、スペースの取り方とかメソッド・クラス名が結構バラバラ。

以下の規約も参考にしつつ、少しずつまとめてみたいと思う。

<ul>
<li>前田さんの<a href="http://shugo.net/ruby-codeconv/codeconv.html">Rubyコーディング規約</a></li>
<li>青木さんの<a href="http://www.loveruby.net/w/RubyCodingStyle.html">RubyCodingStyle</a></li>
<li>id:cho45さんの<a href="http://lab.lowreal.net/trac/wiki/CodingRule/Ruby">Ruby Language Coding Rule</a></li>
</ul>

追記(07/11/18): CodingRuleページ内のリンクが間違ってたから修正した
</article><hr /><article><h2><a href="/2007/11/01/ruby_fizzbuzz_2/">2007-11-01 RubyでFizzBuzz #2</a></h2><a href="http://uk-studio.net/2007/10/28/ruby_fizzbuzz/">RubyでFizzBuzz</a>の第二弾。大分スッキリしたと思うんだけどどでしょ。
<pre lang="ruby">
fizzbuzz = (1..100).map{|i|
if i%5 == 0 && i%3 == 0 : "FizzBuzz"
elsif i%5 == 0 : "Buzz"
elsif i%3 == 0 : "Fizz"
else i end
}</pre>
</article><hr /></div></body></html>