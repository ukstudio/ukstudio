<!DOCTYPE html><html><head><meta charset="utf-8" /><!--Always force latest IE rendering engine or request Chrome Frame--><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><meta content="width=device-width,initial-scale=1.0" name="viewport" /><title></title><link href="/stylesheets/dist/normalize.css" rel="stylesheet" /><link href="/stylesheets/dist/skeleton.css" rel="stylesheet" /><link href="/stylesheets/all.css" rel="stylesheet" /><script src="/javascripts/all.js"></script><link href="/feed.xml" rel="alternate" title="atom" type="application/atom+xml" /><script>var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-12755601-1']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();</script></head><body class="x2011 x2011_05 x2011_05_index"><div class="header"><div class="header-title"><h1><a href="/">ukstudio</a></h1></div></div><div class="container"><h1><Archive></Archive>May 2011</h1><article><h2><a href="/2011/05/14/mongodb_nodejs/">2011-05-14 mongodb + node.js を軽く試した</a></h2><h2>mongodbのインストール</h2>
<pre class='sunlight-hilight-bash'>$ sudo aptitude install mongodb
$ mkdir /path/to/data
$ mongod --dbpath /path/to/data</pre>

<h2>mongooseのインストール</h2>
<pre>$ npm install -g mongoose</pre>
node.jsでmongodb扱うのに他にもライブラリあるみたいだけど、とりあえずnpmでサクッと使えるmongooseを使ってみる。
<h2>サンプル</h2>
軽く試しただけなので、詳細は <a href="https://github.com/LearnBoost/mongoose">LearnBoost/mongoose - GitHub</a> を参照。
<script src="https://gist.github.com/971943.js"> </script>
実行するとmongodbの中身はこんな感じ。

<pre>> db.users.find()
{ "_id" : ObjectId("4dce0fb5bad67a145c000001"), "name" : "AKAMATSU Yuki", "age" : 24 }</pre>

印象としてはActiveRecordっぽいというかORMっぽいというか。mongodb自体をそんなに触ってないからこのアプローチが正しいのかどうかはわからないけど、馴染みやすくはある。
</article><hr /><article><h2><a href="/2011/05/10/duostack_nodejs/">2011-05-10 duostackでnode.jsアプリを動かすまで</a></h2><h2>node.jsのインストール</h2>
何はともあれnode.jsのインストール。aptではなくgithubからリポジトリをcloneしてmakeした。最近はapt以外のものは$HOME/localに入れるルールでやってるのでnode.jsも同様に。node.jsをsudoで入れると結構ハマるみたいな話を聞くので特に理由がなければaptとかで入れるか$HOME以下に入れるのがよさそう。

<pre>$ git clone git://github.com/joyent/node.git
$ cd node
$ ./configure --prefix=$HOME/local
$ make
$ make install
$ which node
/home/ukstuido/local/bin/node</pre>

<h2>npmのインストール</h2>
duostackを使うのにnpmが必要なのでnpmもインストール。curl使う方じゃなくてmakeしてインストールした。curl ... | sh の形式があまり好きじゃない程度の理由。

<pre>$ git clone git://github.com/isaacs/npm.git
$ cd npm
$ make install
$ which npm
/home/ukstudio/local/bin/npm</pre>

npmがインストールされる場所は特に指定しなくても$HOME/localに入った。node.jsの位置でも見てるんだろうか。よくわからない。

<h2>duostackのインストール</h2>
あらかじめ、<a href="https://www.duostack.com/">Duostack</a>のアカウントは取っておくこと。結構すぐ登録確認メールが来る。

duostackのインストールは-gオプションを付けないとnode_modulesディレクトリがカレントディレクトリに出来る。最初-gオプションを知らなくて困惑した。

<pre>$ npm install -g duostack
$ which duostack
/home/ukstudio/local/bin/duostack</pre>


<h2>アプリの作成とデプロイ</h2>
ここまで来ると<a href="http://docs.duostack.com/node/quick-start-guide#create-a-new-node-app">Duostack · Docs: Quick Start Guide</a>に従うだけでOK。

適当なディレクトリを作ってそこにserver.jsを置く。

<pre>$ mkdir sample
$ cd sample
$ vim server.js</pre>
<script src="http://gist.github.com/963569.js?file=gistfile1.js"></script>

git initしてやる。

<pre>$ git init
$ git add .
$ git commit -m 'init'</pre>

duostackコマンドでアプリケーションを登録。ここで指定したアプリ名がそのままドメインになる。

<pre>$ duostack create ukstudio
$ git push duostack master</pre>

無事にpushできればURLが表示されているはずなのでブラウザで確認する。今回の例だと<a href = "http://ukstudio.duostack.net/">http://ukstudio.duostack.net/</a>になる。

こんな感じでduostackでnode.jsアプリを動かすところまで試してみた。herokuとかもそうだけど、こうサクッとアプリが動かせる環境があるのはうれしい。

次はnode.js + CoffeeScriptとか、もうちょっとアプリらしいアプリを作ってみようかな。

<h2>追記: duostackでCoffeeScriptを動かす</h2>
CoffeeScriptからコンパイルしたJavaScriptを乗せるんじゃなくて、CoffeeScriptそのものを乗せる方法。server.jsは必要っぽいのでそこからrequireする形にした。CoffeeScriptはアプリの中にインストールしておく。 これで一応動くことは動く。

<pre>$ npm install coffee-script</pre>

<script src="https://gist.github.com/964149.js"> </script>
</article><hr /><article><h2><a href="/2011/05/09/build_vim/">2011-05-09 Vimをソースからビルド</a></h2>aptで入れたvimのrubyインターフェースのバージョンが1.8.6なのが気にいらなくてvimをソースからビルドした。

<pre><code>$ hg clone https://vim.googlecode.com/hg/ vim
$ hg update vim73

$ cd vim
$ ./configure --enable-multibyte --prefix=$HOME/local --enable-rubyinterp</code></pre>

これでOK。aptで入れたvimも一応残しておきたかったのでprefixで$HOME以下にビルドするようにした。Rubyインターフェースはrvmで入れた1.9.2を見るようになっていたのでとりあえずよしとする。何でrvmの奴を見にいったのかはよくわからない。
</article><hr /></div></body></html>